(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{"6ikm":function(t,e,i){"use strict";i.r(e),i.d(e,"MyItemsListModule",(function(){return Be}));var n=i("ofXK"),c=i("tyNb"),s=i("HdQx"),r=i("quSY"),o=i("b5vT"),a=i("fXoL"),b=i("3sFK"),l=i("0IaG"),d=i("IYfF"),u=i("cp0P"),m=i("3Pt+"),p=i("kmnG"),f=i("qFsG"),v=i("bTqV");let h=(()=>{class t{constructor(t,e,i,n){var c;this.fb=t,this.appEnvironmentService=e,this.data=i,this.dialogRef=n,this.form=this.fb.group({name:[null===(c=this.data.environment)||void 0===c?void 0:c.name,[m.E.required]]})}ngOnInit(){this.form.valueChanges.subscribe(t=>{})}ngOnDestroy(){}close(){this.dialogRef.close(this.form.value)}save(){this.appEnvironmentService.rename(this.data.environment.id,this.form.controls.name.value).subscribe(t=>{this.dialogRef.close({success:!0})},t=>{})}}return t.\u0275fac=function(e){return new(e||t)(a.Lb(m.f),a.Lb(b.a),a.Lb(l.a),a.Lb(l.h))},t.\u0275cmp=a.Fb({type:t,selectors:[["rename-environment-dialog"]],decls:13,vars:5,consts:[["mat-dialog-title",""],["mat-dialog-content",""],[3,"formGroup"],[1,"mat-form-field"],["placeholder","Text Input","matInput","","formControlName","name"],["mat-dialog-actions","",3,"align"],["mat-button","","mat-dialog-close",""],["mat-button","",3,"disabled","click"]],template:function(t,e){1&t&&(a.Rb(0,"h1",0),a.Ec(1),a.Rb(2,"span"),a.Ec(3),a.Qb(),a.Qb(),a.Rb(4,"div",1),a.Rb(5,"form",2),a.Rb(6,"mat-form-field",3),a.Mb(7,"input",4),a.Qb(),a.Qb(),a.Qb(),a.Rb(8,"div",5),a.Rb(9,"button",6),a.Ec(10,"Cancel"),a.Qb(),a.Rb(11,"button",7),a.Zb("click",(function(){return e.save()})),a.Ec(12,"Rename"),a.Qb(),a.Qb()),2&t&&(a.Ab(1),a.Gc("Rename ",e.data.environment.name," "),a.Ab(2),a.Fc(e.data.environment.type),a.Ab(2),a.jc("formGroup",e.form),a.Ab(3),a.jc("align","end"),a.Ab(3),a.jc("disabled",e.form.invalid))},directives:[l.i,l.f,m.G,m.r,m.j,p.c,f.a,m.c,m.q,m.i,l.c,v.b,l.d],styles:[".mat-form-field[_ngcontent-%COMP%], .mat-radio-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin:15px 0}.mat-radio-button[_ngcontent-%COMP%]{margin:5px}"]}),t})();var g=i("Mzu6"),k=i("IzEk"),S=i("N4Rb"),E=i("xm+p");function R(t,e){if(1&t){const t=a.Sb();a.Rb(0,"tr"),a.Rb(1,"td",2),a.Rb(2,"div",2),a.Ec(3),a.Qb(),a.Rb(4,"div",9),a.Ec(5),a.Qb(),a.Qb(),a.Rb(6,"td"),a.Rb(7,"button",10),a.Zb("click",(function(){a.rc(t);const e=a.dc().$implicit;return a.dc(2).selectWorkspace(e)})),a.Ec(8,"Select"),a.Qb(),a.Qb(),a.Qb()}if(2&t){const t=a.dc().$implicit;a.Ab(3),a.Gc(" ",t.name,""),a.Ab(2),a.Fc(t.codebasePath)}}function I(t,e){if(1&t&&(a.Pb(0),a.Cc(1,R,9,2,"tr",8),a.Ob()),2&t){const t=e.$implicit;a.Ab(1),a.jc("ngIf",!t.remoteOnly)}}function y(t,e){if(1&t&&(a.Rb(0,"table",4),a.Rb(1,"tr",5),a.Rb(2,"th",6),a.Ec(3,"My Workspaces"),a.Qb(),a.Qb(),a.Cc(4,I,2,1,"ng-container",7),a.Qb()),2&t){const t=a.dc();a.Ab(4),a.jc("ngForOf",t.workspaces)}}let w=(()=>{class t{constructor(t,e,i,n){this.workspaceService=t,this.appEnvironmentService=e,this.navigationService=i,this.dialogRef=n}ngOnInit(){this.getWorkspaces()}selectWorkspace(t){this.appEnvironmentService.switchToEnvironment(t.id).subscribe(()=>{this.navigationService.navigateTo(["app-environment"]),this.dialogRef.close()})}getWorkspaces(){this.workspaceService.userWorkspaces().subscribe(t=>{this.workspaces=t.sort((t,e)=>{var i,n;return(null===(i=t.name)||void 0===i?void 0:i.toLowerCase())>(null===(n=e.name)||void 0===n?void 0:n.toLowerCase())?1:-1})})}ngOnDestroy(){}close(){this.dialogRef.close(this.form.value)}}return t.\u0275fac=function(e){return new(e||t)(a.Lb(S.a),a.Lb(b.a),a.Lb(E.a),a.Lb(l.h))},t.\u0275cmp=a.Fb({type:t,selectors:[["select-environment-dialog"]],decls:5,vars:1,consts:[["mat-dialog-title",""],["mat-dialog-content",""],[1,""],["class","table",4,"ngIf"],[1,"table"],[1,"border-top-0"],[1,"text-capitalize","border-top-0"],[4,"ngFor","ngForOf"],[4,"ngIf"],[1,"codebase-path","text-muted"],["mat-raised-button","",3,"click"]],template:function(t,e){1&t&&(a.Rb(0,"h1",0),a.Ec(1,"Select Workspace"),a.Qb(),a.Rb(2,"div",1),a.Rb(3,"div",2),a.Cc(4,y,5,1,"table",3),a.Qb(),a.Qb()),2&t&&(a.Ab(4),a.jc("ngIf",(null==e.workspaces?null:e.workspaces.length)>0))},directives:[l.i,l.f,n.t,n.s,v.b],styles:[".mat-form-field[_ngcontent-%COMP%], .mat-radio-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin:15px 0}.mat-radio-button[_ngcontent-%COMP%]{margin:5px}"]}),t})();var C=i("aSHc"),x=i("oCqB"),A=i("QibW"),Q=i("bv9b");function j(t,e){if(1&t&&(a.Pb(0),a.Rb(1,"form",5),a.Rb(2,"mat-radio-group",6),a.Rb(3,"mat-radio-button",7),a.Ec(4,"Make Stack Public"),a.Qb(),a.Rb(5,"mat-radio-button",7),a.Ec(6,"Make Stack Private"),a.Qb(),a.Qb(),a.Rb(7,"div",8),a.Rb(8,"div",9),a.Ec(9,"Public: \xa0\xa0Anyone can install this stack."),a.Qb(),a.Rb(10,"div",9),a.Ec(11,"Private: Only users who have access to this stack can install it."),a.Qb(),a.Qb(),a.Qb(),a.Ob()),2&t){const t=a.dc();a.Ab(1),a.jc("formGroup",t.form),a.Ab(2),a.jc("value","public"),a.Ab(2),a.jc("value","private")}}function O(t,e){1&t&&(a.Rb(0,"div",10),a.Rb(1,"div"),a.Ec(2,"Publishing Stack..."),a.Qb(),a.Mb(3,"mat-progress-bar",11),a.Qb())}function P(t,e){if(1&t&&(a.Pb(0),a.Rb(1,"div",12),a.Mb(2,"i",13),a.Ec(3),a.Qb(),a.Ob()),2&t){const t=a.dc();a.Ab(3),a.Gc(" Stack: ",t.data.stack.name," has been published! ")}}function M(t,e){if(1&t&&(a.Rb(0,"div",18),a.Ec(1),a.Qb()),2&t){const t=a.dc(2);a.Ab(1),a.Gc("Error: ",t.errorMessage,"")}}function L(t,e){if(1&t&&(a.Pb(0),a.Rb(1,"div",14),a.Mb(2,"i",15),a.Ec(3," Failed to publish stack: "),a.Rb(4,"span",16),a.Ec(5),a.Qb(),a.Ec(6,". "),a.Qb(),a.Cc(7,M,2,1,"div",17),a.Ob()),2&t){const t=a.dc();a.Ab(5),a.Fc(t.data.stack.name),a.Ab(2),a.jc("ngIf",t.errorMessage)}}function D(t,e){if(1&t){const t=a.Sb();a.Pb(0),a.Rb(1,"button",19),a.Ec(2,"Cancel"),a.Qb(),a.Rb(3,"button",20),a.Zb("click",(function(){return a.rc(t),a.dc().publish()})),a.Ec(4,"Publish"),a.Qb(),a.Ob()}if(2&t){const t=a.dc();a.Ab(3),a.jc("disabled",t.form.invalid)}}function $(t,e){if(1&t){const t=a.Sb();a.Pb(0),a.Rb(1,"button",21),a.Zb("click",(function(){return a.rc(t),a.dc().close()})),a.Ec(2,"Close"),a.Qb(),a.Ob()}}let F=(()=>{class t{constructor(t,e,i,n){this.fb=t,this.stackService=e,this.data=i,this.dialogRef=n,this.actionState=C.a,this.currentState=C.a.IDLE,this.form=this.fb.group({textInput:[],visibility:["public",[m.E.required]],select:[]})}ngOnInit(){this.errorMessage=null,this.form.valueChanges.subscribe(t=>{})}ngOnDestroy(){}close(){this.dialogRef.close(this.form.value)}publish(){this.currentState=C.a.ACQUIRING,this.stackService.publishStack(this.data.stack.id).subscribe(t=>{this.currentState=C.a.SUCCESS},t=>{this.currentState=C.a.FAILED,this.errorMessage=t.message||"Unknown error occurred while trying to publish stack."})}}return t.\u0275fac=function(e){return new(e||t)(a.Lb(m.f),a.Lb(x.a),a.Lb(l.a),a.Lb(l.h))},t.\u0275cmp=a.Fb({type:t,selectors:[["publish-stack-dialog"]],decls:10,vars:7,consts:[["mat-dialog-title",""],["mat-dialog-content",""],[4,"ngIf"],["class","text-center p-2",4,"ngIf"],["mat-dialog-actions","",3,"align"],[3,"formGroup"],["aria-label","Select an option","formControlName","visibility",1,"mat-radio-group"],[1,"mat-radio-button",3,"value"],[1,"pb-2"],[1,"text-small","text-muted"],[1,"text-center","p-2"],["mode","indeterminate"],[1,"text-center","p-2","text-success"],[1,"fa","fa-check","mr-2"],[1,"text-center","p-2","text-red"],[1,"fa","fa-times-circle","mr-2"],[1,"text-capitalize"],["class","text-muted text-small pl-5",4,"ngIf"],[1,"text-muted","text-small","pl-5"],["mat-button","","mat-dialog-close",""],["mat-button","",3,"disabled","click"],["mat-button","",3,"click"]],template:function(t,e){1&t&&(a.Rb(0,"h1",0),a.Ec(1,"Publish Stack"),a.Qb(),a.Rb(2,"div",1),a.Cc(3,j,12,3,"ng-container",2),a.Cc(4,O,4,0,"div",3),a.Cc(5,P,4,1,"ng-container",2),a.Cc(6,L,8,2,"ng-container",2),a.Qb(),a.Rb(7,"div",4),a.Cc(8,D,5,1,"ng-container",2),a.Cc(9,$,3,0,"ng-container",2),a.Qb()),2&t&&(a.Ab(3),a.jc("ngIf",e.currentState===e.actionState.IDLE),a.Ab(1),a.jc("ngIf",e.currentState===e.actionState.ACQUIRING),a.Ab(1),a.jc("ngIf",e.currentState===e.actionState.SUCCESS),a.Ab(1),a.jc("ngIf",e.currentState===e.actionState.FAILED),a.Ab(1),a.jc("align","end"),a.Ab(1),a.jc("ngIf",e.currentState===e.actionState.IDLE),a.Ab(1),a.jc("ngIf",e.currentState===e.actionState.SUCCESS||e.currentState===e.actionState.FAILED))},directives:[l.i,l.f,n.t,l.c,m.G,m.r,m.j,A.b,m.q,m.i,A.a,Q.a,v.b,l.d],styles:[".mat-form-field[_ngcontent-%COMP%], .mat-radio-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin:15px 0}.mat-radio-button[_ngcontent-%COMP%]{margin:5px}"]}),t})();var W=i("nZ6g"),T=i("a8/g"),Z=i("k1Ex");function U(t,e){if(1&t){const t=a.Sb();a.Pb(0),a.Rb(1,"button",1),a.Zb("click",(function(){return a.rc(t),a.dc().downloadRemoteStack()})),a.Mb(2,"i",2),a.Ec(3," Download Remote Stack"),a.Qb(),a.Ob()}}function G(t,e){1&t&&(a.Pb(0),a.Rb(1,"div",3),a.Mb(2,"mat-progress-bar",4),a.Rb(3,"div",5),a.Ec(4,"downloading stack"),a.Qb(),a.Qb(),a.Ob())}function N(t,e){if(1&t&&(a.Pb(0),a.Rb(1,"div",6),a.Mb(2,"i",7),a.Ec(3),a.Qb(),a.Ob()),2&t){const t=a.dc();a.Ab(3),a.Gc(" Error Downloading Stack ",t.stack.name,"")}}let q=(()=>{class t{constructor(t){this.stackService=t,this.onFinished=new a.o,this.actionState=C.a,this.currentState=C.a.IDLE,this.subs=new r.a}ngOnInit(){}ngOnDestroy(){this.subs.unsubscribe()}downloadRemoteStack(){this.currentState=this.actionState.ACQUIRING,this.subs.add(this.stackService.downloadStack(this.stack.remote.id,this.stack.name,this.stack.remote.version,s.a.Environment.Type.Stack).subscribe(t=>{this.currentState=this.actionState.SUCCESS,this.onFinished.emit(!0)}))}}return t.\u0275fac=function(e){return new(e||t)(a.Lb(x.a))},t.\u0275cmp=a.Fb({type:t,selectors:[["download-remote-stack"]],inputs:{stack:"stack"},outputs:{onFinished:"onFinished"},decls:3,vars:3,consts:[[4,"ngIf"],["mat-button","",3,"click"],[1,"fa","fa-download","text-muted"],[1,"text-center"],["mode","buffer"],[1,"text-small"],[1,"text-warning"],[1,"fa","fa-exclamation-triangle"]],template:function(t,e){1&t&&(a.Cc(0,U,4,0,"ng-container",0),a.Cc(1,G,5,0,"ng-container",0),a.Cc(2,N,4,1,"ng-container",0)),2&t&&(a.jc("ngIf",e.currentState===e.actionState.IDLE),a.Ab(1),a.jc("ngIf",e.currentState===e.actionState.ACQUIRING),a.Ab(1),a.jc("ngIf",e.currentState===e.actionState.FAILED))},directives:[n.t,v.b,Q.a],styles:[""]}),t})();var _=i("Qu3c");function z(t,e){1&t&&(a.Rb(0,"div",11),a.Ec(1,"No stacks present"),a.Qb())}function J(t,e){1&t&&(a.Rb(0,"div",24),a.Rb(1,"button",25),a.Mb(2,"i",26),a.Qb(),a.Qb())}function Y(t,e){if(1&t){const t=a.Sb();a.Rb(0,"div",4),a.Rb(1,"button",27),a.Zb("click",(function(){a.rc(t);const e=a.dc().$implicit;return a.dc(2).switchEnvironment(e)})),a.Mb(2,"i",28),a.Qb(),a.Qb()}if(2&t){const t=a.dc().$implicit,e=a.dc(2);a.Ab(1),a.jc("disabled",e.isCurrentEnv(t))}}function H(t,e){if(1&t){const t=a.Sb();a.Rb(0,"div",4),a.Rb(1,"button",29),a.Zb("click",(function(){a.rc(t);const e=a.dc(3).$implicit;return a.dc(2).publishStack(e)})),a.Mb(2,"i",30),a.Ec(3," Publish Stack"),a.Qb(),a.Qb()}2&t&&(a.Ab(1),a.jc("title","Publish Stack"))}function K(t,e){if(1&t){const t=a.Sb();a.Rb(0,"div",4),a.Rb(1,"button",29),a.Zb("click",(function(){a.rc(t);const e=a.dc(4).$implicit;return a.dc(2).publishStack(e)})),a.Mb(2,"i",30),a.Ec(3," Push your changes"),a.Qb(),a.Qb()}2&t&&(a.Ab(1),a.jc("title","Push Your Changes"))}function V(t,e){if(1&t){const t=a.Sb();a.Rb(0,"div",4),a.Rb(1,"button",29),a.Zb("click",(function(){a.rc(t);const e=a.dc(4).$implicit;return a.dc(2).syncStack(e)})),a.Mb(2,"i",26),a.Ec(3," Pull new updates"),a.Qb(),a.Qb()}2&t&&(a.Ab(1),a.jc("title","Pull New Updates"))}function B(t,e){1&t&&(a.Rb(0,"div",32),a.Ec(1,"Requires merge!"),a.Qb())}function X(t,e){if(1&t&&(a.Rb(0,"div",4),a.Cc(1,K,4,1,"div",17),a.Cc(2,V,4,1,"div",17),a.Cc(3,B,2,0,"div",31),a.Qb()),2&t){const t=a.dc(3).$implicit;a.Ab(1),a.jc("ngIf",!t.remote.isClean),a.Ab(1),a.jc("ngIf",t.localVersion!=(null==t.remote?null:t.remote.version)),a.Ab(1),a.jc("ngIf",null==t.remote?null:t.remote.requiresMerge)}}function tt(t,e){if(1&t&&(a.Pb(0),a.Cc(1,H,4,1,"div",17),a.Cc(2,X,4,3,"div",17),a.Ob()),2&t){const t=a.dc(2).$implicit;a.Ab(1),a.jc("ngIf",t.isLocal),a.Ab(1),a.jc("ngIf",t.remote)}}function et(t,e){if(1&t){const t=a.Sb();a.Pb(0),a.Rb(1,"download-remote-stack",33),a.Zb("onFinished",(function(){return a.rc(t),a.dc(4).getEnvironments()})),a.Qb(),a.Ob()}if(2&t){const t=a.dc(2).$implicit;a.Ab(1),a.jc("stack",t)}}function it(t,e){if(1&t&&(a.Pb(0),a.Cc(1,tt,3,2,"ng-container",0),a.Cc(2,et,2,1,"ng-container",0),a.Ob()),2&t){const t=a.dc().$implicit;a.Ab(1),a.jc("ngIf",!t.remoteOnly),a.Ab(1),a.jc("ngIf",t.remoteOnly)}}function nt(t,e){1&t&&(a.Rb(0,"div",47),a.Mb(1,"i",48),a.Ec(2," Shared"),a.Qb())}function ct(t,e){1&t&&(a.Rb(0,"div",49),a.Mb(1,"i",50),a.Ec(2," Local"),a.Qb())}function st(t,e){1&t&&(a.Rb(0,"span",38),a.Ec(1," (Login Required)"),a.Qb())}function rt(t,e){if(1&t){const t=a.Sb();a.Rb(0,"button",43),a.Zb("click",(function(){a.rc(t);const e=a.dc(2).$implicit;return a.dc(2).publishStack(e)})),a.Rb(1,"span"),a.Ec(2,"Publish Stack"),a.Qb(),a.Cc(3,st,2,0,"span",51),a.Qb()}if(2&t){const t=a.dc(4);a.jc("disabled",!t.isLoggedIn),a.Ab(3),a.jc("ngIf",!t.isLoggedIn)}}function ot(t,e){if(1&t){const t=a.Sb();a.Rb(0,"button",43),a.Zb("click",(function(){a.rc(t);const e=a.dc(2).$implicit;return a.dc(2).switchEnvironment(e)})),a.Ec(1,"Switch To This Stack"),a.Qb()}if(2&t){const t=a.dc(2).$implicit,e=a.dc(2);a.jc("disabled",e.isCurrentEnv(t))}}function at(t,e){if(1&t){const t=a.Sb();a.Rb(0,"button",45),a.Zb("click",(function(){a.rc(t);const e=a.dc(2).$implicit;return a.dc(2).shareStack(e)})),a.Ec(1,"Share Stack"),a.Qb()}}function bt(t,e){if(1&t){const t=a.Sb();a.Rb(0,"button",45),a.Zb("click",(function(){a.rc(t);const e=a.dc(2).$implicit;return a.dc(2).revokeStack(e)})),a.Ec(1,"Purge Stack"),a.Qb()}}function lt(t,e){if(1&t){const t=a.Sb();a.Rb(0,"div",34),a.Rb(1,"div",12),a.Rb(2,"p",35),a.Ec(3),a.Qb(),a.Cc(4,nt,3,0,"div",36),a.Cc(5,ct,3,0,"div",37),a.Rb(6,"div",38),a.Mb(7,"i",39),a.Ec(8),a.Qb(),a.Rb(9,"div",38),a.Mb(10,"i",40),a.Ec(11),a.Qb(),a.Qb(),a.Rb(12,"div",41),a.Cc(13,rt,4,2,"button",42),a.Cc(14,ot,2,1,"button",42),a.Rb(15,"button",43),a.Zb("click",(function(){a.rc(t);const e=a.dc().$implicit;return a.dc(2).installIntoCurrentEnvironment(e)})),a.Ec(16,"Install Into Current "),a.Rb(17,"span",44),a.Ec(18),a.Qb(),a.Qb(),a.Rb(19,"button",45),a.Zb("click",(function(){a.rc(t);const e=a.dc().$implicit;return a.dc(2).installIntoNewWorkspace(e)})),a.Ec(20,"Install Into New Workspace"),a.Qb(),a.Cc(21,at,2,0,"button",46),a.Rb(22,"button",45),a.Zb("click",(function(){a.rc(t);const e=a.dc().$implicit;return a.dc(2).renameStack(e)})),a.Ec(23,"Rename Stack"),a.Qb(),a.Rb(24,"button",45),a.Zb("click",(function(){a.rc(t);const e=a.dc().$implicit;return a.dc(2).deleteStack(e)})),a.Rb(25,"span"),a.Ec(26,"Delete Stack"),a.Qb(),a.Qb(),a.Cc(27,bt,2,0,"button",46),a.Qb(),a.Qb()}if(2&t){const t=a.dc().$implicit,e=a.dc(2);a.Ab(3),a.Fc(t.description||"No description"),a.Ab(1),a.jc("ngIf",t.remote),a.Ab(1),a.jc("ngIf",!t.remote&&t.isLocal),a.Ab(3),a.Gc(" ",t.codebasePath,""),a.Ab(3),a.Gc(" ",t.seed,""),a.Ab(2),a.jc("ngIf",!t.remote),a.Ab(1),a.jc("ngIf",!t.remoteOnly),a.Ab(1),a.jc("disabled",e.isCurrentEnv(t)),a.Ab(3),a.Fc(e.currentEnvironment.type),a.Ab(3),a.jc("ngIf",t.remote),a.Ab(6),a.jc("ngIf",(null==t.remote?null:t.remote.owner)===(null==e.user?null:e.user.uid))}}function dt(t,e){if(1&t){const t=a.Sb();a.Rb(0,"div",12),a.Rb(1,"div",13),a.Rb(2,"div",14),a.Rb(3,"div",15),a.Cc(4,J,3,0,"div",16),a.Cc(5,Y,3,1,"div",17),a.Qb(),a.Rb(6,"div",4),a.Mb(7,"i",18),a.Qb(),a.Rb(8,"div",19),a.Zb("click",(function(){a.rc(t);const i=e.$implicit;return a.dc(2).toggleItemList(i.id)})),a.Ec(9),a.Qb(),a.Rb(10,"div",7),a.Cc(11,it,3,2,"ng-container",0),a.Qb(),a.Rb(12,"div",20),a.Rb(13,"button",21),a.Zb("click",(function(){a.rc(t);const i=e.$implicit;return a.dc(2).toggleItemList(i.id)})),a.Mb(14,"i",22),a.Qb(),a.Qb(),a.Qb(),a.Cc(15,lt,28,11,"div",23),a.Qb(),a.Qb()}if(2&t){const t=e.$implicit,i=a.dc(2);a.Ab(4),a.jc("ngIf",t.remoteOnly),a.Ab(1),a.jc("ngIf",!t.remoteOnly),a.Ab(2),a.Db("text-primary",i.isCurrentEnv(t))("text-muted",!i.isCurrentEnv(t)),a.Ab(1),a.Db("text-primary",i.isCurrentEnv(t)),a.Ab(1),a.Fc(t.name),a.Ab(2),a.jc("ngIf",i.isLoggedIn),a.Ab(3),a.Db("fa-chevron-up",i.itemList[t.id])("fa-chevron-down",!i.itemList[t.id]),a.Ab(1),a.jc("ngIf",i.itemList[t.id])}}function ut(t,e){if(1&t){const t=a.Sb();a.Pb(0),a.Rb(1,"div",1),a.Rb(2,"div",2),a.Cc(3,z,2,0,"div",3),a.Rb(4,"div",4),a.Rb(5,"div",5),a.Rb(6,"div",6),a.Ec(7,"My Stacks"),a.Qb(),a.Rb(8,"div",7),a.Rb(9,"button",8),a.Zb("click",(function(){return a.rc(t),a.dc().createNewStack()})),a.Mb(10,"i",9),a.Ec(11," New Stack"),a.Qb(),a.Qb(),a.Qb(),a.Cc(12,dt,16,15,"div",10),a.Qb(),a.Qb(),a.Qb(),a.Ob()}if(2&t){const t=a.dc();a.Ab(3),a.jc("ngIf",0===t.stacks.length),a.Ab(9),a.jc("ngForOf",t.stacks)}}let mt=(()=>{class t{constructor(t,e,i,n,c,o,a){this.appEnvironmentService=t,this.dialog=e,this.authService=i,this.stacksService=n,this.dialogService=c,this.appConsoleService=o,this.myItemsService=a,this.envType=s.a.Environment.Type,this.isLoggedIn=!1,this.itemList={},this.subs=new r.a}ngOnInit(){this.getEnvironments(),this.subs.add(this.authService.user$.subscribe(t=>{this.user=t,this.isLoggedIn=!!t})),this.subs.add(this.appEnvironmentService.currentEnvironment$.subscribe(t=>this.currentEnvironment=t))}toggleItemList(t){this.itemList[t]=!this.itemList[t]}getEnvironments(){this.stacksService.userStacks().subscribe(t=>{this.stacks=t})}createNewStack(){this.isLoggedIn?this.dialog.open(o.a,{data:{type:s.a.Environment.Type.Stack},minWidth:"600px",position:{top:"100px"},autoFocus:!0}).afterClosed().subscribe(()=>this.getEnvironments()):this.dialogService.openMustLoginDialog()}ngOnDestroy(){}isCurrentEnv(t){var e;return(null===(e=this.currentEnvironment)||void 0===e?void 0:e.id)===t.id}switchEnvironment(t){this.appEnvironmentService.switchToEnvironment(t.id).subscribe(()=>null)}publishStack(t){this.dialog.open(F,{data:{stack:t},position:{top:"100px"},minWidth:"400px",autoFocus:!0}).afterClosed().subscribe(()=>this.getEnvironments())}syncStack(t){this.stacksService.syncStack(t.id,t.remote.version).subscribe(()=>{this.getEnvironments(),this.dialogService.openAlertDialog({title:"Sync Stack",text:"Stack has been synced"})},t=>{var e;this.dialogService.openAlertDialog({title:"Sync Stack",text:(null===(e=t.error)||void 0===e?void 0:e.message)||"Server error!"})})}deleteStack(t){const e=this.dialogService.openConfirmationDialog({title:`Delete stack ${t.name}?`,text:"Deleting this stack is a permanent action and cannot be undone.",button:{yes:"Delete",no:"Cancel"}});Object(u.a)([e.afterClosed(),this.appEnvironmentService.currentEnvironment$.pipe(Object(k.a)(1))]).subscribe(([e,i])=>{!0===e&&this.stacksService.deleteStack(t.id).subscribe(()=>{t.id===i.id&&this.dialog.open(w,{data:{},disableClose:!0,position:{top:"100px"},autoFocus:!0}).afterClosed().subscribe(t=>console.log("dialog result: ",t)),this.getEnvironments()})})}revokeStack(t){const e=this.dialog.open(g.a,{data:{title:`Revoke stack ${t.name}?`,text:"Revoking this stack will remove it from the stackjoy community. It will no longer be public and other users will no longer be able to install it. This is a permanent action and cannot be undone.",button:{yes:"Revoke",no:"Cancel"}},position:{top:"100px"},autoFocus:!0});console.log(t),Object(u.a)([e.afterClosed(),this.appEnvironmentService.currentEnvironment$.pipe(Object(k.a)(1))]).subscribe(([e,i])=>{!1!==e&&this.stacksService.purge(t.remote.id).subscribe(()=>{this.dialogService.openAlertDialog({title:"Revoke Stack",text:`Stack ${t.name} revoked successfully. `}),this.getEnvironments()},t=>{this.dialogService.openAlertDialog({title:"Revoke Stack",text:"Something went wrong: "+(t.message||"Unknown error occurred...")})})})}test(){this.stacksService.installIntoCurrentEnvironment("UIkhUmgApyOKEKtEridz").subscribe(()=>{this.getEnvironments()},()=>{})}installIntoCurrentEnvironment(t){this.appConsoleService.openBluConsole({command:"install "+t.name,extraInfo:{stack:t,source:"local"}})}renameStack(t){this.dialog.open(h,{data:{environment:t},width:"500px",position:{top:"100px"},autoFocus:!0}).afterClosed().subscribe(t=>{t.success&&this.getEnvironments()})}shareStack(t){}installIntoNewWorkspace(t){this.myItemsService.createNewWorkspace(t)}}return t.\u0275fac=function(e){return new(e||t)(a.Lb(b.a),a.Lb(l.b),a.Lb(d.a),a.Lb(x.a),a.Lb(W.a),a.Lb(T.a),a.Lb(Z.a))},t.\u0275cmp=a.Fb({type:t,selectors:[["my-stacks"]],decls:1,vars:1,consts:[[4,"ngIf"],[1,"pt-3",2,"max-width","800px"],[1,"pl-3"],["class","text center",4,"ngIf"],[1,""],[1,"pl-2","d-flex","align-items-start"],[1,"text-bold","py-2"],[1,"ml-auto"],["mat-button","",3,"click"],[1,"fa","fa-plus"],["class","p-2",4,"ngFor","ngForOf"],[1,"text","center"],[1,"p-2"],[1,"shadow","p-2","border","rounded"],[1,"d-flex","align-items-center"],[1,"pr-3"],["class","","style","width:40px; height:40px;",4,"ngIf"],["class","",4,"ngIf"],[1,"fa","fa-layer-group"],[1,"pl-2","cursor-pointer",3,"click"],[1,"ml-1"],["mat-button","","mat-icon-button","",3,"click"],[1,"fa"],["class","border-top p-2 d-flex align-items-start",4,"ngIf"],[1,"",2,"width","40px","height","40px"],["mat-button","","mat-icon-button",""],[1,"fa","fa-download","text-muted"],["mat-button","","mat-icon-button","",3,"disabled","click"],[1,"fa","fa-exchange-alt"],["mat-button","",3,"title","click"],[1,"fa","fa-upload","text-muted"],["style","color: red",4,"ngIf"],[2,"color","red"],[3,"stack","onFinished"],[1,"border-top","p-2","d-flex","align-items-start"],[1,"my-2"],["class","text-muted text-small","matTooltip","This stack is shared with other users",4,"ngIf"],["class","text-muted text-small","matTooltip","This stack is present only on this machine",4,"ngIf"],[1,"text-small"],[1,"fa","fa-folder-open","mr-1"],[1,"fa","fa-seedling","mr-1"],[1,"ml-auto","p-2","border-left"],["mat-button","","class","d-block",3,"disabled","click",4,"ngIf"],["mat-button","",1,"d-block",3,"disabled","click"],[1,"text-capitalize"],["mat-button","",1,"d-block",3,"click"],["mat-button","","class","d-block",3,"click",4,"ngIf"],["matTooltip","This stack is shared with other users",1,"text-muted","text-small"],[1,"fa","fa-users","mr-1"],["matTooltip","This stack is present only on this machine",1,"text-muted","text-small"],[1,"fa","fa-desktop","mr-1"],["class"," text-small",4,"ngIf"]],template:function(t,e){1&t&&a.Cc(0,ut,13,2,"ng-container",0),2&t&&a.jc("ngIf",e.stacks)},directives:[n.t,v.b,n.s,q,_.a],styles:[".codebase-path[_ngcontent-%COMP%]{font-size:9px;line-height:9px}"]}),t})();var pt=i("mrSG"),ft=i("itXk"),vt=i("LRne"),ht=i("PE4B");class gt{static UUID(){return gt.UUIDv4("xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx")}static UUIDShort(){return gt.UUIDv4("xxxxxxxx")}static UUIDv4(t){return t.replace(/[xy]/g,t=>{const e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)})}static merge(t,e){return ht(t,e)}}var kt=i("eIep"),St=i("nYR2"),Et=i("+0xr"),Rt=i("d3UM"),It=i("FKr1"),yt=i("zkoq");function wt(t,e){1&t&&(a.Pb(0),a.Mb(1,"br"),a.Mb(2,"mat-progress-bar",5),a.Mb(3,"br"),a.Ob())}function Ct(t,e){1&t&&(a.Rb(0,"h4",16),a.Ec(1,"You must be an administrator to change these settings"),a.Qb())}function xt(t,e){1&t&&a.Mb(0,"th",17)}function At(t,e){1&t&&(a.Rb(0,"div",22),a.Ec(1,"Primary Owner"),a.Qb())}function Qt(t,e){if(1&t&&(a.Rb(0,"div",20),a.Rb(1,"div"),a.Ec(2),a.Qb(),a.Cc(3,At,2,0,"div",21),a.Qb()),2&t){const t=a.dc().$implicit,e=a.dc(3);a.Ab(2),a.Fc(e.userProfiles.get(t).email||"Unknown user"),a.Ab(1),a.jc("ngIf",t==e.environment.remote.owner)}}function jt(t,e){if(1&t&&(a.Rb(0,"td",18),a.Cc(1,Qt,4,2,"div",19),a.Qb()),2&t){const t=e.$implicit,i=a.dc(3);a.Ab(1),a.jc("ngIf",i.userProfiles.has(t))}}function Ot(t,e){1&t&&(a.Rb(0,"th",17),a.Ec(1,"Permission"),a.Qb())}function Pt(t,e){if(1&t&&(a.Rb(0,"mat-option",25),a.Ec(1),a.ec(2,"titlecase"),a.Qb()),2&t){const t=e.$implicit;a.jc("value",t.value),a.Ab(1),a.Gc(" ",a.fc(2,2,t.key)," ")}}function Mt(t,e){if(1&t){const t=a.Sb();a.Pb(0),a.Rb(1,"mat-select",23),a.Zb("valueChange",(function(e){a.rc(t);const i=a.dc().$implicit;return a.dc(3).dirtyEnvPerms[i].permission=e})),a.Cc(2,Pt,3,4,"mat-option",24),a.ec(3,"keyvalue"),a.Qb(),a.Ob()}if(2&t){const t=a.dc().$implicit,e=a.dc(3);a.Ab(1),a.jc("value",e.dirtyEnvPerms[t].permission),a.Ab(1),a.jc("ngForOf",a.gc(3,2,e.envPermissions,e.originalOrder))}}function Lt(t,e){if(1&t&&(a.Pb(0),a.Ec(1),a.ec(2,"titlecase"),a.Ob()),2&t){const t=a.dc().$implicit,e=a.dc(3);a.Ab(1),a.Gc(" ",a.fc(2,1,e.convertPermissionToString(e.dirtyEnvPerms[t].permission))," ")}}function Dt(t,e){if(1&t&&(a.Rb(0,"td",18),a.Cc(1,Mt,4,5,"ng-container",2),a.Cc(2,Lt,3,3,"ng-container",2),a.Qb()),2&t){const t=a.dc(3);a.Ab(1),a.jc("ngIf",t.userIsAdmin),a.Ab(1),a.jc("ngIf",!t.userIsAdmin)}}function $t(t,e){1&t&&(a.Rb(0,"th",17),a.Ec(1,"Actions"),a.Qb())}function Ft(t,e){if(1&t){const t=a.Sb();a.Pb(0),a.Rb(1,"button",27),a.Zb("click",(function(){a.rc(t);const e=a.dc().$implicit;return a.dc(3).save(e)})),a.Ec(2," Save "),a.Qb(),a.Rb(3,"button",28),a.Zb("click",(function(){a.rc(t);const e=a.dc().$implicit;return a.dc(3).revoke(e)})),a.Ec(4,"Revoke"),a.Qb(),a.Ob()}if(2&t){const t=a.dc().$implicit,e=a.dc(3);a.Ab(1),a.jc("disabled",e.dirtyEnvPerms[t].permission===e.environment.remote.permissions[t].permission)}}function Wt(t,e){1&t&&(a.Pb(0),a.Mb(1,"mat-progress-bar",5),a.Ob())}function Tt(t,e){if(1&t&&(a.Rb(0,"td",26),a.Cc(1,Ft,5,1,"ng-container",2),a.Cc(2,Wt,2,0,"ng-container",2),a.Qb()),2&t){const t=e.$implicit,i=a.dc(3);a.Ab(1),a.jc("ngIf",!i.dirtyEnvPerms[t].saving),a.Ab(1),a.jc("ngIf",i.dirtyEnvPerms[t].saving)}}function Zt(t,e){1&t&&a.Mb(0,"tr",29)}function Ut(t,e){1&t&&a.Mb(0,"tr",30)}function Gt(t,e){1&t&&a.Mb(0,"th",17)}function Nt(t,e){if(1&t&&(a.Pb(0),a.Ec(1),a.Ob()),2&t){const t=a.dc().$implicit,e=a.dc(5);a.Ab(1),a.Gc(" ",e.userProfiles.get(t).username||e.userProfiles.get(t).email||"Unknown user"," ")}}function qt(t,e){if(1&t&&(a.Rb(0,"td",18),a.Cc(1,Nt,2,1,"ng-container",2),a.Qb()),2&t){const t=e.$implicit,i=a.dc(5);a.Ab(1),a.jc("ngIf",i.userProfiles.has(t))}}function _t(t,e){1&t&&(a.Rb(0,"th",17),a.Ec(1,"Actions"),a.Qb())}function zt(t,e){if(1&t){const t=a.Sb();a.Pb(0),a.Rb(1,"button",40),a.Zb("click",(function(){a.rc(t);const e=a.dc().$implicit;return a.dc(5).resendInvite(e)})),a.Ec(2,"Resend Invite"),a.Qb(),a.Rb(3,"button",28),a.Zb("click",(function(){a.rc(t);const e=a.dc().$implicit;return a.dc(5).cancelShare(e)})),a.Ec(4,"Cancel Invite"),a.Qb(),a.Ob()}}function Jt(t,e){1&t&&(a.Pb(0),a.Mb(1,"mat-progress-bar",5),a.Ob())}function Yt(t,e){if(1&t&&(a.Rb(0,"td",26),a.Cc(1,zt,5,0,"ng-container",2),a.Cc(2,Jt,2,0,"ng-container",2),a.Qb()),2&t){const t=e.$implicit,i=a.dc(5);a.Ab(1),a.jc("ngIf",!i.dirtyEnvPerms[t].saving),a.Ab(1),a.jc("ngIf",i.dirtyEnvPerms[t].saving)}}function Ht(t,e){1&t&&a.Mb(0,"tr",29)}function Kt(t,e){1&t&&a.Mb(0,"tr",30)}const Vt=function(){return["email","actions"]};function Bt(t,e){if(1&t&&(a.Pb(0),a.Rb(1,"h4",39),a.Ec(2,"Pending Invites"),a.Qb(),a.Rb(3,"table",7),a.Pb(4,8),a.Cc(5,Gt,1,0,"th",9),a.Cc(6,qt,2,1,"td",10),a.Ob(),a.Pb(7,12),a.Cc(8,_t,2,0,"th",9),a.Cc(9,Yt,3,2,"td",13),a.Ob(),a.Cc(10,Ht,1,0,"tr",14),a.Cc(11,Kt,1,0,"tr",15),a.Qb(),a.Ob()),2&t){const t=a.dc(4);a.Ab(3),a.jc("dataSource",t.getInviteIds()),a.Ab(7),a.jc("matHeaderRowDef",a.kc(3,Vt)),a.Ab(1),a.jc("matRowDefColumns",a.kc(4,Vt))}}function Xt(t,e){if(1&t&&(a.Rb(0,"mat-option",25),a.Ec(1),a.ec(2,"titlecase"),a.Qb()),2&t){const t=e.$implicit;a.jc("value",t.value),a.Ab(1),a.Gc(" ",a.fc(2,2,t.key)," ")}}function te(t,e){if(1&t){const t=a.Sb();a.Pb(0),a.Cc(1,Bt,12,5,"ng-container",2),a.Rb(2,"form",31),a.Zb("submit",(function(){return a.rc(t),a.dc(3).share()})),a.Rb(3,"mat-grid-list",32),a.Rb(4,"mat-grid-tile",33),a.Rb(5,"mat-form-field"),a.Rb(6,"mat-label"),a.Ec(7,"Email"),a.Qb(),a.Mb(8,"input",34),a.Qb(),a.Qb(),a.Rb(9,"mat-grid-tile",35),a.Rb(10,"mat-form-field"),a.Rb(11,"mat-label"),a.Ec(12,"Permissions"),a.Qb(),a.Rb(13,"mat-select",36),a.Cc(14,Xt,3,4,"mat-option",24),a.ec(15,"keyvalue"),a.Qb(),a.Qb(),a.Qb(),a.Rb(16,"mat-grid-tile",37),a.Rb(17,"button",38),a.Ec(18,"Add"),a.Qb(),a.Qb(),a.Qb(),a.Qb(),a.Ob()}if(2&t){const t=a.dc(3);a.Ab(1),a.jc("ngIf",t.getInviteIds().length>0),a.Ab(1),a.jc("formGroup",t.form),a.Ab(12),a.jc("ngForOf",a.gc(15,3,t.envPermissions,t.originalOrder))}}const ee=function(){return["email","perm","actions"]},ie=function(){return["email","perm"]};function ne(t,e){if(1&t&&(a.Pb(0),a.Cc(1,Ct,2,0,"h4",6),a.Pb(2),a.Rb(3,"table",7),a.Pb(4,8),a.Cc(5,xt,1,0,"th",9),a.Cc(6,jt,2,1,"td",10),a.Ob(),a.Pb(7,11),a.Cc(8,Ot,2,0,"th",9),a.Cc(9,Dt,3,2,"td",10),a.Ob(),a.Pb(10,12),a.Cc(11,$t,2,0,"th",9),a.Cc(12,Tt,3,2,"td",13),a.Ob(),a.Cc(13,Zt,1,0,"tr",14),a.Cc(14,Ut,1,0,"tr",15),a.Qb(),a.Ob(),a.Cc(15,te,19,6,"ng-container",2),a.Ob()),2&t){const t=a.dc(2);a.Ab(1),a.jc("ngIf",!t.userIsAdmin),a.Ab(2),a.jc("dataSource",t.getUserWithPermIds()),a.Ab(10),a.jc("matHeaderRowDef",t.userIsAdmin?a.kc(5,ee):a.kc(6,ie)),a.Ab(1),a.jc("matRowDefColumns",t.userIsAdmin?a.kc(7,ee):a.kc(8,ie)),a.Ab(1),a.jc("ngIf",t.userIsAdmin)}}function ce(t,e){if(1&t&&(a.Pb(0),a.Cc(1,ne,16,9,"ng-container",2),a.Ob()),2&t){const t=a.dc();a.Ab(1),a.jc("ngIf",t.environment.remote)}}let se=(()=>{class t{constructor(t,e,i,n,c,o,a){this.fb=t,this.appEnvironmentService=e,this.workspaceService=i,this.authService=n,this.dialogService=c,this.dialogRef=o,this.data=a,this.loading=!0,this.userIsAdmin=!1,this.userProfiles=new Map,this.envPermissions=new Map([["read",s.a.Environment.EnvironmentPermissions.read],["write",s.a.Environment.EnvironmentPermissions.write],["admin",s.a.Environment.EnvironmentPermissions.admin],["owner",s.a.Environment.EnvironmentPermissions.owner]]),this.subs=new r.a,this.originalOrder=(t,e)=>0,this.publishStack=()=>Object(pt.a)(this,void 0,void 0,(function*(){})),this.publishWorkspace=()=>Object(pt.a)(this,void 0,void 0,(function*(){this.loading=!0,this.subs.add(this.workspaceService.publishWorkspace(this.environment.id).pipe(Object(kt.a)(t=>Object(ft.a)([Object(vt.a)(t),this.workspaceService.userWorkspaces().pipe(Object(k.a)(1))]))).subscribe(([t,e])=>{this.environment=e.find(e=>e.id===t.id),this.setupShareSettings(),this.loading=!1},t=>{this.dialogService.openAlertDialog({title:"Publish Workspace",text:"Error: "+(t.message||"Server error!")}),this.loading=!1}))})),this.environment=a.environment,this.environmentType=a.type,this.subs.add(this.authService.user$.subscribe(t=>{t&&(this.userId=t.uid)}))}ngOnInit(){this.environment.remote?(this.setupShareSettings(),this.loading=!1):this.publish()}run(t,e){return"stack"===this.environmentType?t():"workspace"===this.environmentType?e():void 0}setupShareSettings(){var t;return Object(pt.a)(this,void 0,void 0,(function*(){this.userIsAdmin=(null===(t=this.environment.remote)||void 0===t?void 0:t.permissions[this.userId].permission)>=this.envPermissions.get("admin"),this.dirtyEnvPerms=Object.entries(gt.merge(this.environment.remote.invites,this.environment.remote.permissions)).reduce((t,e)=>(t[e[0]]=Object.assign(Object.assign({},e[1]),{saving:!1}),t),{}),this.form=this.fb.group({emailToAdd:["",[m.E.required,m.E.email]],permission:[this.envPermissions.get("read"),[m.E.required]]}),yield this.getUserProfilesForEnvironment()}))}getUserProfilesForEnvironment(){return Object(pt.a)(this,void 0,void 0,(function*(){(yield this.workspaceService.getUserProfilesFor(this.environment.remote.id).pipe(Object(k.a)(1)).toPromise()).forEach(t=>this.userProfiles.set(t.uid,t))}))}getUserWithPermIds(){var t;return Object.keys((null===(t=this.environment.remote)||void 0===t?void 0:t.permissions)||{}).sort((t,e)=>this.environment.remote.permissions[t].permission<=this.environment.remote.permissions[e].permission?1:-1)}getInviteIds(){var t;return Object.keys((null===(t=this.environment.remote)||void 0===t?void 0:t.invites)||{})}ngOnDestroy(){this.subs.unsubscribe()}close(){this.dialogRef.close()}convertPermissionToString(t){switch(t){case s.a.Environment.EnvironmentPermissions.read:return"Read";case s.a.Environment.EnvironmentPermissions.write:return"Write";case s.a.Environment.EnvironmentPermissions.admin:return"Admin";case s.a.Environment.EnvironmentPermissions.owner:return"Owner"}}share(){this.form.disable();const{emailToAdd:t,permission:e}=this.form.getRawValue();this.workspaceService.share(this.environment.remote.id,t,e).pipe(Object(k.a)(1),Object(St.a)(()=>{this.form.enable()})).subscribe(t=>{const{userId:i}=t;this.environment.remote.invites[i]={permission:e},this.userProfiles.set(i,{username:"Loading...",email:"",uid:i}),this.dirtyEnvPerms[i]={permission:e,saving:!1},this.getUserProfilesForEnvironment(),this.form.reset()},t=>{this.dialogService.openAlertDialog({title:"Share Workspace",text:"Error while sharing"}),console.log(t)})}cancelShare(t){this.dirtyEnvPerms[t].saving=!0,this.workspaceService.cancelShare(this.environment.remote.id,t).pipe(Object(k.a)(1)).subscribe(()=>{delete this.environment.remote.invites[t],delete this.dirtyEnvPerms[t]},e=>{this.dialogService.openAlertDialog({title:"Share Workspace",text:""+(e.message||"Unknown error occurred!")}),this.dirtyEnvPerms[t].saving=!1})}resendInvite(t){this.dirtyEnvPerms[t].saving=!0,this.workspaceService.share(this.environment.remote.id,this.userProfiles.get(t).email,this.environment.remote.invites[t].permission).pipe(Object(k.a)(1)).subscribe(()=>{this.dialogService.openAlertDialog({title:"Send Invite",text:"Invite sent successfully."})},t=>{this.dialogService.openAlertDialog({title:"Send Invite",text:"Invite failed to be sent, please try again later."})},()=>{this.dirtyEnvPerms[t].saving=!1})}publish(){return Object(pt.a)(this,void 0,void 0,(function*(){yield this.run(this.publishStack,this.publishWorkspace)}))}save(t){this.dirtyEnvPerms[t].saving=!0,this.workspaceService.updateUserPermission(this.environment.remote.id,t,this.dirtyEnvPerms[t].permission).pipe(Object(k.a)(1)).toPromise().then(()=>{this.environment.remote.permissions[t].permission=this.dirtyEnvPerms[t].permission}).catch(e=>{this.dirtyEnvPerms[t].permission=this.environment.remote.permissions[t].permission,this.dialogService.openAlertDialog({title:"Sync Stack",text:""+(e.message||"Unknown error occurred!")})}).finally(()=>{this.dirtyEnvPerms[t].saving=!1})}revoke(t){t===this.environment.remote.owner?this.dialogService.openAlertDialog({title:"Revoke Access",text:"You cannot revoke the permissions of the original owner!"}):this.dialogService.openConfirmationDialog({title:"Revoke Access",text:"This will revoke all permissions from the user "+(this.userProfiles.get(t).username||this.userProfiles.get(t).email),button:{yes:"Revoke",no:"Cancel"}}).afterClosed().subscribe(e=>{!0===e&&(this.dirtyEnvPerms[t].saving=!0,this.workspaceService.revokeUserPermission(this.environment.remote.id,t).pipe(Object(k.a)(1)).toPromise().then(()=>{delete this.environment.remote.permissions[t],delete this.dirtyEnvPerms[t]}).catch(e=>{this.dialogService.openAlertDialog({title:"Revoke Access",text:"Error: "+(e.message||"Unknown error occurred!")}),this.dirtyEnvPerms[t].saving=!1}))})}}return t.\u0275fac=function(e){return new(e||t)(a.Lb(m.f),a.Lb(b.a),a.Lb(S.a),a.Lb(d.a),a.Lb(W.a),a.Lb(l.h),a.Lb(l.a))},t.\u0275cmp=a.Fb({type:t,selectors:[["new-environment-dialog"]],decls:8,vars:3,consts:[["mat-dialog-title",""],["mat-dialog-content",""],[4,"ngIf"],["mat-dialog-actions","",3,"align"],["mat-button","","mat-dialog-close",""],["mode","indeterminate"],["class","text-grey",4,"ngIf"],["mat-table","",1,"permTable",3,"dataSource"],["matColumnDef","email"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","perm"],["matColumnDef","actions"],["mat-cell","","class","tableActions",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],[1,"text-grey"],["mat-header-cell",""],["mat-cell",""],["class","pt-1",4,"ngIf"],[1,"pt-1"],["class","text-muted text-small",4,"ngIf"],[1,"text-muted","text-small"],[3,"value","valueChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["mat-cell","",1,"tableActions"],["mat-button","","mat-raised-button","","color","primary",3,"disabled","click"],["mat-button","","mat-raised-button","","color","warn",3,"click"],["mat-header-row",""],["mat-row",""],[3,"formGroup","submit"],["cols","7"],["colspan","4"],["type","email","matInput","","formControlName","emailToAdd"],["colspan","2"],["formControlName","permission"],["colspan","1"],["mat-button","","mat-raised-button","","color","primary","type","submit"],[2,"margin-top","15px","margin-bottom","0"],["mat-button","","mat-raised-button","","color","primary",3,"click"]],template:function(t,e){1&t&&(a.Rb(0,"h1",0),a.Ec(1,"Share Settings"),a.Qb(),a.Rb(2,"div",1),a.Cc(3,wt,4,0,"ng-container",2),a.Cc(4,ce,2,1,"ng-container",2),a.Qb(),a.Rb(5,"div",3),a.Rb(6,"button",4),a.Ec(7,"Close"),a.Qb(),a.Qb()),2&t&&(a.Ab(3),a.jc("ngIf",e.loading),a.Ab(1),a.jc("ngIf",!e.loading),a.Ab(1),a.jc("align","end"))},directives:[l.i,l.f,n.t,l.c,v.b,l.d,Q.a,Et.j,Et.c,Et.e,Et.b,Et.g,Et.i,Et.d,Et.a,Rt.a,n.s,It.i,Et.f,Et.h,m.G,m.r,m.j,yt.a,yt.c,p.c,p.g,f.a,m.c,m.q,m.i],pipes:[n.l,n.F],styles:["mat-form-field[_ngcontent-%COMP%]{width:100%;padding:0 5px}.permTable[_ngcontent-%COMP%]{width:100%}.tableActions[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{margin-right:5px}"]}),t})();var re=i("3E0/"),oe=i("MrDi");function ae(t,e){if(1&t){const t=a.Sb();a.Rb(0,"div",6),a.Rb(1,"div",7),a.Ec(2),a.Qb(),a.Rb(3,"file-path",8),a.Zb("onSelectedPath",(function(e){return a.rc(t),a.dc().setCodebasePath(e)})),a.Qb(),a.Qb()}if(2&t){const t=a.dc();a.Ab(2),a.Gc("Workspace path: ",t.codebasePath,""),a.Ab(1),a.jc("rootPath",t.codebasePath)("foldersOnly",!0)}}function be(t,e){1&t&&(a.Rb(0,"div",9),a.Rb(1,"div"),a.Ec(2,"Installing..."),a.Qb(),a.Mb(3,"mat-progress-bar",10),a.Qb())}function le(t,e){if(1&t&&(a.Pb(0),a.Rb(1,"div",11),a.Mb(2,"i",12),a.Rb(3,"span",13),a.Ec(4),a.Qb(),a.Ec(5),a.Qb(),a.Ob()),2&t){const t=a.dc();a.Ab(4),a.Fc(t.data.workspace.name),a.Ab(1),a.Gc(" installed into ",t.codebasePath,". ")}}function de(t,e){if(1&t&&(a.Pb(0),a.Rb(1,"div",14),a.Rb(2,"div",15),a.Mb(3,"i",16),a.Ec(4," Failed to install "),a.Rb(5,"span",13),a.Ec(6),a.Qb(),a.Ec(7),a.Qb(),a.Rb(8,"div",17),a.Ec(9),a.Qb(),a.Qb(),a.Ob()),2&t){const t=a.dc();a.Ab(6),a.Fc(t.data.workspace.name),a.Ab(1),a.Gc(" into ",t.codebasePath,". Please try again later "),a.Ab(2),a.Gc(" Error: ",t.errorMessage," ")}}function ue(t,e){if(1&t){const t=a.Sb();a.Pb(0),a.Rb(1,"button",18),a.Ec(2,"Cancel"),a.Qb(),a.Rb(3,"button",19),a.Zb("click",(function(){return a.rc(t),a.dc().create()})),a.Ec(4,"Install"),a.Qb(),a.Ob()}if(2&t){const t=a.dc();a.Ab(3),a.jc("disabled",!t.codebasePath)}}function me(t,e){1&t&&(a.Pb(0),a.Rb(1,"button",18),a.Ec(2,"Close"),a.Qb(),a.Ob())}let pe=(()=>{class t{constructor(t,e,i,n,c){this.fb=t,this.appEnvironmentService=e,this.data=i,this.workspaceService=n,this.dialogRef=c,this.actionState=C.a,this.currentState=C.a.IDLE,this.subs=new r.a}ngOnInit(){}setCodebasePath(t){this.codebasePath=t}ngOnDestroy(){this.subs.unsubscribe()}close(){this.dialogRef.close({success:this.currentState===C.a.SUCCESS})}create(){this.currentState=C.a.ACQUIRING,this.workspaceService.install(this.data.workspace,this.codebasePath).pipe(Object(k.a)(1),Object(re.a)(500)).subscribe(t=>{this.currentState=C.a.SUCCESS},t=>{var e;this.errorMessage=(null===(e=t.error)||void 0===e?void 0:e.message)||"Server error!",this.currentState=C.a.FAILED})}}return t.\u0275fac=function(e){return new(e||t)(a.Lb(m.f),a.Lb(b.a),a.Lb(l.a),a.Lb(S.a),a.Lb(l.h))},t.\u0275cmp=a.Fb({type:t,selectors:[["new-environment-dialog"]],decls:12,vars:8,consts:[["mat-dialog-title",""],[1,"text-underline","text-capitalize"],["mat-dialog-content","",4,"ngIf"],["class","text-center p-2",4,"ngIf"],[4,"ngIf"],["mat-dialog-actions","",3,"align"],["mat-dialog-content",""],[1,"text-capitalize","pb-1","text-muted","text-tiny"],[3,"rootPath","foldersOnly","onSelectedPath"],[1,"text-center","p-2"],["mode","indeterminate"],[1,"text-center","p-2","text-success"],[1,"fa","fa-check","mr-2"],[1,"text-capitalize"],[1,"text-center","p-2","text-red"],[1,""],[1,"fa","fa-times-circle","mr-2"],[1,"p-2","text-small","text-muted"],["mat-button","","mat-dialog-close",""],["mat-button","",3,"disabled","click"]],template:function(t,e){1&t&&(a.Rb(0,"h1",0),a.Ec(1,"Install "),a.Rb(2,"span",1),a.Ec(3),a.Qb(),a.Ec(4," Workspace"),a.Qb(),a.Cc(5,ae,4,3,"div",2),a.Cc(6,be,4,0,"div",3),a.Cc(7,le,6,2,"ng-container",4),a.Cc(8,de,10,3,"ng-container",4),a.Rb(9,"div",5),a.Cc(10,ue,5,1,"ng-container",4),a.Cc(11,me,3,0,"ng-container",4),a.Qb()),2&t&&(a.Ab(3),a.Fc(e.data.workspace.name),a.Ab(2),a.jc("ngIf",e.currentState==e.actionState.IDLE),a.Ab(1),a.jc("ngIf",e.currentState===e.actionState.ACQUIRING),a.Ab(1),a.jc("ngIf",e.currentState===e.actionState.SUCCESS),a.Ab(1),a.jc("ngIf",e.currentState===e.actionState.FAILED),a.Ab(1),a.jc("align","end"),a.Ab(1),a.jc("ngIf",e.currentState===e.actionState.IDLE),a.Ab(1),a.jc("ngIf",e.currentState===e.actionState.FAILED||e.currentState===e.actionState.SUCCESS))},directives:[l.i,n.t,l.c,l.f,oe.a,Q.a,v.b,l.d],styles:[".mat-form-field[_ngcontent-%COMP%], .mat-radio-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin:15px 0}.mat-radio-button[_ngcontent-%COMP%]{margin:5px}"]}),t})();function fe(t,e){1&t&&(a.Rb(0,"div",12),a.Ec(1,"No workspaces present"),a.Qb())}function ve(t,e){if(1&t){const t=a.Sb();a.Rb(0,"div",15),a.Rb(1,"div",16),a.Rb(2,"div",17),a.Rb(3,"div",18),a.Rb(4,"div"),a.Ec(5),a.ec(6,"titlecase"),a.Qb(),a.Rb(7,"div",19),a.Ec(8),a.ec(9,"titlecase"),a.Qb(),a.Qb(),a.Rb(10,"div"),a.Rb(11,"button",20),a.Zb("click",(function(){a.rc(t);const i=e.$implicit;return a.dc(3).acceptInvite(i.eid)})),a.Ec(12,"Accept"),a.Qb(),a.Rb(13,"button",20),a.Zb("click",(function(){a.rc(t);const i=e.$implicit;return a.dc(3).declineInvite(i.eid)})),a.Ec(14,"Decline"),a.Qb(),a.Qb(),a.Qb(),a.Qb(),a.Qb()}if(2&t){const t=e.$implicit;a.Ab(5),a.Fc(a.fc(6,2,t.name)),a.Ab(3),a.Gc("Owner: ",a.fc(9,4,t.owner.displayName)||t.owner.email,"")}}function he(t,e){if(1&t&&(a.Pb(0),a.Rb(1,"div",13),a.Ec(2,"Workspace Invites"),a.Qb(),a.Cc(3,ve,15,6,"div",14),a.Ob()),2&t){const t=a.dc(2);a.Ab(3),a.jc("ngForOf",t.invites)}}const ge=function(t){return{workspaces:t}};function ke(t,e){if(1&t&&(a.Pb(0),a.Rb(1,"div",21),a.Ec(2,"Remote Workspaces"),a.Qb(),a.Mb(3,"div",11),a.Ob()),2&t){const t=a.dc(2),e=a.oc(2);a.Ab(3),a.jc("ngTemplateOutlet",e)("ngTemplateOutletContext",a.lc(2,ge,t.workspaceList.remote))}}const Se=function(t){return[t]};function Ee(t,e){if(1&t){const t=a.Sb();a.Pb(0),a.Rb(1,"div",2),a.Rb(2,"div",3),a.Cc(3,fe,2,0,"div",4),a.Rb(4,"div",5),a.Cc(5,he,4,1,"ng-container",0),a.Rb(6,"div",6),a.Rb(7,"div",7),a.Ec(8,"My Workspaces"),a.Qb(),a.Rb(9,"div",8),a.Rb(10,"button",9),a.Zb("click",(function(){return a.rc(t),a.dc().createNewWorkspace()})),a.Mb(11,"i",10),a.Ec(12," New Workspace"),a.Qb(),a.Qb(),a.Qb(),a.Mb(13,"div",11),a.Mb(14,"div",11),a.Cc(15,ke,4,4,"ng-container",0),a.Qb(),a.Qb(),a.Qb(),a.Ob()}if(2&t){const t=a.dc(),e=a.oc(2);a.Ab(3),a.jc("ngIf",0===t.workspaces.length),a.Ab(2),a.jc("ngIf",t.invites.length>0),a.Ab(8),a.jc("ngTemplateOutlet",e)("ngTemplateOutletContext",a.lc(9,ge,a.lc(7,Se,t.workspaceList.system))),a.Ab(1),a.jc("ngTemplateOutlet",e)("ngTemplateOutletContext",a.lc(11,ge,t.workspaceList.local)),a.Ab(1),a.jc("ngIf",(null==t.workspaceList||null==t.workspaceList.remote?null:t.workspaceList.remote.length)>0)}}function Re(t,e){if(1&t){const t=a.Sb();a.Rb(0,"div",32),a.Rb(1,"button",30),a.Zb("click",(function(){a.rc(t);const e=a.dc().$implicit;return a.dc(2).install(e)})),a.Mb(2,"i",33),a.Qb(),a.Qb()}}function Ie(t,e){if(1&t){const t=a.Sb();a.Rb(0,"div",5),a.Rb(1,"button",34),a.Zb("click",(function(){a.rc(t);const e=a.dc().$implicit;return a.dc(2).switchEnvironment(e)})),a.Mb(2,"i",35),a.Qb(),a.Qb()}if(2&t){const t=a.dc().$implicit,e=a.dc(2);a.Ab(1),a.jc("disabled",e.isCurrentEnv(t))}}function ye(t,e){if(1&t){const t=a.Sb();a.Rb(0,"div",5),a.Rb(1,"button",37),a.Zb("click",(function(){a.rc(t);const e=a.dc(2).$implicit;return a.dc(2).publish(e)})),a.Mb(2,"i",38),a.Ec(3," Push your changes"),a.Qb(),a.Qb()}2&t&&(a.Ab(1),a.jc("title","Push Your Changes"))}function we(t,e){if(1&t){const t=a.Sb();a.Rb(0,"div",5),a.Rb(1,"button",37),a.Zb("click",(function(){a.rc(t);const e=a.dc(2).$implicit;return a.dc(2).sync(e)})),a.Mb(2,"i",33),a.Ec(3," Pull new updates"),a.Qb(),a.Qb()}2&t&&(a.Ab(1),a.jc("title","Pull New Updates"))}function Ce(t,e){1&t&&(a.Rb(0,"div",39),a.Ec(1,"Requires merge!"),a.Qb())}function xe(t,e){if(1&t&&(a.Pb(0),a.Cc(1,ye,4,1,"div",25),a.Cc(2,we,4,1,"div",25),a.Cc(3,Ce,2,0,"div",36),a.Ob()),2&t){const t=a.dc().$implicit;a.Ab(1),a.jc("ngIf",!t.remote.isClean),a.Ab(1),a.jc("ngIf",t.localVersion!=(null==t.remote?null:t.remote.version)),a.Ab(1),a.jc("ngIf",null==t.remote?null:t.remote.requiresMerge)}}function Ae(t,e){1&t&&a.Mb(0,"mat-progress-bar",40)}function Qe(t,e){if(1&t){const t=a.Sb();a.Pb(0),a.Rb(1,"button",37),a.Zb("click",(function(){a.rc(t);const e=a.dc().$implicit;return a.dc(2).install(e)})),a.Mb(2,"i",33),a.Ec(3," Install Workspace "),a.Qb(),a.Ob()}2&t&&(a.Ab(1),a.jc("title","Install Workspace"))}function je(t,e){1&t&&(a.Rb(0,"div",52),a.Mb(1,"i",53),a.Ec(2," Shared"),a.Qb())}function Oe(t,e){1&t&&(a.Rb(0,"div",54),a.Mb(1,"i",55),a.Ec(2," Local"),a.Qb())}function Pe(t,e){if(1&t){const t=a.Sb();a.Rb(0,"button",48),a.Zb("click",(function(){a.rc(t);const e=a.dc(2).$implicit;return a.dc(2).renameWorkspace(e)})),a.Ec(1,"Rename Workspace"),a.Qb()}if(2&t){const t=a.dc(2).$implicit;a.jc("disabled",t.remoteOnly)}}function Me(t,e){if(1&t){const t=a.Sb();a.Rb(0,"button",48),a.Zb("click",(function(){a.rc(t);const e=a.dc(2).$implicit;return a.dc(2).deleteWorkspace(e)})),a.Ec(1,"Delete Workspace"),a.Qb()}if(2&t){const t=a.dc(2).$implicit;a.jc("disabled",t.remoteOnly)}}function Le(t,e){if(1&t){const t=a.Sb();a.Rb(0,"button",51),a.Zb("click",(function(){a.rc(t);const e=a.dc(2).$implicit;return a.dc(2).purgeWorkspace(e)})),a.Ec(1,"Purge Workspace"),a.Qb()}}function De(t,e){if(1&t){const t=a.Sb();a.Rb(0,"div",41),a.Rb(1,"div",15),a.Rb(2,"p",42),a.Ec(3),a.Qb(),a.Cc(4,je,3,0,"div",43),a.Cc(5,Oe,3,0,"div",44),a.Rb(6,"div",45),a.Mb(7,"i",46),a.Ec(8),a.Qb(),a.Qb(),a.Rb(9,"div",47),a.Rb(10,"button",48),a.Zb("click",(function(){a.rc(t);const e=a.dc().$implicit;return a.dc(2).switchEnvironment(e)})),a.Ec(11,"Switch To This Workspace"),a.Qb(),a.Cc(12,Pe,2,1,"button",49),a.Cc(13,Me,2,1,"button",49),a.Cc(14,Le,2,0,"button",50),a.Rb(15,"button",51),a.Zb("click",(function(){a.rc(t);const e=a.dc().$implicit;return a.dc(2).shareWorkspace(e)})),a.Rb(16,"span"),a.Ec(17,"Share Workspace "),a.Qb(),a.Qb(),a.Qb(),a.Qb()}if(2&t){const t=a.dc().$implicit,e=a.dc(2);a.Ab(3),a.Fc(t.description||"No description"),a.Ab(1),a.jc("ngIf",t.remote),a.Ab(1),a.jc("ngIf",!t.remote&&t.isLocal),a.Ab(3),a.Gc(" ",t.codebasePath,""),a.Ab(2),a.jc("disabled",e.isCurrentEnv(t)||t.remoteOnly),a.Ab(2),a.jc("ngIf",!t.isSystemWorkspace),a.Ab(1),a.jc("ngIf",!t.isSystemWorkspace),a.Ab(1),a.jc("ngIf",t.remoteOnly&&t.remote.owner===(null==e.user?null:e.user.uid))}}function $e(t,e){if(1&t){const t=a.Sb();a.Rb(0,"div",15),a.Rb(1,"div",16),a.Rb(2,"div",22),a.Rb(3,"div",23),a.Cc(4,Re,3,0,"div",24),a.Cc(5,Ie,3,1,"div",25),a.Qb(),a.Rb(6,"div",5),a.Mb(7,"i",26),a.Qb(),a.Rb(8,"div",27),a.Zb("click",(function(){a.rc(t);const i=e.$implicit;return a.dc(2).toggleItemList(i)})),a.Rb(9,"div",5),a.Ec(10),a.Qb(),a.Rb(11,"div",19),a.Ec(12),a.Qb(),a.Qb(),a.Rb(13,"div",8),a.Cc(14,xe,4,3,"ng-container",0),a.Cc(15,Ae,1,0,"mat-progress-bar",28),a.Cc(16,Qe,4,1,"ng-container",0),a.Qb(),a.Rb(17,"div",29),a.Rb(18,"button",30),a.Zb("click",(function(){a.rc(t);const i=e.$implicit;return a.dc(2).toggleItemList(i)})),a.Mb(19,"i",26),a.Qb(),a.Qb(),a.Qb(),a.Cc(20,De,18,8,"div",31),a.Qb(),a.Qb()}if(2&t){const t=e.$implicit,i=a.dc(2);a.Ab(2),a.Db("workspace-disabled",t.disabled),a.Ab(2),a.jc("ngIf",t.remoteOnly),a.Ab(1),a.jc("ngIf",!t.remoteOnly),a.Ab(2),a.Db("text-primary",i.isCurrentEnv(t))("text-muted",!i.isCurrentEnv(t))("fa-dice-d6",!t.isSystemWorkspace)("fa-desktop",t.isSystemWorkspace),a.Ab(1),a.Db("text-primary",i.isCurrentEnv(t)),a.Ab(2),a.Fc(t.name),a.Ab(2),a.Fc(t.codebasePath),a.Ab(2),a.jc("ngIf",!t.remoteOnly&&!!t.remote&&!i.activeRequest[t.id]),a.Ab(1),a.jc("ngIf",i.activeRequest[t.id]),a.Ab(1),a.jc("ngIf",t.remoteOnly),a.Ab(3),a.Db("fa-chevron-up",i.isItemOpen(t))("fa-chevron-down",!i.isItemOpen(t)),a.Ab(1),a.jc("ngIf",i.isItemOpen(t))}}function Fe(t,e){1&t&&a.Cc(0,$e,21,24,"div",14),2&t&&a.jc("ngForOf",e.workspaces)}let We=(()=>{class t{constructor(t,e,i,n,c,s){this.appEnvironmentService=t,this.dialogService=e,this.dialog=i,this.authService=n,this.workspaceService=c,this.myItemsService=s,this.invites=[],this.activeRequest={},this.itemList={},this.subs=new r.a}ngOnInit(){this.getEnvironments(),this.getPendingInvites(),this.subs.add(this.authService.user$.subscribe(t=>this.user=t))}toggleItemList(t){var e,i;const n=null!==(e=t.id)&&void 0!==e?e:null===(i=t.remote)||void 0===i?void 0:i.id;this.itemList[n]=!this.itemList[n]}isItemOpen(t){var e,i;return this.itemList[null!==(e=t.id)&&void 0!==e?e:null===(i=t.remote)||void 0===i?void 0:i.id]}getEnvironments(){this.workspaceService.userWorkspaces().subscribe(t=>{const e=(t,e)=>{var i,n;return(null===(i=t.name)||void 0===i?void 0:i.toLowerCase())>(null===(n=e.name)||void 0===n?void 0:n.toLowerCase())?1:-1},i=t.sort(e),n=t.find(t=>t.isSystemWorkspace),c=t.filter(t=>!t.remoteOnly&&!t.isSystemWorkspace),s=t.filter(t=>t.remoteOnly).sort(e),r=c.filter(t=>!t.disabled).sort(e),o=c.filter(t=>t.disabled).sort(e);this.workspaceList={system:n,local:[...r,...o],remote:s},this.workspaces=i}),this.subs.add(this.appEnvironmentService.currentEnvironment$.subscribe(t=>this.currentEnvironment=t))}getPendingInvites(){this.subs.add(this.workspaceService.pendingInvites$.subscribe(t=>{this.invites=t}))}createNewWorkspace(){this.isLoggedIn()?this.myItemsService.createNewWorkspace().afterClosed().subscribe(()=>this.getEnvironments()):this.dialogService.openMustLoginDialog()}isLoggedIn(){return!!this.user}ngOnDestroy(){this.subs.unsubscribe()}deleteWorkspace(t){const e=this.dialog.open(g.a,{data:{title:`Delete workspace ${t.name}?`,text:"Deleting this workspace is a permanent action and cannot be undone.",button:{yes:"Delete",no:"Cancel"}},position:{top:"100px"},autoFocus:!0});Object(u.a)([e.afterClosed(),this.appEnvironmentService.currentEnvironment$.pipe(Object(k.a)(1))]).subscribe(([e,i])=>{!0===e&&this.workspaceService.delete(t.id).subscribe(()=>{t.id===i.id&&this.dialog.open(w,{data:{},disableClose:!0,position:{top:"100px"},autoFocus:!0}).afterClosed().subscribe(t=>console.log("dialog result: ",t)),this.getEnvironments()})})}purgeWorkspace(t){const e=this.dialogService.openConfirmationDialog({title:`Purge workspace ${t.name}?`,text:"Purging this workspace will remove it from the stackjoy servers completely. This is a permanent action and cannot be undone.",button:{yes:"Purge",no:"Cancel"}});Object(u.a)([e.afterClosed(),this.appEnvironmentService.currentEnvironment$.pipe(Object(k.a)(1))]).subscribe(([e,i])=>{!1!==e&&this.workspaceService.purge(t.remote.id).subscribe(()=>{this.dialogService.openAlertDialog({title:"Purge Workspace",text:`Workspace ${t.name} purged successfully`}),this.getEnvironments()},t=>{this.dialogService.openAlertDialog({title:"Purge Workspace",text:"Something went wrong: "+(t.message||"Unknown error occurred...")})})})}isCurrentEnv(t){var e;return(null===(e=this.currentEnvironment)||void 0===e?void 0:e.id)===t.id}switchEnvironment(t){this.appEnvironmentService.switchToEnvironment(t.id).subscribe(()=>null)}shareWorkspace(t){this.user?this.dialog.open(se,{data:{environment:t,type:"workspace"},width:"50vw",maxWidth:"800px",minWidth:"500px",position:{top:"100px"},autoFocus:!0}).afterClosed().subscribe(()=>{this.getEnvironments()}):this.dialogService.openMustLoginDialog()}renameWorkspace(t){this.dialog.open(h,{data:{environment:t},width:"500px",position:{top:"100px"},autoFocus:!0}).afterClosed().subscribe(t=>{t.success&&this.getEnvironments()})}publish(t){var e;return Object(pt.a)(this,void 0,void 0,(function*(){(null===(e=t.remote)||void 0===e?void 0:e.requiresMerge)?this.dialogService.openAlertDialog({title:"Publish Workspace",text:"There are pending changes for this workspace. Please merge changes before publishing."}):(this.activeRequest[t.id]=!0,this.workspaceService.publishWorkspace(t.id).pipe(Object(k.a)(1),Object(re.a)(1e3),Object(St.a)(()=>{this.activeRequest[t.id]=!1})).subscribe(t=>{this.dialogService.openAlertDialog({title:"Publish Workspace",text:"Workspace has been published successfully"}),this.getEnvironments()},t=>{this.dialogService.openAlertDialog({title:"Publish Workspace",text:"Error publishing: "+(t.message||"Server error!")})}))}))}sync(t){if(!t.localVersion)return this.install(t);this.activeRequest[t.id]=!0,this.workspaceService.syncWorkspace(t.id,t.remote.version).pipe(Object(k.a)(1),Object(re.a)(1e3),Object(St.a)(()=>{this.activeRequest[t.id]=!1})).subscribe(t=>{this.dialogService.openAlertDialog({title:"Sync Workspace",text:"Stack has been synced"}),this.getEnvironments()},t=>{var e;this.dialogService.openAlertDialog({title:"Sync Workspace",text:"Error while syncing: "+((null===(e=t.error)||void 0===e?void 0:e.message)||"Server error!")})})}install(t){this.dialog.open(pe,{data:{workspace:t},width:"500px",position:{top:"100px"},autoFocus:!0}).afterClosed().subscribe(t=>{this.getEnvironments()})}acceptInvite(t){return Object(pt.a)(this,void 0,void 0,(function*(){this.workspaceService.acceptInvite(t).pipe(Object(k.a)(1)).subscribe(()=>{this.workspaceService.fetchPendingInvites()})}))}declineInvite(t){return Object(pt.a)(this,void 0,void 0,(function*(){this.workspaceService.declineInvite(t).pipe(Object(k.a)(1)).subscribe(()=>{this.workspaceService.fetchPendingInvites()})}))}}return t.\u0275fac=function(e){return new(e||t)(a.Lb(b.a),a.Lb(W.a),a.Lb(l.b),a.Lb(d.a),a.Lb(S.a),a.Lb(Z.a))},t.\u0275cmp=a.Fb({type:t,selectors:[["my-workspaces"]],decls:3,vars:1,consts:[[4,"ngIf"],["workspaceListTemplate",""],[1,"pt-3",2,"max-width","800px"],[1,"pl-3"],["class","text center",4,"ngIf"],[1,""],[1,"pl-2","d-flex","align-items-start"],[1,"text-bold","py-2"],[1,"ml-auto"],["mat-button","",3,"click"],[1,"fa","fa-plus"],[1,"",3,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"text","center"],[1,"text-bold","p-2"],["class","p-2",4,"ngFor","ngForOf"],[1,"p-2"],[1,"shadow","p-2","border","rounded"],[1,"d-flex","align-items-center","justify-content-between"],[1,"pl-3","cursor-pointer"],[1,"subheader"],["mat-raised-button","",3,"click"],[1,"text-bold","p-2","pt-4"],[1,"d-flex","align-items-center"],[1,"pr-3"],["class","","style","width:40px; height:40px;",4,"ngIf"],["class","",4,"ngIf"],[1,"fa"],[1,"pl-3","cursor-pointer",3,"click"],["mode","indeterminate",4,"ngIf"],[1,"ml-1"],["mat-button","","mat-icon-button","",3,"click"],["class","border-top p-2 d-flex align-items-start",4,"ngIf"],[1,"",2,"width","40px","height","40px"],[1,"fa","fa-download","text-muted"],["mat-button","","mat-icon-button","",3,"disabled","click"],[1,"fa","fa-exchange-alt"],["style","color: red",4,"ngIf"],["mat-button","",3,"title","click"],[1,"fa","fa-upload","text-muted"],[2,"color","red"],["mode","indeterminate"],[1,"border-top","p-2","d-flex","align-items-start"],[1,"my-2"],["class","text-muted text-small","matTooltip","This workspace is shared with other users",4,"ngIf"],["class","text-muted text-small","matTooltip","This workspace is present only on this machine",4,"ngIf"],[1,"text-small"],[1,"fa","fa-folder-open","mr-1"],[1,"ml-auto","p-2","border-left"],["mat-button","",1,"d-block",3,"disabled","click"],["mat-button","","class","d-block",3,"disabled","click",4,"ngIf"],["mat-button","","class","d-block",3,"click",4,"ngIf"],["mat-button","",1,"d-block",3,"click"],["matTooltip","This workspace is shared with other users",1,"text-muted","text-small"],[1,"fa","fa-users","mr-1"],["matTooltip","This workspace is present only on this machine",1,"text-muted","text-small"],[1,"fa","fa-desktop","mr-1"]],template:function(t,e){1&t&&(a.Cc(0,Ee,16,13,"ng-container",0),a.Cc(1,Fe,1,1,"ng-template",null,1,a.Dc)),2&t&&a.jc("ngIf",e.workspaces)},directives:[n.t,v.b,n.A,n.s,Q.a,_.a],pipes:[n.F],styles:[".subheader[_ngcontent-%COMP%]{font-size:9px;line-height:9px}.workspace-disabled[_ngcontent-%COMP%]{opacity:.5}"]}),t})();function Te(t,e){if(1&t){const t=a.Sb();a.Rb(0,"div",4),a.Zb("click",(function(){return a.rc(t),a.dc().selectSection("stacks")})),a.Mb(1,"i",8),a.Ec(2," My Stacks"),a.Qb()}if(2&t){const t=a.dc();a.Db("active","stacks"===t.selectedSection)}}function Ze(t,e){1&t&&(a.Pb(0),a.Mb(1,"my-stacks"),a.Ob())}function Ue(t,e){1&t&&(a.Pb(0),a.Mb(1,"my-workspaces"),a.Ob())}function Ge(t,e){if(1&t&&(a.Pb(0),a.Cc(1,Ze,2,0,"ng-container",7),a.Cc(2,Ue,2,0,"ng-container",7),a.Ob()),2&t){const t=a.dc();a.Ab(1),a.jc("ngIf","stacks"===t.selectedSection),a.Ab(1),a.jc("ngIf","workspaces"===t.selectedSection)}}const Ne=c.f.forChild([{path:"",component:(()=>{class t{constructor(t,e,i){this.appEnvironmentService=t,this.dialog=e,this.authService=i,this.selectedSection="workspaces",this.envType=s.a.Environment.Type,this.subs=new r.a}ngOnInit(){this.getEnvironments(),this.subs.add(this.authService.user$.subscribe(t=>this.user=t))}getEnvironments(){this.subs.add(this.appEnvironmentService.getAllEnvironments().subscribe(t=>this.environments=t)),this.subs.add(this.appEnvironmentService.currentEnvironment$.subscribe(t=>this.currentEnvironment=t))}createNewEnvironment(t){this.dialog.open(o.a,{data:{type:"workspaces"===t?s.a.Environment.Type.Workspace:s.a.Environment.Type.Stack},minWidth:"600px",position:{top:"100px"},autoFocus:!0}).afterClosed().subscribe(t=>this.getEnvironments())}ngOnDestroy(){}isCurrentEnv(t){return this.currentEnvironment.id===t.id}isWorkspace(t){return t.type===s.a.Environment.Type.Workspace}selectSection(t){this.selectedSection=t}switchEnvironment(t){this.appEnvironmentService.switchToEnvironment(t.id).subscribe(t=>null)}getEnvTypeLabel(t){return"workspaces"===t?"Workspace":"Stack"}}return t.\u0275fac=function(e){return new(e||t)(a.Lb(b.a),a.Lb(l.b),a.Lb(d.a))},t.\u0275cmp=a.Fb({type:t,selectors:[["my-items-list"]],decls:10,vars:4,consts:[[1,"p-2"],[1,"text-capitalize"],[1,"fa","fa-th-large","mt-1","mr-1"],[1,"page-tabs"],[3,"click"],[1,"fa","fa-dice-d6"],[3,"active","click",4,"ngIf"],[4,"ngIf"],[1,"fas","fa-layer-group"]],template:function(t,e){1&t&&(a.Rb(0,"div",0),a.Rb(1,"h2",1),a.Mb(2,"i",2),a.Ec(3," My Items "),a.Qb(),a.Rb(4,"div",3),a.Rb(5,"div",4),a.Zb("click",(function(){return e.selectSection("workspaces")})),a.Mb(6,"i",5),a.Ec(7," My Workspaces"),a.Qb(),a.Cc(8,Te,3,2,"div",6),a.Qb(),a.Cc(9,Ge,3,2,"ng-container",7),a.Qb()),2&t&&(a.Ab(5),a.Db("active","workspaces"===e.selectedSection),a.Ab(3),a.jc("ngIf",e.user),a.Ab(1),a.jc("ngIf",e.environments))},directives:[n.t,mt,We],styles:[""]}),t})(),children:[]}]);var qe=i("STbY"),_e=i("NFeN");let ze=(()=>{class t{}return t.\u0275mod=a.Jb({type:t}),t.\u0275inj=a.Ib({factory:function(e){return new(e||t)},providers:[],imports:[[n.c,v.c,Q.b]]}),t})(),Je=(()=>{class t{}return t.\u0275mod=a.Jb({type:t}),t.\u0275inj=a.Ib({factory:function(e){return new(e||t)},providers:[],imports:[[n.c,l.g,f.b,m.l,v.c,A.c,m.A,Rt.b]]}),t})(),Ye=(()=>{class t{}return t.\u0275mod=a.Jb({type:t}),t.\u0275inj=a.Ib({factory:function(e){return new(e||t)},providers:[],imports:[[n.c,l.g,f.b,m.l,v.c,A.c,m.A,Rt.b,Q.b]]}),t})(),He=(()=>{class t{}return t.\u0275mod=a.Jb({type:t}),t.\u0275inj=a.Ib({factory:function(e){return new(e||t)},providers:[],imports:[[n.c,v.c,qe.c,_e.b,ze,Je,_.b,Ye]]}),t})(),Ke=(()=>{class t{}return t.\u0275mod=a.Jb({type:t}),t.\u0275inj=a.Ib({factory:function(e){return new(e||t)},providers:[],imports:[[n.c,l.g,f.b,m.l,v.c,A.c,m.A,Rt.b]]}),t})(),Ve=(()=>{class t{}return t.\u0275mod=a.Jb({type:t}),t.\u0275inj=a.Ib({factory:function(e){return new(e||t)},providers:[],imports:[[n.c,v.c,Je,qe.c,_e.b,Q.b,_.b,Ke]]}),t})(),Be=(()=>{class t{}return t.\u0275mod=a.Jb({type:t}),t.\u0275inj=a.Ib({factory:function(e){return new(e||t)},providers:[],imports:[[n.c,Ne,He,v.c,Ve]]}),t})()},PE4B:function(t,e,i){"use strict";var n=function(t){return function(t){return!!t&&"object"==typeof t}(t)&&!function(t){var e=Object.prototype.toString.call(t);return"[object RegExp]"===e||"[object Date]"===e||function(t){return t.$$typeof===c}(t)}(t)},c="function"==typeof Symbol&&Symbol.for?Symbol.for("react.element"):60103;function s(t,e){return!1!==e.clone&&e.isMergeableObject(t)?b(Array.isArray(t)?[]:{},t,e):t}function r(t,e,i){return t.concat(e).map((function(t){return s(t,i)}))}function o(t){return Object.keys(t).concat(function(t){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(t).filter((function(e){return t.propertyIsEnumerable(e)})):[]}(t))}function a(t,e){try{return e in t}catch(i){return!1}}function b(t,e,i){(i=i||{}).arrayMerge=i.arrayMerge||r,i.isMergeableObject=i.isMergeableObject||n,i.cloneUnlessOtherwiseSpecified=s;var c=Array.isArray(e);return c===Array.isArray(t)?c?i.arrayMerge(t,e,i):function(t,e,i){var n={};return i.isMergeableObject(t)&&o(t).forEach((function(e){n[e]=s(t[e],i)})),o(e).forEach((function(c){(function(t,e){return a(t,e)&&!(Object.hasOwnProperty.call(t,e)&&Object.propertyIsEnumerable.call(t,e))})(t,c)||(n[c]=a(t,c)&&i.isMergeableObject(e[c])?function(t,e){if(!e.customMerge)return b;var i=e.customMerge(t);return"function"==typeof i?i:b}(c,i)(t[c],e[c],i):s(e[c],i))})),n}(t,e,i):s(e,i)}b.all=function(t,e){if(!Array.isArray(t))throw new Error("first argument should be an array");return t.reduce((function(t,i){return b(t,i,e)}),{})},t.exports=b}}]);