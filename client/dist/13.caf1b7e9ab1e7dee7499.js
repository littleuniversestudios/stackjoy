(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{xKL5:function(e,t,i){"use strict";i.r(t),i.d(t,"CodebaseTreeModule",(function(){return G}));var c=i("ofXK"),s=i("tyNb"),a=i("quSY"),r=i("XNiG"),n=i("Kj3r"),o=i("0IaG"),l=i("fXoL"),b=i("i4al"),d=i("bTqV");function m(e,t){if(1&e&&(l.Sb(0,"li",8),l.Ec(1),l.Rb()),2&e){const e=t.$implicit;l.Bb(1),l.Fc(e)}}let h=(()=>{class e{constructor(e,t,i){this.codebaseService=e,this.data=t,this.dialogRef=i,this.ignoreList=[]}ngOnInit(){this.ignoreList=this.data.list}ngOnDestroy(){}addToList(){this.codebaseService.addToIgnoreList(this.ignoreList),this.dialogRef.close({added:!0})}cancel(){this.dialogRef.close({added:!1})}}return e.\u0275fac=function(t){return new(t||e)(l.Mb(b.a),l.Mb(o.a),l.Mb(o.h))},e.\u0275cmp=l.Gb({type:e,selectors:[["ignore-list-dialog"]],decls:14,vars:1,consts:[["mat-dialog-title",""],["mat-dialog-content",""],[1,""],[1,"p-1"],[1,"list-unstyled"],["class","text-muted text-small",4,"ngFor","ngForOf"],["mat-dialog-actions","",1,"text-right"],["mat-button","",3,"click"],[1,"text-muted","text-small"]],template:function(e,t){1&e&&(l.Sb(0,"h1",0),l.Ec(1,"Add To Ignore List"),l.Rb(),l.Sb(2,"div",1),l.Sb(3,"div",2),l.Sb(4,"div",3),l.Ec(5,"Add following files/folders to the ignore list:"),l.Rb(),l.Sb(6,"div",3),l.Sb(7,"ul",4),l.Cc(8,m,2,1,"li",5),l.Rb(),l.Rb(),l.Rb(),l.Rb(),l.Sb(9,"div",6),l.Sb(10,"button",7),l.ac("click",(function(){return t.cancel()})),l.Ec(11,"Cancel"),l.Rb(),l.Sb(12,"button",7),l.ac("click",(function(){return t.addToList()})),l.Ec(13,"Add"),l.Rb(),l.Rb()),2&e&&(l.Bb(8),l.kc("ngForOf",t.ignoreList))},directives:[o.i,o.f,c.s,o.c,d.b],styles:[".mat-form-field[_ngcontent-%COMP%], .mat-radio-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin:15px 0}.mat-radio-button[_ngcontent-%COMP%]{margin:5px}"]}),e})();var u=i("33yf"),f=i("3Pt+"),p=i("aSHc"),S=i("/hV/"),g=i("thzI"),v=i("kmnG"),C=i("qFsG"),I=i("d3UM"),T=i("FKr1");function R(e,t){if(1&e&&(l.Sb(0,"mat-option",7),l.Ec(1),l.Rb()),2&e){const e=t.$implicit;l.kc("value",e.name),l.Bb(1),l.Fc(e.name)}}function k(e,t){1&e&&(l.Sb(0,"mat-form-field",4),l.Nb(1,"input",15),l.Rb())}function E(e,t){if(1&e&&(l.Sb(0,"li",20),l.Ec(1),l.Rb()),2&e){const e=t.$implicit;l.Bb(1),l.Fc(e.destination)}}function w(e,t){if(1&e&&(l.Sb(0,"div",2),l.Sb(1,"div",16),l.Ec(2,"Template contents:"),l.Rb(),l.Sb(3,"div",17),l.Sb(4,"ul",18),l.Cc(5,E,2,1,"li",19),l.Rb(),l.Rb(),l.Rb()),2&e){const e=l.ec();l.Bb(5),l.kc("ngForOf",e.fileList)}}function x(e,t){1&e&&(l.Sb(0,"div",21),l.Nb(1,"i",22),l.Ec(2," Template Created"),l.Rb())}function N(e,t){if(1&e){const e=l.Tb();l.Sb(0,"div",23),l.Sb(1,"button",24),l.Ec(2,"Cancel"),l.Rb(),l.Sb(3,"button",25),l.ac("click",(function(){return l.sc(e),l.ec().create()})),l.Ec(4,"Create"),l.Rb(),l.Rb()}if(2&e){const e=l.ec();l.Bb(3),l.kc("disabled",!e.templateForm.valid)}}function F(e,t){if(1&e){const e=l.Tb();l.Sb(0,"div",23),l.Sb(1,"button",24),l.Ec(2,"Close"),l.Rb(),l.Sb(3,"button",26),l.ac("click",(function(){return l.sc(e),l.ec().goToTemplate()})),l.Ec(4,"Preview Template"),l.Rb(),l.Rb()}}let y=(()=>{class e{constructor(e,t,i,c,s){this.fb=e,this.bluService=t,this.appStateService=i,this.data=c,this.dialogRef=s,this.fileList=[],this.collections=[],this.actionState=p.a,this.currentState=p.a.IDLE,this.subs=new a.a,this.templateForm=this.fb.group({templateName:["",[f.E.required]],collection:["",[f.E.required]],newCollectionName:[""]})}ngOnInit(){this.bluService.getCollections().subscribe(e=>{this.collections=e,this.templateForm.get("collection").setValue(this.collections[0].name)}),this.fileList=this.data.list,this.subs.add(this.templateForm.valueChanges.subscribe(e=>{this.createNewCollection="create-new-collection"===e.collection,this.templateForm.get("newCollectionName").setValidators(this.createNewCollection?[f.E.required]:[])}))}ngOnDestroy(){this.subs.unsubscribe()}create(){const e={collectionName:this.createNewCollection?this.templateForm.get("newCollectionName").value:this.templateForm.get("collection").value,templateName:this.templateForm.get("templateName").value,files:this.fileList};this.currentState=p.a.PENDING,this.bluService.createTemplate(e).subscribe(e=>{this.currentState=p.a.SUCCESS,this.newTemplate=e},e=>{console.log("",e),this.currentState=p.a.FAILED,this.templateForm.controls.templateName.setErrors({incorrect:!0}),this.errorMessage=e.error.message})}goToTemplate(){this.dialogRef.close({created:!0}),this.appStateService.openBluConsole({command:"preview",itemId:`"template:${this.newTemplate.parent.name}.${this.newTemplate.name}"`})}}return e.\u0275fac=function(t){return new(t||e)(l.Mb(f.f),l.Mb(S.a),l.Mb(g.a),l.Mb(o.a),l.Mb(o.h))},e.\u0275cmp=l.Gb({type:e,selectors:[["create-template-dialog"]],decls:23,vars:9,consts:[["mat-dialog-title",""],["mat-dialog-content",""],[1,""],[3,"formGroup"],[1,"mat-form-field"],["matInput","","placeholder","New Template Name","formControlName","templateName"],["formControlName","collection"],[3,"value"],[1,"fa","fa-plus-circle"],[3,"value",4,"ngFor","ngForOf"],["class","mat-form-field",4,"ngIf"],["class","",4,"ngIf"],["class","p-2 text-center",4,"ngIf"],["mat-dialog-actions","",1,"text-right"],["class","text-right",4,"ngIf"],["matInput","","placeholder","New Collection Name","formControlName","newCollectionName"],[1,"p-1"],[1,"p-2"],[1,"list-unstyled"],["class","text-muted text-small",4,"ngFor","ngForOf"],[1,"text-muted","text-small"],[1,"p-2","text-center"],[1,"fa","fa-check","text-success"],[1,"text-right"],["mat-button","","mat-dialog-close",""],["mat-button","",3,"disabled","click"],["mat-button","",3,"click"]],template:function(e,t){1&e&&(l.Sb(0,"h1",0),l.Ec(1,"Create Template"),l.Rb(),l.Sb(2,"div",1),l.Sb(3,"div",2),l.Sb(4,"form",3),l.Sb(5,"mat-form-field",4),l.Nb(6,"input",5),l.Sb(7,"mat-error"),l.Ec(8),l.Rb(),l.Rb(),l.Sb(9,"mat-form-field",4),l.Sb(10,"mat-label"),l.Ec(11,"Add to Collection:"),l.Rb(),l.Sb(12,"mat-select",6),l.Sb(13,"mat-option",7),l.Nb(14,"i",8),l.Ec(15," Create New Collection"),l.Rb(),l.Cc(16,R,2,2,"mat-option",9),l.Rb(),l.Rb(),l.Cc(17,k,2,0,"mat-form-field",10),l.Rb(),l.Cc(18,w,6,1,"div",11),l.Rb(),l.Cc(19,x,3,0,"div",12),l.Rb(),l.Sb(20,"div",13),l.Cc(21,N,5,1,"div",14),l.Cc(22,F,5,0,"div",14),l.Rb()),2&e&&(l.Bb(4),l.kc("formGroup",t.templateForm),l.Bb(4),l.Fc(t.errorMessage),l.Bb(5),l.kc("value","create-new-collection"),l.Bb(3),l.kc("ngForOf",t.collections),l.Bb(1),l.kc("ngIf",t.createNewCollection),l.Bb(1),l.kc("ngIf",t.fileList.length>0),l.Bb(1),l.kc("ngIf",t.currentState===t.actionState.SUCCESS),l.Bb(2),l.kc("ngIf",t.currentState!==t.actionState.SUCCESS),l.Bb(1),l.kc("ngIf",t.currentState===t.actionState.SUCCESS))},directives:[o.i,o.f,f.G,f.r,f.j,v.c,C.a,f.c,f.q,f.i,v.b,v.g,I.a,T.g,c.s,c.t,o.c,d.b,o.d],styles:[".mat-form-field[_ngcontent-%COMP%], .mat-radio-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin:15px 0}.mat-radio-button[_ngcontent-%COMP%]{margin:5px}"]}),e})();var L=i("OnT9"),B=i("Ni13"),O=i("QArD");function M(e,t){if(1&e){const e=l.Tb();l.Sb(0,"div",7),l.Nb(1,"i",8),l.Ec(2),l.Sb(3,"i",9),l.ac("click",(function(){return l.sc(e),l.ec().resetSearch()})),l.Rb(),l.Rb()}if(2&e){const e=l.ec();l.Bb(2),l.Gc(" ",e.searchTerm," ")}}function D(e,t){if(1&e&&l.Nb(0,"blu-dir-tree",10),2&e){const e=l.ec();l.kc("multiSelect",!0)("state",e.treeState)}}const P=s.f.forChild([{path:"",component:(()=>{class e{constructor(e,t,i,c){this.treeService=e,this.localStorageService=t,this.appStateService=i,this.dialog=c,this.subs=new a.a,this.selectedItems=[],this.searchTerm="",this.treeSearch$=new r.a}handleKeyboardEvent(e){const t=e.key,i=1===t.length&&/^[0-9a-zA-Z\-_@.]+$/.test(t);"Backspace"===e.key?(this.searchTerm=this.searchTerm.length>0?this.searchTerm.slice(0,-1):"",this.treeSearch$.next(this.searchTerm),this.treeService.search(this.searchTerm)):i&&(this.searchTerm=this.searchTerm+t,this.treeSearch$.next(this.searchTerm))}ngOnInit(){var e;this.treeState=null!==(e=this.localStorageService.getItem("last-codebase-state"))&&void 0!==e?e:{},this.subs.add(this.treeService.multiSelectedItems$.subscribe(e=>this.selectedItems=e)),this.subs.add(this.treeService.selectedItem$.subscribe(e=>{e.userSelected&&this.treeService.toggleCheckDir(e.item)})),this.subs.add(this.treeSearch$.pipe(Object(n.a)(250)).subscribe(e=>this.treeService.search(e))),this.subs.add(this.treeService.currentState$.subscribe(e=>{e.activeItemIndex=[0],this.localStorageService.setItem("last-codebase-state",e)})),this.subs.add(this.appStateService.bluConsoleState$.subscribe(e=>e.open?this.treeService.disallowKeyboardInput():this.treeService.allowKeyboardInput()))}ngOnDestroy(){this.subs.unsubscribe()}addToIgnoreList(){const e=this.getCheckedItems();this.openIgnoreListDialog(e.map(e=>e.relativePath)).afterClosed().subscribe(e=>{e.added&&this.treeService.refresh()})}openIgnoreListDialog(e){return this.dialog.open(h,{data:{list:e},maxWidth:"500px",position:{top:"100px"},autoFocus:!0})}getCheckedItems(){const e=[];return this.selectedItems.forEach(t=>{this.isParentInList(e,t)||this.treeService.allChildrenChecked(t)&&e.push(t)}),e}isParentInList(e,t){let i=!1;return e.forEach(e=>{i||(i=this.isDescendantOfParent(e,t))}),i}isDescendantOfParent(e,t){return!!t.parent&&(t.parent===e||this.isDescendantOfParent(e,t.parent))}resetSearch(){this.searchTerm="",this.treeSearch$.next(this.searchTerm)}openConvertToTemplateDialog(e){return this.dialog.open(y,{data:{list:e},width:"500px",maxWidth:"500px",position:{top:"100px"},autoFocus:!0})}convertToTemplate(){const e=this.getCheckedItems(),t=[];e.forEach(e=>t.push(...this.iterChildren(e,e))),this.openConvertToTemplateDialog(t).afterClosed().subscribe(e=>null)}iterChildren(e,t,i="",c=[]){return i=u.join(i,e.name),e.isDir?e.children.forEach(e=>{this.iterChildren(e,t,i,c)}):c.push({origin:e.path,destination:i,name:e.name}),c}}return e.\u0275fac=function(t){return new(t||e)(l.Mb(L.a),l.Mb(B.a),l.Mb(g.a),l.Mb(o.b))},e.\u0275cmp=l.Gb({type:e,selectors:[["codebase-tree"]],hostBindings:function(e,t){1&e&&l.ac("keydown",(function(e){return t.handleKeyboardEvent(e)}))},decls:10,vars:4,consts:[[1,"pt-1"],["mat-button","",3,"disabled","click"],[1,"fa","fa-plus-circle"],[1,"fa","fa-code"],[1,"p-2"],["class","small search-term pb-2",4,"ngIf"],[3,"multiSelect","state",4,"ngIf"],[1,"small","search-term","pb-2"],[1,"fa","fa-sm","fa-search"],[1,"far","fa-times-circle","ml-2","cursor-pointer",3,"click"],[3,"multiSelect","state"]],template:function(e,t){1&e&&(l.Sb(0,"div",0),l.Sb(1,"button",1),l.ac("click",(function(){return t.addToIgnoreList()})),l.Nb(2,"i",2),l.Ec(3," Add To Ignore List"),l.Rb(),l.Sb(4,"button",1),l.ac("click",(function(){return t.convertToTemplate()})),l.Nb(5,"i",3),l.Ec(6," Convert to Template"),l.Rb(),l.Rb(),l.Sb(7,"div",4),l.Cc(8,M,4,1,"div",5),l.Cc(9,D,1,2,"blu-dir-tree",6),l.Rb()),2&e&&(l.Bb(1),l.kc("disabled",0===t.selectedItems.length),l.Bb(3),l.kc("disabled",0===t.selectedItems.length),l.Bb(4),l.kc("ngIf",!!t.searchTerm),l.Bb(1),l.kc("ngIf",t.treeState))},directives:[d.b,c.t,O.a],styles:[""]}),e})()}]);var $=i("0ymr");let G=(()=>{class e{}return e.\u0275mod=l.Kb({type:e}),e.\u0275inj=l.Jb({factory:function(t){return new(t||e)},providers:[],imports:[[c.c,P,$.a,d.c]]}),e})()}}]);