(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{Chfi:function(t,e,i){"use strict";i.r(e),i.d(e,"MyStacksModule",(function(){return Ht}));var n=i("ofXK"),c=i("tyNb"),a=i("mrSG"),s=i("HdQx"),o=i("quSY"),r=i("cp0P"),b=i("b5vT"),l=i("IzEk"),d=i("vkgz"),u=i("40nA"),m=i("0IaG"),g=i("3Pt+"),f=i("aSHc"),h=i("OAzE"),p=i("fXoL"),v=i("oCqB"),k=i("1TnD"),S=i("QibW"),I=i("kmnG"),R=i("d3UM"),Q=i("FKr1"),E=i("bv9b"),C=i("bTqV");function A(t,e){if(1&t&&(p.Rb(0,"mat-option",14),p.Ec(1),p.Rb(2,"span",1),p.Ec(3),p.Qb(),p.Qb()),2&t){const t=e.$implicit;p.jc("value",t.oid),p.Ab(1),p.Gc(" ",t.name," "),p.Ab(2),p.Gc("(@",t.prefix,")")}}function x(t,e){if(1&t&&(p.Pb(0),p.Rb(1,"mat-form-field"),p.Mb(2,"mat-label"),p.Rb(3,"mat-label"),p.Ec(4,"Organization (optional)"),p.Qb(),p.Rb(5,"mat-select",11),p.Rb(6,"mat-option",12),p.Ec(7,"None"),p.Qb(),p.Cc(8,A,4,3,"mat-option",13),p.Qb(),p.Qb(),p.Ob()),2&t){const t=p.dc(2);p.Ab(8),p.jc("ngForOf",t.data.organizations)}}function w(t,e){if(1&t&&(p.Pb(0),p.Rb(1,"form",6),p.Rb(2,"mat-radio-group",7),p.Rb(3,"mat-radio-button",8),p.Ec(4,"Make Stack Public"),p.Qb(),p.Rb(5,"mat-radio-button",8),p.Ec(6,"Make Stack Private"),p.Qb(),p.Qb(),p.Cc(7,x,9,1,"ng-container",3),p.Rb(8,"div",9),p.Rb(9,"div",10),p.Ec(10,"Public: \xa0\xa0Anyone can install this stack."),p.Qb(),p.Rb(11,"div",10),p.Ec(12,"Private: Only users who have access to this stack can install it."),p.Qb(),p.Qb(),p.Qb(),p.Ob()),2&t){const t=p.dc();p.Ab(1),p.jc("formGroup",t.form),p.Ab(2),p.jc("value","public"),p.Ab(2),p.jc("value","private"),p.Ab(2),p.jc("ngIf",t.data.organizations.length>0)}}function j(t,e){1&t&&(p.Rb(0,"div",15),p.Rb(1,"div"),p.Ec(2,"Publishing Stack..."),p.Qb(),p.Mb(3,"mat-progress-bar",16),p.Qb())}function y(t,e){if(1&t&&(p.Pb(0),p.Rb(1,"div",17),p.Mb(2,"i",18),p.Ec(3),p.Qb(),p.Ob()),2&t){const t=p.dc();p.Ab(3),p.Gc(" Stack: ",t.data.stack.name," has been published! ")}}function O(t,e){if(1&t&&(p.Rb(0,"div",23),p.Ec(1),p.Qb()),2&t){const t=p.dc(2);p.Ab(1),p.Gc("Error: ",t.errorMessage,"")}}function T(t,e){if(1&t&&(p.Pb(0),p.Rb(1,"div",19),p.Mb(2,"i",20),p.Ec(3," Failed to publish stack: "),p.Rb(4,"span",21),p.Ec(5),p.Qb(),p.Ec(6,". "),p.Qb(),p.Cc(7,O,2,1,"div",22),p.Ob()),2&t){const t=p.dc();p.Ab(5),p.Fc(t.data.stack.name),p.Ab(2),p.jc("ngIf",t.errorMessage)}}function L(t,e){if(1&t){const t=p.Sb();p.Pb(0),p.Rb(1,"button",24),p.Zb("click",(function(){return p.rc(t),p.dc().close(!1)})),p.Ec(2,"Cancel"),p.Qb(),p.Rb(3,"button",25),p.Zb("click",(function(){return p.rc(t),p.dc().publish()})),p.Ec(4,"Publish"),p.Qb(),p.Ob()}if(2&t){const t=p.dc();p.Ab(3),p.jc("disabled",t.form.invalid)}}function M(t,e){if(1&t){const t=p.Sb();p.Pb(0),p.Rb(1,"button",24),p.Zb("click",(function(){return p.rc(t),p.dc().close(!1)})),p.Ec(2,"Close"),p.Qb(),p.Ob()}}let F=(()=>{class t{constructor(t,e,i,n,c){this.fb=t,this.stackService=e,this.organizationSerivce=i,this.data=n,this.dialogRef=c,this.actionState=f.a,this.currentState=f.a.IDLE,this.form=this.fb.group({textInput:[],visibility:["public",[g.F.required]],select:[],organization:[""]})}getOrgPrefix(t){var e;return""===t?"":`@${null===(e=this.data.organizations.find(e=>e.oid===t))||void 0===e?void 0:e.prefix}/`||""}ngOnInit(){this.errorMessage=null}ngOnDestroy(){}close(t){this.dialogRef.close(t)}publish(){this.currentState=f.a.ACQUIRING,this.stackService.publishStack(this.data.stack.id,this.form.get("organization").value).subscribe(()=>{this.close(!0)},t=>{var e,i;this.currentState=f.a.FAILED,this.errorMessage=(null===(e=t.error)||void 0===e?void 0:e.code)===h.HttpError.ENVIRONMENT_NAME_IN_USE?`Stack name '${this.data.stack.name}' is in use. Please rename the stack and try publishing again.`:(null===(i=t.error)||void 0===i?void 0:i.message)||"Unknown error occurred while trying to publish stack."})}}return t.\u0275fac=function(e){return new(e||t)(p.Lb(g.f),p.Lb(v.a),p.Lb(k.a),p.Lb(m.a),p.Lb(m.h))},t.\u0275cmp=p.Fb({type:t,selectors:[["publish-stack-dialog"]],decls:13,vars:9,consts:[["mat-dialog-title",""],[1,"text-muted"],["mat-dialog-content",""],[4,"ngIf"],["class","text-center p-2",4,"ngIf"],["mat-dialog-actions","",3,"align"],[3,"formGroup"],["aria-label","Select an option","formControlName","visibility",1,"mat-radio-group"],[1,"mat-radio-button",3,"value"],[1,"pb-2"],[1,"text-small","text-muted"],["formControlName","organization"],["value",""],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"text-center","p-2"],["mode","indeterminate"],[1,"text-center","p-2","text-success"],[1,"fa","fa-check","mr-2"],[1,"text-center","p-2","text-red"],[1,"fa","fa-times-circle","mr-2"],[1,"text-capitalize"],["class","text-muted text-small pl-5",4,"ngIf"],[1,"text-muted","text-small","pl-5"],["mat-button","",3,"click"],["mat-button","",3,"disabled","click"]],template:function(t,e){1&t&&(p.Rb(0,"h2",0),p.Ec(1,"Publish Stack: "),p.Rb(2,"span",1),p.Ec(3),p.Qb(),p.Ec(4),p.Qb(),p.Rb(5,"div",2),p.Cc(6,w,13,4,"ng-container",3),p.Cc(7,j,4,0,"div",4),p.Cc(8,y,4,1,"ng-container",3),p.Cc(9,T,8,2,"ng-container",3),p.Qb(),p.Rb(10,"div",5),p.Cc(11,L,5,1,"ng-container",3),p.Cc(12,M,3,0,"ng-container",3),p.Qb()),2&t&&(p.Ab(3),p.Fc(e.getOrgPrefix(e.form.get("organization").value)),p.Ab(1),p.Fc(e.data.stack.name),p.Ab(2),p.jc("ngIf",e.currentState===e.actionState.IDLE),p.Ab(1),p.jc("ngIf",e.currentState===e.actionState.ACQUIRING),p.Ab(1),p.jc("ngIf",e.currentState===e.actionState.SUCCESS),p.Ab(1),p.jc("ngIf",e.currentState===e.actionState.FAILED),p.Ab(1),p.jc("align","end"),p.Ab(1),p.jc("ngIf",e.currentState===e.actionState.IDLE),p.Ab(1),p.jc("ngIf",e.currentState===e.actionState.SUCCESS||e.currentState===e.actionState.FAILED))},directives:[m.i,m.f,n.t,m.c,g.H,g.s,g.k,S.b,g.r,g.i,S.a,I.c,I.g,R.a,Q.l,n.s,E.a,C.b],styles:[".mat-form-field[_ngcontent-%COMP%], .mat-radio-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin:15px 0}.mat-radio-button[_ngcontent-%COMP%]{margin:5px}"]}),t})();var P=i("XNiG"),$=i("Kj3r"),D=i("/uUt"),N=i("qFsG");function Z(t,e){if(1&t){const t=p.Sb();p.Rb(0,"button",5),p.Zb("click",(function(){p.rc(t);const i=e.$implicit;return p.dc().addTag(i)})),p.Ec(1),p.ec(2,"titlecase"),p.Qb()}if(2&t){const t=e.$implicit,i=p.dc();p.jc("disabled",i.currentTags.has(t)||i.newTags.has(t)),p.Ab(1),p.Fc(p.fc(2,2,t))}}let z=(()=>{class t{constructor(e,i,n){this.data=e,this.ngZone=i,this.stackService=n,this.availableTags=Array.from(t.allTags),this.searchChanged=new P.a,this.newTags=new Set,this.currentTags=new Set(e.tags),this.stack=e.stack}static generateTagList(t){let e=new Set;for(const i in t)"string"==typeof t[i]?e.add(t[i]):"object"==typeof t[i]&&(e=new Set([...e,...this.generateTagList(t[i])]));return e}ngOnInit(){this.searchChanged.pipe(Object($.a)(300),Object(D.a)()).subscribe(t=>{this.updateSearch(t)})}ngOnDestroy(){}updateSearch(e){this.availableTags=Array.from(t.allTags).filter(t=>t.includes(e))}addTag(t){var e;this.stackService.addTag(null===(e=this.stack.remote)||void 0===e?void 0:e.id,t).pipe(Object(l.a)(1)).subscribe(()=>{this.newTags.add(t)})}}return t.allTags=t.generateTagList(h.Tags),t.\u0275fac=function(e){return new(e||t)(p.Lb(m.a),p.Lb(p.A),p.Lb(v.a))},t.\u0275cmp=p.Fb({type:t,selectors:[["add-tag-dialog"]],decls:9,vars:1,consts:[["appearance","fill"],["matInput","","placeholder","Search",3,"input"],["mat-button","","mat-raised-button","","class","ml-2 mr-2 my-2",3,"disabled","click",4,"ngFor","ngForOf"],[1,"mt-3"],["mat-button","","mat-raised-button","","mat-dialog-close","","color","accent"],["mat-button","","mat-raised-button","",1,"ml-2","mr-2","my-2",3,"disabled","click"]],template:function(t,e){1&t&&(p.Rb(0,"mat-form-field",0),p.Rb(1,"mat-label"),p.Ec(2,"Search Tags"),p.Qb(),p.Rb(3,"input",1),p.Zb("input",(function(t){return e.searchChanged.next(t.target.value)})),p.Qb(),p.Qb(),p.Rb(4,"div"),p.Cc(5,Z,3,4,"button",2),p.Qb(),p.Rb(6,"div",3),p.Rb(7,"button",4),p.Ec(8,"Close"),p.Qb(),p.Qb()),2&t&&(p.Ab(5),p.jc("ngForOf",e.availableTags))},directives:[I.c,I.g,N.a,n.s,C.b,m.d],pipes:[n.F],styles:[""]}),t})();var G=i("Mzu6"),U=i("3sFK"),_=i("biaL"),H=i("nZ6g"),W=i("cvgN"),q=i("wZkO"),V=i("s/2f");function J(t,e){if(1&t){const t=p.Sb();p.Rb(0,"div",13),p.Rb(1,"div",14),p.Ec(2," Publishing a stack will let you invite collaborators to help build you stack. You will also have the option to allow other users to use your stack. "),p.Qb(),p.Rb(3,"button",15),p.Zb("click",(function(){return p.rc(t),p.dc().publishStack()})),p.Ec(4,"Publish Stack"),p.Qb(),p.Qb()}}function K(t,e){if(1&t&&p.Nb(0,5),2&t){p.dc();const t=p.oc(15);p.jc("ngTemplateOutlet",t)}}function Y(t,e){1&t&&(p.Rb(0,"span",29),p.Ec(1,"None"),p.Qb())}function B(t,e){if(1&t){const t=p.Sb();p.Rb(0,"span",30),p.Zb("mouseenter",(function(){p.rc(t);const i=e.$implicit;return p.dc(3).tagHover=i}))("mouseleave",(function(){return p.rc(t),p.dc(3).tagHover=null}))("click",(function(){p.rc(t);const i=e.$implicit;return p.dc(3).removeTag(i)})),p.Ec(1),p.ec(2,"titlecase"),p.Qb()}if(2&t){const t=e.$implicit,i=p.dc(3);p.jc("ngClass",i.tagHover==t?"badge-danger":"badge-primary"),p.Ab(1),p.Hc("",p.fc(2,3,t)," ",i.tagHover==t?"X":"","")}}function X(t,e){if(1&t){const t=p.Sb();p.Pb(0),p.Rb(1,"div",16),p.Rb(2,"mat-form-field",21),p.Rb(3,"mat-label"),p.Ec(4,"Description"),p.Qb(),p.Mb(5,"textarea",22),p.Qb(),p.Rb(6,"button",19),p.Zb("click",(function(){return p.rc(t),p.dc(2).updateDescription()})),p.Ec(7,"Save "),p.Qb(),p.Qb(),p.Rb(8,"div",23),p.Mb(9,"i",24),p.Ec(10," Tags"),p.Qb(),p.Rb(11,"div"),p.Cc(12,Y,2,0,"span",25),p.Cc(13,B,3,5,"span",26),p.Rb(14,"span",27),p.Zb("click",(function(){return p.rc(t),p.dc(2).addTag()})),p.Mb(15,"i",28),p.Qb(),p.Qb(),p.Ob()}if(2&t){const t=p.dc(2);p.Ab(5),p.jc("formControl",t.formControls.description),p.Ab(1),p.jc("disabled",t.formControls.description.value===t.stack.description),p.Ab(6),p.jc("ngIf",0==t.tags.length),p.Ab(1),p.jc("ngForOf",t.tags)}}function tt(t,e){if(1&t){const t=p.Sb();p.Rb(0,"div",16),p.Rb(1,"mat-form-field",17),p.Rb(2,"mat-label"),p.Ec(3,"Name"),p.Qb(),p.Mb(4,"input",18),p.Qb(),p.Rb(5,"button",19),p.Zb("click",(function(){return p.rc(t),p.dc().rename()})),p.Ec(6,"Save "),p.Qb(),p.Qb(),p.Cc(7,X,16,4,"ng-container",20)}if(2&t){const t=p.dc();p.Ab(4),p.jc("formControl",t.formControls.name),p.Ab(1),p.jc("disabled",t.formControls.name.value===t.stack.name),p.Ab(2),p.jc("ngIf",t.stackIsShared&&t.stack.remote)}}function et(t,e){if(1&t){const t=p.Sb();p.Mb(0,"share-environment-settings",31),p.Rb(1,"button",32),p.Zb("click",(function(){return p.rc(t),p.dc().revokeStack()})),p.Ec(2,"Revoke All Access"),p.Qb()}if(2&t){const t=p.dc();p.jc("environment",t.stack)("userId",t.userId)("userIsAdmin",t.userIsAdmin)}}let it=(()=>{class t{constructor(t,e,i,n,c,a,s,r){this.stackService=t,this.dialog=e,this.appEnvironmentService=i,this.userService=n,this.dialogService=c,this.organizationsApi=a,this.dialogRef=s,this.data=r,this.userIsAdmin=!1,this.stackIsShared=!1,this.formControls={description:new g.g(""),name:new g.g("",[g.F.minLength(2)])},this.tags=[],this.tagHover=null,this.subs=new o.a,this.publishStack=()=>{const t=this.organizationsApi.getOrganizationsForUser(this.userId).pipe(Object(l.a)(1)).subscribe(e=>{this.dialog.open(F,{data:{stack:this.stack,organizations:e},position:{top:"100px"},minWidth:"400px",autoFocus:!0}).afterClosed().subscribe(t=>{if(!t)return;const e=this.stackService.userStacks().pipe(Object(l.a)(1)).subscribe(t=>{this.stack=t.find(t=>t.id===this.stack.id),this.stackIsShared=!0,e.unsubscribe()})}),t.unsubscribe()},()=>this.dialogService.alertUnknownErrorTryAgain())},this.stack=r.environment,this.formControls.description.setValue(this.stack.description),this.formControls.name.setValue(this.stack.name),this.subs.add(this.userService.user$.subscribe(t=>{t&&(this.userId=t.uid)}))}ngOnInit(){this.stackIsShared=!!this.stack.remote,this.stackIsShared&&this.loadTags()}ngOnDestroy(){this.subs.unsubscribe()}close(){this.dialogRef.close()}revokeStack(){const t=this.dialog.open(G.a,{data:{title:`Revoke stack ${this.stack.name}?`,text:"Revoking this stack will remove it from the stackjoy community. It will no longer be public and other users will no longer be able to install it. This is a permanent action and cannot be undone.",button:{yes:"Revoke",no:"Cancel"}},position:{top:"100px"},autoFocus:!0});Object(r.a)([t.afterClosed(),this.appEnvironmentService.currentEnvironment$.pipe(Object(l.a)(1))]).subscribe(([t,e])=>{!1!==t&&this.stackService.purge(this.stack.remote.id).subscribe(()=>{delete this.stack.remote,this.stack.isLocal=!0,this.stackIsShared=!1},t=>{this.dialogService.openAlertDialog({title:"Revoke Stack",text:"Something went wrong: "+(t.message||"Unknown error occurred...")})})})}updateDescription(){this.stackService.updateDescription(this.stack.remote.id,this.formControls.description.value).pipe(Object(l.a)(1)).subscribe(()=>{this.stack.description=this.formControls.description.value},()=>{this.dialogService.alertUnknownErrorTryAgain()})}loadTags(){var t,e;(null===(e=null===(t=this.stack)||void 0===t?void 0:t.remote)||void 0===e?void 0:e.id)&&this.stackService.getTags(this.stack.remote.id).pipe(Object(l.a)(1)).subscribe(t=>{this.tags=t},()=>this.dialogService.alertUnknownErrorTryAgain())}addTag(){this.dialogService.open(z,{data:{stack:this.stack,tags:this.tags},width:"50vw",maxWidth:"800px",minWidth:"500px",position:{top:"100px"},autoFocus:!0}).afterClosed().subscribe(()=>{this.loadTags()},()=>this.dialogService.alertUnknownErrorTryAgain())}removeTag(t){var e;this.stackService.removeTag(null===(e=this.stack.remote)||void 0===e?void 0:e.id,t).pipe(Object(l.a)(1)).subscribe(()=>{this.tags=this.tags.filter(e=>e!==t)},()=>this.dialogService.alertUnknownErrorTryAgain())}rename(){var t;if(!this.formControls.name.valid)return;const e=this.formControls.name.value;this.appEnvironmentService.rename(this.stack.id||(null===(t=this.stack.remote)||void 0===t?void 0:t.id),e).pipe(Object(l.a)(1)).subscribe(()=>{this.stack.name=e},t=>{var i;(null===(i=t.error)||void 0===i?void 0:i.code)===h.HttpError.ENVIRONMENT_NAME_IN_USE?this.dialogService.openAlertDialog({title:"Name already in use!",text:`Stack name '${e}' is in use. Please choose a different name and try again.`}):this.dialogService.alertUnknownErrorTryAgain()})}}return t.\u0275fac=function(e){return new(e||t)(p.Lb(v.a),p.Lb(m.b),p.Lb(U.a),p.Lb(_.a),p.Lb(H.a),p.Lb(k.a),p.Lb(m.h),p.Lb(m.a))},t.\u0275cmp=p.Fb({type:t,selectors:[["stack-settings-dialog"]],decls:19,vars:7,consts:[[1,"text-large"],[1,"text-muted","text-small","my-2"],[3,"name","prefix"],["mat-dialog-content",""],["label","Basic Info"],[3,"ngTemplateOutlet"],["label","Share Settings"],["class","my-2",4,"ngIf"],[3,"ngTemplateOutlet",4,"ngIf"],["basicSettings",""],["shareSettings",""],["mat-dialog-actions","",3,"align"],["mat-button","","mat-dialog-close",""],[1,"my-2"],[1,"mb-2"],["mat-button","","mat-raised-button","","color","primary",3,"click"],[1,"mat-form-field-flex","overflow-hidden"],[1,"mt-2"],["matInput","",3,"formControl"],["mat-button","","mat-stroked-button","",1,"ml-2",3,"disabled","click"],[4,"ngIf"],["appearance","outline",1,"mt-2"],["matInput","","matTextareaAutosize","","matAutosizeMaxRows","3","placeholder","None",3,"formControl"],[1,"text-muted","text-small"],[1,"fa","fa-tags"],["class","ml-2",4,"ngIf"],["class","ml-2 badge",3,"ngClass","mouseenter","mouseleave","click",4,"ngFor","ngForOf"],[1,"ml-2","badge","badge-secondary",3,"click"],[1,"fa","fa-plus"],[1,"ml-2"],[1,"ml-2","badge",3,"ngClass","mouseenter","mouseleave","click"],[3,"environment","userId","userIsAdmin"],["mat-button","","mat-raised-button","","color","warn",3,"click"]],template:function(t,e){if(1&t&&(p.Rb(0,"div",0),p.Ec(1,"Stack Settings"),p.Qb(),p.Rb(2,"div",1),p.Ec(3),p.Mb(4,"stack-name",2),p.Qb(),p.Rb(5,"div",3),p.Rb(6,"mat-tab-group"),p.Rb(7,"mat-tab",4),p.Nb(8,5),p.Qb(),p.Rb(9,"mat-tab",6),p.Cc(10,J,5,0,"div",7),p.Cc(11,K,1,1,"ng-container",8),p.Qb(),p.Qb(),p.Qb(),p.Cc(12,tt,8,3,"ng-template",null,9,p.Dc),p.Cc(14,et,3,3,"ng-template",null,10,p.Dc),p.Rb(16,"div",11),p.Rb(17,"button",12),p.Ec(18,"Close"),p.Qb(),p.Qb()),2&t){const t=p.oc(13);p.Ab(3),p.Gc(" ",e.stackIsShared?"Shared":"Not Shared"," "),p.Ab(1),p.jc("name",e.stack.name)("prefix",null==e.stack.remote||null==e.stack.remote.organization?null:e.stack.remote.organization.prefix),p.Ab(4),p.jc("ngTemplateOutlet",t),p.Ab(2),p.jc("ngIf",!e.stackIsShared),p.Ab(1),p.jc("ngIf",e.stackIsShared&&!!e.stack.remote),p.Ab(5),p.jc("align","end")}},directives:[W.a,m.f,q.b,q.a,n.A,n.t,m.c,C.b,m.d,I.c,I.g,N.a,g.c,g.r,g.h,N.c,n.s,n.q,V.a],pipes:[n.F],styles:["mat-form-field[_ngcontent-%COMP%]{width:100%;padding:0 5px}.permTable[_ngcontent-%COMP%]{width:100%}.tableActions[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{margin-right:5px}"]}),t})();var nt=i("a8/g"),ct=i("xm+p"),at=i("k1Ex");function st(t,e){if(1&t){const t=p.Sb();p.Pb(0),p.Rb(1,"button",1),p.Zb("click",(function(){return p.rc(t),p.dc().downloadRemoteStack()})),p.Mb(2,"i",2),p.Ec(3," Download Remote Stack"),p.Qb(),p.Ob()}}function ot(t,e){1&t&&(p.Pb(0),p.Rb(1,"div",3),p.Mb(2,"mat-progress-bar",4),p.Rb(3,"div",5),p.Ec(4,"downloading stack"),p.Qb(),p.Qb(),p.Ob())}function rt(t,e){if(1&t&&(p.Pb(0),p.Rb(1,"div",6),p.Mb(2,"i",7),p.Ec(3),p.Qb(),p.Ob()),2&t){const t=p.dc();p.Ab(3),p.Gc(" Error Downloading Stack ",t.stack.name,"")}}let bt=(()=>{class t{constructor(t){this.stackService=t,this.onFinished=new p.o,this.actionState=f.a,this.currentState=f.a.IDLE,this.subs=new o.a}ngOnInit(){}ngOnDestroy(){this.subs.unsubscribe()}downloadRemoteStack(){this.currentState=this.actionState.ACQUIRING,this.subs.add(this.stackService.downloadStack(this.stack.remote.id,this.stack.name,this.stack.remote.version,s.a.Environment.Type.Stack).subscribe(t=>{this.currentState=this.actionState.SUCCESS,this.onFinished.emit(!0)}))}}return t.\u0275fac=function(e){return new(e||t)(p.Lb(v.a))},t.\u0275cmp=p.Fb({type:t,selectors:[["download-remote-stack"]],inputs:{stack:"stack"},outputs:{onFinished:"onFinished"},decls:3,vars:3,consts:[[4,"ngIf"],["mat-button","",3,"click"],[1,"fa","fa-download","text-muted"],[1,"text-center"],["mode","buffer"],[1,"text-small"],[1,"text-warning"],[1,"fa","fa-exclamation-triangle"]],template:function(t,e){1&t&&(p.Cc(0,st,4,0,"ng-container",0),p.Cc(1,ot,5,0,"ng-container",0),p.Cc(2,rt,4,1,"ng-container",0)),2&t&&(p.jc("ngIf",e.currentState===e.actionState.IDLE),p.Ab(1),p.jc("ngIf",e.currentState===e.actionState.ACQUIRING),p.Ab(1),p.jc("ngIf",e.currentState===e.actionState.FAILED))},directives:[n.t,C.b,E.a],styles:[""]}),t})();var lt=i("f0Cb"),dt=i("Qu3c");function ut(t,e){if(1&t){const t=p.Sb();p.Rb(0,"div",12),p.Rb(1,"div",13),p.Rb(2,"div",14),p.Rb(3,"div",15),p.Rb(4,"div"),p.Ec(5),p.ec(6,"titlecase"),p.Qb(),p.Rb(7,"div",16),p.Ec(8),p.ec(9,"titlecase"),p.Qb(),p.Qb(),p.Rb(10,"div"),p.Rb(11,"button",17),p.Zb("click",(function(){p.rc(t);const i=e.$implicit;return p.dc(3).acceptInvite(i.eid)})),p.Ec(12,"Accept"),p.Qb(),p.Rb(13,"button",17),p.Zb("click",(function(){p.rc(t);const i=e.$implicit;return p.dc(3).declineInvite(i.eid)})),p.Ec(14,"Decline"),p.Qb(),p.Qb(),p.Qb(),p.Qb(),p.Qb()}if(2&t){const t=e.$implicit;p.Ab(5),p.Fc(p.fc(6,2,t.name)),p.Ab(3),p.Gc("Owner: ",p.fc(9,4,t.owner.displayName)||t.owner.email,"")}}function mt(t,e){if(1&t&&(p.Pb(0),p.Rb(1,"div",10),p.Ec(2,"Stack Invites"),p.Qb(),p.Cc(3,ut,15,6,"div",11),p.Ob()),2&t){const t=p.dc(2);p.Ab(3),p.jc("ngForOf",t.invites)}}function gt(t,e){if(1&t){const t=p.Sb();p.Pb(0),p.Rb(1,"div",18),p.Rb(2,"div",19),p.Zb("click",(function(){return p.rc(t),p.dc(2).gotoLogin()})),p.Mb(3,"i",20),p.Ec(4," Please Log In to use this section. "),p.Mb(5,"i",21),p.Qb(),p.Rb(6,"div",22),p.Zb("click",(function(){return p.rc(t),p.dc(2).goToCreateAccount()})),p.Ec(7," You can also create an account and receive an additional workspace. "),p.Qb(),p.Qb(),p.Ob()}}function ft(t,e){1&t&&(p.Rb(0,"div",24),p.Ec(1,"No stacks present"),p.Qb())}function ht(t,e){1&t&&(p.Rb(0,"div",36),p.Rb(1,"button",37),p.Mb(2,"i",38),p.Qb(),p.Qb())}function pt(t,e){if(1&t){const t=p.Sb();p.Rb(0,"div",4),p.Rb(1,"button",39),p.Zb("click",(function(){p.rc(t);const e=p.dc().$implicit;return p.dc(3).switchEnvironment(e)})),p.Mb(2,"i",40),p.Qb(),p.Qb()}if(2&t){const t=p.dc().$implicit,e=p.dc(3);p.Ab(1),p.jc("disabled",e.isCurrentEnv(t))}}function vt(t,e){if(1&t){const t=p.Sb();p.Rb(0,"div",4),p.Rb(1,"button",42),p.Zb("click",(function(){p.rc(t);const e=p.dc(4).$implicit;return p.dc(3).pushStack(e)})),p.Mb(2,"i",43),p.Ec(3," Push your changes"),p.Qb(),p.Qb()}2&t&&(p.Ab(1),p.jc("title","Push Your Changes"))}function kt(t,e){if(1&t){const t=p.Sb();p.Rb(0,"div",4),p.Rb(1,"button",42),p.Zb("click",(function(){p.rc(t);const e=p.dc(4).$implicit;return p.dc(3).pullStack(e)})),p.Mb(2,"i",38),p.Ec(3," Pull new updates"),p.Qb(),p.Qb()}2&t&&(p.Ab(1),p.jc("title","Pull New Updates"))}function St(t,e){1&t&&(p.Rb(0,"div",44),p.Ec(1,"Requires merge!"),p.Qb())}function It(t,e){if(1&t&&(p.Rb(0,"div",4),p.Cc(1,vt,4,1,"div",28),p.Cc(2,kt,4,1,"div",28),p.Cc(3,St,2,0,"div",41),p.Qb()),2&t){const t=p.dc(3).$implicit;p.Ab(1),p.jc("ngIf",!t.remote.isClean),p.Ab(1),p.jc("ngIf",t.localVersion!=(null==t.remote?null:t.remote.version)),p.Ab(1),p.jc("ngIf",null==t.remote?null:t.remote.requiresMerge)}}function Rt(t,e){if(1&t&&(p.Pb(0),p.Cc(1,It,4,3,"div",28),p.Ob()),2&t){const t=p.dc(2).$implicit;p.Ab(1),p.jc("ngIf",t.remote)}}function Qt(t,e){if(1&t){const t=p.Sb();p.Pb(0),p.Rb(1,"download-remote-stack",45),p.Zb("onFinished",(function(){return p.rc(t),p.dc(5).stackService.refresh()})),p.Qb(),p.Ob()}if(2&t){const t=p.dc(2).$implicit;p.Ab(1),p.jc("stack",t)}}function Et(t,e){if(1&t&&(p.Pb(0),p.Cc(1,Rt,2,1,"ng-container",0),p.Cc(2,Qt,2,1,"ng-container",0),p.Ob()),2&t){const t=p.dc().$implicit;p.Ab(1),p.jc("ngIf",!t.remoteOnly),p.Ab(1),p.jc("ngIf",t.remoteOnly)}}function Ct(t,e){1&t&&(p.Rb(0,"div",59),p.Mb(1,"i",60),p.Ec(2," Shared"),p.Qb())}function At(t,e){1&t&&(p.Rb(0,"div",61),p.Mb(1,"i",62),p.Ec(2," Local"),p.Qb())}function xt(t,e){if(1&t&&(p.Rb(0,"div",50),p.Mb(1,"i",63),p.Ec(2),p.Qb()),2&t){const t=p.dc(2).$implicit;p.Ab(2),p.Gc(" ",t.seed,"")}}function wt(t,e){1&t&&(p.Rb(0,"span",68),p.Ec(1,"None"),p.Qb())}function jt(t,e){if(1&t&&(p.Rb(0,"span",69),p.Ec(1),p.ec(2,"titlecase"),p.Qb()),2&t){const t=e.$implicit;p.Ab(1),p.Gc(" ",p.fc(2,1,t)," ")}}function yt(t,e){if(1&t&&(p.Rb(0,"div",4),p.Cc(1,wt,2,0,"span",66),p.Cc(2,jt,3,3,"span",67),p.Qb()),2&t){const t=p.dc(3).$implicit,e=p.dc(3);p.Ab(1),p.jc("ngIf",0==e.tags[t.id].length),p.Ab(1),p.jc("ngForOf",e.tags[t.id])}}function Ot(t,e){if(1&t&&(p.Pb(0),p.Rb(1,"div",47),p.Rb(2,"div",64),p.Ec(3,"Description"),p.Qb(),p.Ec(4),p.Qb(),p.Rb(5,"div",47),p.Rb(6,"div",64),p.Mb(7,"i",65),p.Ec(8," Tags"),p.Qb(),p.Cc(9,yt,3,2,"div",28),p.Qb(),p.Ob()),2&t){const t=p.dc(2).$implicit,e=p.dc(3);p.Ab(4),p.Gc(" ",t.description||"No description"," "),p.Ab(5),p.jc("ngIf",!!e.tags[t.id])}}function Tt(t,e){if(1&t){const t=p.Sb();p.Rb(0,"button",55),p.Zb("click",(function(){p.rc(t);const e=p.dc(2).$implicit;return p.dc(3).switchEnvironment(e)})),p.Ec(1,"Switch To This Stack"),p.Qb()}if(2&t){const t=p.dc(2).$implicit,e=p.dc(3);p.jc("disabled",e.isCurrentEnv(t))}}function Lt(t,e){if(1&t){const t=p.Sb();p.Rb(0,"button",57),p.Zb("click",(function(){p.rc(t);const e=p.dc(2).$implicit;return p.dc(3).deleteStack(e)})),p.Rb(1,"span"),p.Ec(2,"Delete Stack"),p.Qb(),p.Qb()}}function Mt(t,e){if(1&t){const t=p.Sb();p.Rb(0,"div",46),p.Rb(1,"div",12),p.Rb(2,"div",47),p.Cc(3,Ct,3,0,"div",48),p.Cc(4,At,3,0,"div",49),p.Rb(5,"div",50),p.Mb(6,"i",51),p.Ec(7),p.Qb(),p.Cc(8,xt,3,1,"div",52),p.Qb(),p.Mb(9,"mat-divider"),p.Cc(10,Ot,10,2,"ng-container",0),p.Qb(),p.Rb(11,"div",53),p.Cc(12,Tt,2,1,"button",54),p.Rb(13,"button",55),p.Zb("click",(function(){p.rc(t);const e=p.dc().$implicit;return p.dc(3).installIntoCurrentEnvironment(e)})),p.Ec(14,"Install Into Current "),p.Rb(15,"span",56),p.Ec(16),p.Qb(),p.Qb(),p.Rb(17,"button",57),p.Zb("click",(function(){p.rc(t);const e=p.dc().$implicit;return p.dc(3).installIntoNewWorkspace(e)})),p.Ec(18,"Install Into New Workspace"),p.Qb(),p.Rb(19,"button",57),p.Zb("click",(function(){p.rc(t);const e=p.dc().$implicit;return p.dc(3).shareStack(e)})),p.Ec(20,"Stack Settings"),p.Qb(),p.Cc(21,Lt,3,0,"button",58),p.Qb(),p.Qb()}if(2&t){const t=p.dc().$implicit,e=p.dc(3);p.Ab(3),p.jc("ngIf",t.remote),p.Ab(1),p.jc("ngIf",!t.remote&&t.isLocal),p.Ab(3),p.Gc(" ",t.codebasePath,""),p.Ab(1),p.jc("ngIf",t.seed),p.Ab(2),p.jc("ngIf",!(null==t.remote||!t.remote.id)),p.Ab(2),p.jc("ngIf",!t.remoteOnly),p.Ab(1),p.jc("disabled",e.isCurrentEnv(t)),p.Ab(3),p.Fc(e.currentEnvironment.type),p.Ab(5),p.jc("ngIf",!t.remoteOnly)}}function Ft(t,e){if(1&t){const t=p.Sb();p.Rb(0,"div",12),p.Rb(1,"div",13),p.Rb(2,"div",25),p.Rb(3,"div",26),p.Cc(4,ht,3,0,"div",27),p.Cc(5,pt,3,1,"div",28),p.Qb(),p.Rb(6,"div",4),p.Mb(7,"i",29),p.Qb(),p.Rb(8,"div",30),p.Zb("click",(function(){p.rc(t);const i=e.$implicit;return p.dc(3).toggleItemList(i)})),p.Mb(9,"stack-name",31),p.Qb(),p.Rb(10,"div",7),p.Cc(11,Et,3,2,"ng-container",0),p.Qb(),p.Rb(12,"div",32),p.Rb(13,"button",33),p.Zb("click",(function(){p.rc(t);const i=e.$implicit;return p.dc(3).toggleItemList(i)})),p.Mb(14,"i",34),p.Qb(),p.Qb(),p.Qb(),p.Cc(15,Mt,22,9,"div",35),p.Qb(),p.Qb()}if(2&t){const t=e.$implicit,i=p.dc(3);p.Ab(4),p.jc("ngIf",t.remoteOnly),p.Ab(1),p.jc("ngIf",!t.remoteOnly),p.Ab(2),p.Db("text-primary",i.isCurrentEnv(t))("text-muted",!i.isCurrentEnv(t)),p.Ab(1),p.Db("text-primary",i.isCurrentEnv(t)),p.Ab(1),p.jc("name",t.name)("prefix",null==t.remote||null==t.remote.organization?null:t.remote.organization.prefix),p.Ab(2),p.jc("ngIf",i.isLoggedIn),p.Ab(3),p.Db("fa-chevron-up",i.itemList[t.id])("fa-chevron-down",!i.itemList[t.id]),p.Ab(1),p.jc("ngIf",i.itemList[t.id])}}function Pt(t,e){if(1&t&&(p.Pb(0),p.Cc(1,ft,2,0,"div",23),p.Cc(2,Ft,16,16,"div",11),p.Ob()),2&t){const t=p.dc(2);p.Ab(1),p.jc("ngIf",0===t.stacks.length),p.Ab(1),p.jc("ngForOf",t.stacks)}}function $t(t,e){if(1&t){const t=p.Sb();p.Pb(0),p.Rb(1,"div",1),p.Rb(2,"div",2),p.Rb(3,"div",3),p.Rb(4,"div",4),p.Cc(5,mt,4,1,"ng-container",0),p.Rb(6,"div",5),p.Rb(7,"div",6),p.Ec(8,"My Stacks"),p.Qb(),p.Rb(9,"div",7),p.Rb(10,"button",8),p.Zb("click",(function(){return p.rc(t),p.dc().createNewStack()})),p.Mb(11,"i",9),p.Ec(12," New Stack"),p.Qb(),p.Qb(),p.Qb(),p.Cc(13,gt,8,0,"ng-container",0),p.Cc(14,Pt,3,2,"ng-container",0),p.Qb(),p.Qb(),p.Qb(),p.Qb(),p.Ob()}if(2&t){const t=p.dc();p.Ab(5),p.jc("ngIf",t.invites.length>0),p.Ab(8),p.jc("ngIf",!t.isLoggedIn),p.Ab(1),p.jc("ngIf",t.isLoggedIn)}}const Dt=c.f.forChild([{path:"",component:(()=>{class t{constructor(t,e,i,n,c,a,s,r){this.appEnvironmentService=t,this.dialog=e,this.userService=i,this.stackService=n,this.dialogService=c,this.appConsoleService=a,this.navigationService=s,this.myItemsService=r,this.invites=[],this.isLoggedIn=!1,this.itemList={},this.editables={},this.tags={},this.tagHover=null,this.subs=new o.a}ngOnInit(){this.getEnvironments(),this.getPendingInvites(),this.subs.add(this.userService.user$.subscribe(t=>{this.user=t,this.isLoggedIn=t.isLoggedIn})),this.subs.add(this.appEnvironmentService.currentEnvironment$.subscribe(t=>{this.currentEnvironment=t}))}toggleItemList(t){this.itemList[t.id]||this.loadTags(t),this.itemList[t.id]=!this.itemList[t.id]}loadTags(t){t.remote&&t.remote.id&&this.stackService.getTags(t.remote.id).pipe(Object(l.a)(1)).subscribe(e=>{this.tags[t.id]=e})}getEnvironments(){this.subs.add(this.stackService.userStacks().subscribe(t=>{this.stacks=t}))}createNewStack(){this.isLoggedIn?this.dialog.open(b.a,{data:{type:s.a.Environment.Type.Stack},minWidth:"600px",position:{top:"100px"},autoFocus:!0}).afterClosed().subscribe(()=>this.stackService.refresh()):this.dialogService.openMustLoginDialog()}ngOnDestroy(){}isCurrentEnv(t){var e;return(null===(e=this.currentEnvironment)||void 0===e?void 0:e.id)===t.id}switchEnvironment(t){this.appEnvironmentService.switchToEnvironment(t.id).pipe(Object(d.a)(()=>this.navigationService.navigateToEnvironmentHome())).subscribe(()=>null)}pushStack(t){this.stackService.publishStack(t.id).subscribe(e=>{var i;this.dialogService.openAlertDialog({title:"Push Successful",text:`${t.name} v${null===(i=e.remote)||void 0===i?void 0:i.version} has been published`})})}pullStack(t){this.stackService.syncStack(t.id,t.remote.version).subscribe(()=>{this.stackService.refresh(),this.dialogService.openAlertDialog({title:"Sync Stack",text:"Stack has been synced"})},t=>{var e;this.dialogService.openAlertDialog({title:"Sync Stack",text:(null===(e=t.error)||void 0===e?void 0:e.message)||"Server error!"})})}deleteStack(t){var e;const i=this.dialogService.openConfirmationDialog({title:`Delete stack ${t.name}?`,text:(null===(e=t.remote)||void 0===e?void 0:e.id)?"Deleting this stack will cause any unpublished changes to be lost":"Deleting this stack is a permanent action and cannot be undone.",button:{yes:"Delete",no:"Cancel"}});Object(r.a)([i.afterClosed(),this.appEnvironmentService.currentEnvironment$.pipe(Object(l.a)(1))]).subscribe(([e,i])=>{!0===e&&this.stackService.deleteStack(t.id).subscribe(()=>{t.id===i.id&&this.dialog.open(u.a,{data:{},disableClose:!0,position:{top:"100px"},autoFocus:!0}).afterClosed().subscribe(t=>console.log("dialog result: ",t)),this.stackService.refresh()})})}installIntoCurrentEnvironment(t){this.appConsoleService.openBluConsole({command:"install "+t.name,extraInfo:{stack:t,source:"local"}})}shareStack(t){this.user?this.dialog.open(it,{data:{environment:t,type:"stack"},width:"50vw",maxWidth:"800px",minWidth:"500px",position:{top:"100px"},autoFocus:!0}).afterClosed().subscribe(()=>{this.stackService.refresh()}):this.dialogService.openMustLoginDialog()}getPendingInvites(){this.subs.add(this.stackService.pendingInvites$.subscribe(t=>{this.invites=t}))}installIntoNewWorkspace(t){this.myItemsService.createNewWorkspace(t)}gotoLogin(){this.navigationService.navigateToLogin()}goToCreateAccount(){this.navigationService.navigateToCreateAccount()}acceptInvite(t){return Object(a.a)(this,void 0,void 0,(function*(){this.stackService.acceptInvite(t).pipe(Object(l.a)(1)).subscribe(()=>{this.stackService.fetchPendingInvites()})}))}declineInvite(t){return Object(a.a)(this,void 0,void 0,(function*(){this.stackService.declineInvite(t).pipe(Object(l.a)(1)).subscribe(()=>{this.stackService.fetchPendingInvites()})}))}}return t.\u0275fac=function(e){return new(e||t)(p.Lb(U.a),p.Lb(m.b),p.Lb(_.a),p.Lb(v.a),p.Lb(H.a),p.Lb(nt.a),p.Lb(ct.a),p.Lb(at.a))},t.\u0275cmp=p.Fb({type:t,selectors:[["my-stacks"]],decls:1,vars:1,consts:[[4,"ngIf"],[1,"basic-page","flex-column"],[1,"pt-3",2,"max-width","800px"],[1,"pl-3"],[1,""],[1,"pl-2","d-flex","align-items-start"],[1,"text-bold","py-2"],[1,"ml-auto"],["mat-button","",3,"click"],[1,"fa","fa-plus"],[1,"text-bold","p-2"],["class","p-2",4,"ngFor","ngForOf"],[1,"p-2"],[1,"shadow","p-2","border","rounded"],[1,"d-flex","align-items-center","justify-content-between"],[1,"pl-3","cursor-pointer"],[1,"subheader"],["mat-raised-button","",3,"click"],[1,"p-2","text-center","cursor-pointer"],[1,"",3,"click"],[1,"fa","fa-exclamation-circle"],[1,"fa","fa-arrow-alt-circle-right"],[1,"text-small","text-muted","hover-as-link","pt-2",3,"click"],["class","text-center p-2",4,"ngIf"],[1,"text-center","p-2"],[1,"d-flex","align-items-center"],[1,"pr-3"],["class","","style","width:40px; height:40px;",4,"ngIf"],["class","",4,"ngIf"],[1,"fa","fa-layer-group"],[1,"pl-2","cursor-pointer",3,"click"],[3,"name","prefix"],[1,"ml-1"],["mat-button","","mat-icon-button","",3,"click"],[1,"fa"],["class","border-top p-2 d-flex align-items-start",4,"ngIf"],[1,"",2,"width","40px","height","40px"],["mat-button","","mat-icon-button",""],[1,"fa","fa-download","text-muted"],["mat-button","","mat-icon-button","",3,"disabled","click"],[1,"fa","fa-exchange-alt"],["style","color: red",4,"ngIf"],["mat-button","",3,"title","click"],[1,"fa","fa-upload","text-muted"],[2,"color","red"],[3,"stack","onFinished"],[1,"border-top","p-2","d-flex","align-items-start"],[1,"my-2"],["class","text-muted text-small","matTooltip","This stack is shared with other users",4,"ngIf"],["class","text-muted text-small","matTooltip","This stack is present only on this machine",4,"ngIf"],[1,"text-small"],[1,"fa","fa-folder-open","mr-1"],["class","text-small",4,"ngIf"],[1,"ml-auto","p-2","border-left"],["mat-button","","class","d-block",3,"disabled","click",4,"ngIf"],["mat-button","",1,"d-block",3,"disabled","click"],[1,"text-capitalize"],["mat-button","",1,"d-block",3,"click"],["mat-button","","class","d-block",3,"click",4,"ngIf"],["matTooltip","This stack is shared with other users",1,"text-muted","text-small"],[1,"fa","fa-users","mr-1"],["matTooltip","This stack is present only on this machine",1,"text-muted","text-small"],[1,"fa","fa-desktop","mr-1"],[1,"fa","fa-seedling","mr-1"],[1,"text-tiny"],[1,"fa","fa-tags"],["class","ml-2",4,"ngIf"],["class","ml-2 badge badge-primary",4,"ngFor","ngForOf"],[1,"ml-2"],[1,"ml-2","badge","badge-primary"]],template:function(t,e){1&t&&p.Cc(0,$t,15,3,"ng-container",0),2&t&&p.jc("ngIf",e.stacks)},directives:[n.t,C.b,n.s,W.a,bt,lt.a,dt.a],pipes:[n.F],styles:[".codebase-path[_ngcontent-%COMP%]{font-size:9px;line-height:9px}[_nghost-%COMP%]{display:flex;flex:1}"]}),t})(),children:[]}]);var Nt=i("STbY"),Zt=i("NFeN");let zt=(()=>{class t{}return t.\u0275mod=p.Jb({type:t}),t.\u0275inj=p.Ib({factory:function(e){return new(e||t)},providers:[],imports:[[n.c,C.c,E.b]]}),t})();var Gt=i("7n/8");let Ut=(()=>{class t{}return t.\u0275mod=p.Jb({type:t}),t.\u0275inj=p.Ib({factory:function(e){return new(e||t)},providers:[],imports:[[n.c,m.g,N.b,g.m,C.c,S.c,g.B,R.b,E.b]]}),t})();var _t=i("bKa3");let Ht=(()=>{class t{}return t.\u0275mod=p.Jb({type:t}),t.\u0275inj=p.Ib({factory:function(e){return new(e||t)},providers:[],imports:[[n.c,Dt,C.c,Nt.c,Zt.b,zt,Gt.a,dt.b,Ut,g.m,N.b,lt.b,_t.a]]}),t})()}}]);