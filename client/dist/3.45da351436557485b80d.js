(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{"40nA":function(t,e,n){"use strict";n.d(e,"a",(function(){return d}));var i=n("fXoL"),r=n("N4Rb"),s=n("3sFK"),o=n("xm+p"),c=n("0IaG"),a=n("ofXK"),b=n("bTqV");function l(t,e){if(1&t){const t=i.Sb();i.Rb(0,"tr"),i.Rb(1,"td",2),i.Rb(2,"div",2),i.Fc(3),i.Qb(),i.Rb(4,"div",9),i.Fc(5),i.Qb(),i.Qb(),i.Rb(6,"td"),i.Rb(7,"button",10),i.Zb("click",(function(){i.rc(t);const e=i.dc().$implicit;return i.dc(2).selectWorkspace(e)})),i.Fc(8,"Select"),i.Qb(),i.Qb(),i.Qb()}if(2&t){const t=i.dc().$implicit;i.Ab(3),i.Hc(" ",t.name,""),i.Ab(2),i.Gc(t.codebasePath)}}function m(t,e){if(1&t&&(i.Pb(0),i.Dc(1,l,9,2,"tr",8),i.Ob()),2&t){const t=e.$implicit;i.Ab(1),i.jc("ngIf",!t.remoteOnly)}}function u(t,e){if(1&t&&(i.Rb(0,"table",4),i.Rb(1,"tr",5),i.Rb(2,"th",6),i.Fc(3,"My Workspaces"),i.Qb(),i.Qb(),i.Dc(4,m,2,1,"ng-container",7),i.Qb()),2&t){const t=i.dc();i.Ab(4),i.jc("ngForOf",t.workspaces)}}let d=(()=>{class t{constructor(t,e,n,i){this.workspaceService=t,this.appEnvironmentService=e,this.navigationService=n,this.dialogRef=i}ngOnInit(){this.getWorkspaces()}selectWorkspace(t){this.appEnvironmentService.switchToEnvironment(t.id).subscribe(()=>{this.navigationService.navigateTo(["app-environment"]),this.dialogRef.close()})}getWorkspaces(){this.workspaceService.userWorkspaces().subscribe(t=>{this.workspaces=t.sort((t,e)=>{var n,i;return(null===(n=t.name)||void 0===n?void 0:n.toLowerCase())>(null===(i=e.name)||void 0===i?void 0:i.toLowerCase())?1:-1})})}ngOnDestroy(){}close(){this.dialogRef.close(this.form.value)}}return t.\u0275fac=function(e){return new(e||t)(i.Lb(r.a),i.Lb(s.a),i.Lb(o.a),i.Lb(c.h))},t.\u0275cmp=i.Fb({type:t,selectors:[["select-environment-dialog"]],decls:5,vars:1,consts:[["mat-dialog-title",""],["mat-dialog-content",""],[1,""],["class","table",4,"ngIf"],[1,"table"],[1,"border-top-0"],[1,"text-capitalize","border-top-0"],[4,"ngFor","ngForOf"],[4,"ngIf"],[1,"codebase-path","text-muted"],["mat-raised-button","",3,"click"]],template:function(t,e){1&t&&(i.Rb(0,"h1",0),i.Fc(1,"Select Workspace"),i.Qb(),i.Rb(2,"div",1),i.Rb(3,"div",2),i.Dc(4,u,5,1,"table",3),i.Qb(),i.Qb()),2&t&&(i.Ab(4),i.jc("ngIf",(null==e.workspaces?null:e.workspaces.length)>0))},directives:[c.i,c.f,a.t,a.s,b.b],styles:[".mat-form-field[_ngcontent-%COMP%], .mat-radio-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin:15px 0}.mat-radio-button[_ngcontent-%COMP%]{margin:5px}"]}),t})()},"5Trv":function(t,e,n){"use strict";n.d(e,"a",(function(){return Pt}));var i=n("mrSG"),r=n("0IaG"),s=n("3Pt+"),o=n("quSY"),c=n("itXk"),a=n("LRne"),b=n("HdQx"),l=n("PE4B");class m{static UUID(){return m.UUIDv4("xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx")}static UUIDShort(){return m.UUIDv4("xxxxxxxx")}static UUIDv4(t){return t.replace(/[xy]/g,t=>{const e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)})}static merge(t,e){return l(t,e)}}var u=n("IzEk"),d=n("eIep"),f=n("nYR2"),v=n("aSHc"),p=n("fXoL"),h=n("oCqB"),g=n("ofXK"),S=n("QibW"),P=n("bv9b"),k=n("bTqV");function y(t,e){if(1&t&&(p.Pb(0),p.Rb(1,"form",5),p.Rb(2,"mat-radio-group",6),p.Rb(3,"mat-radio-button",7),p.Fc(4,"Make Stack Public"),p.Qb(),p.Rb(5,"mat-radio-button",7),p.Fc(6,"Make Stack Private"),p.Qb(),p.Qb(),p.Rb(7,"div",8),p.Rb(8,"div",9),p.Fc(9,"Public: \xa0\xa0Anyone can install this stack."),p.Qb(),p.Rb(10,"div",9),p.Fc(11,"Private: Only users who have access to this stack can install it."),p.Qb(),p.Qb(),p.Qb(),p.Ob()),2&t){const t=p.dc();p.Ab(1),p.jc("formGroup",t.form),p.Ab(2),p.jc("value","public"),p.Ab(2),p.jc("value","private")}}function R(t,e){1&t&&(p.Rb(0,"div",10),p.Rb(1,"div"),p.Fc(2,"Publishing Stack..."),p.Qb(),p.Mb(3,"mat-progress-bar",11),p.Qb())}function x(t,e){if(1&t&&(p.Pb(0),p.Rb(1,"div",12),p.Mb(2,"i",13),p.Fc(3),p.Qb(),p.Ob()),2&t){const t=p.dc();p.Ab(3),p.Hc(" Stack: ",t.data.stack.name," has been published! ")}}function A(t,e){if(1&t&&(p.Rb(0,"div",18),p.Fc(1),p.Qb()),2&t){const t=p.dc(2);p.Ab(1),p.Hc("Error: ",t.errorMessage,"")}}function I(t,e){if(1&t&&(p.Pb(0),p.Rb(1,"div",14),p.Mb(2,"i",15),p.Fc(3," Failed to publish stack: "),p.Rb(4,"span",16),p.Fc(5),p.Qb(),p.Fc(6,". "),p.Qb(),p.Dc(7,A,2,1,"div",17),p.Ob()),2&t){const t=p.dc();p.Ab(5),p.Gc(t.data.stack.name),p.Ab(2),p.jc("ngIf",t.errorMessage)}}function O(t,e){if(1&t){const t=p.Sb();p.Pb(0),p.Rb(1,"button",19),p.Fc(2,"Cancel"),p.Qb(),p.Rb(3,"button",20),p.Zb("click",(function(){return p.rc(t),p.dc().publish()})),p.Fc(4,"Publish"),p.Qb(),p.Ob()}if(2&t){const t=p.dc();p.Ab(3),p.jc("disabled",t.form.invalid)}}function j(t,e){if(1&t){const t=p.Sb();p.Pb(0),p.Rb(1,"button",21),p.Zb("click",(function(){return p.rc(t),p.dc().close()})),p.Fc(2,"Close"),p.Qb(),p.Ob()}}let w=(()=>{class t{constructor(t,e,n,i){this.fb=t,this.stackService=e,this.data=n,this.dialogRef=i,this.actionState=v.a,this.currentState=v.a.IDLE,this.form=this.fb.group({textInput:[],visibility:["public",[s.E.required]],select:[]})}ngOnInit(){this.errorMessage=null,this.form.valueChanges.subscribe(t=>{})}ngOnDestroy(){}close(){this.dialogRef.close(this.form.value)}publish(){this.currentState=v.a.ACQUIRING,this.stackService.publishStack(this.data.stack.id).subscribe(()=>{this.dialogRef.close()},t=>{this.currentState=v.a.FAILED,this.errorMessage=t.message||"Unknown error occurred while trying to publish stack."})}}return t.\u0275fac=function(e){return new(e||t)(p.Lb(s.f),p.Lb(h.a),p.Lb(r.a),p.Lb(r.h))},t.\u0275cmp=p.Fb({type:t,selectors:[["publish-stack-dialog"]],decls:10,vars:7,consts:[["mat-dialog-title",""],["mat-dialog-content",""],[4,"ngIf"],["class","text-center p-2",4,"ngIf"],["mat-dialog-actions","",3,"align"],[3,"formGroup"],["aria-label","Select an option","formControlName","visibility",1,"mat-radio-group"],[1,"mat-radio-button",3,"value"],[1,"pb-2"],[1,"text-small","text-muted"],[1,"text-center","p-2"],["mode","indeterminate"],[1,"text-center","p-2","text-success"],[1,"fa","fa-check","mr-2"],[1,"text-center","p-2","text-red"],[1,"fa","fa-times-circle","mr-2"],[1,"text-capitalize"],["class","text-muted text-small pl-5",4,"ngIf"],[1,"text-muted","text-small","pl-5"],["mat-button","","mat-dialog-close",""],["mat-button","",3,"disabled","click"],["mat-button","",3,"click"]],template:function(t,e){1&t&&(p.Rb(0,"h1",0),p.Fc(1,"Publish Stack"),p.Qb(),p.Rb(2,"div",1),p.Dc(3,y,12,3,"ng-container",2),p.Dc(4,R,4,0,"div",3),p.Dc(5,x,4,1,"ng-container",2),p.Dc(6,I,8,2,"ng-container",2),p.Qb(),p.Rb(7,"div",4),p.Dc(8,O,5,1,"ng-container",2),p.Dc(9,j,3,0,"ng-container",2),p.Qb()),2&t&&(p.Ab(3),p.jc("ngIf",e.currentState===e.actionState.IDLE),p.Ab(1),p.jc("ngIf",e.currentState===e.actionState.ACQUIRING),p.Ab(1),p.jc("ngIf",e.currentState===e.actionState.SUCCESS),p.Ab(1),p.jc("ngIf",e.currentState===e.actionState.FAILED),p.Ab(1),p.jc("align","end"),p.Ab(1),p.jc("ngIf",e.currentState===e.actionState.IDLE),p.Ab(1),p.jc("ngIf",e.currentState===e.actionState.SUCCESS||e.currentState===e.actionState.FAILED))},directives:[r.i,r.f,g.t,r.c,s.G,s.r,s.j,S.b,s.q,s.i,S.a,P.a,k.b,r.d],styles:[".mat-form-field[_ngcontent-%COMP%], .mat-radio-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin:15px 0}.mat-radio-button[_ngcontent-%COMP%]{margin:5px}"]}),t})();var E=n("3sFK"),Q=n("N4Rb"),D=n("biaL"),F=n("nZ6g"),C=n("+0xr"),M=n("d3UM"),L=n("FKr1"),U=n("zkoq"),G=n("kmnG"),T=n("qFsG");function W(t,e){1&t&&(p.Pb(0),p.Mb(1,"br"),p.Mb(2,"mat-progress-bar",5),p.Mb(3,"br"),p.Ob())}function $(t,e){1&t&&(p.Rb(0,"h4",16),p.Fc(1,"You must be an administrator to change these settings"),p.Qb())}function q(t,e){1&t&&p.Mb(0,"th",17)}function H(t,e){1&t&&(p.Rb(0,"div",22),p.Fc(1,"Primary Owner"),p.Qb())}function _(t,e){if(1&t&&(p.Rb(0,"div",20),p.Rb(1,"div"),p.Fc(2),p.Qb(),p.Dc(3,H,2,0,"div",21),p.Qb()),2&t){const t=p.dc().$implicit,e=p.dc(3);p.Ab(2),p.Gc(e.userProfiles.get(t).email||"Unknown user"),p.Ab(1),p.jc("ngIf",t==e.environment.remote.owner)}}function Z(t,e){if(1&t&&(p.Rb(0,"td",18),p.Dc(1,_,4,2,"div",19),p.Qb()),2&t){const t=e.$implicit,n=p.dc(3);p.Ab(1),p.jc("ngIf",n.userProfiles.has(t))}}function N(t,e){1&t&&(p.Rb(0,"th",17),p.Fc(1,"Permission"),p.Qb())}function V(t,e){if(1&t&&(p.Rb(0,"mat-option",25),p.Fc(1),p.ec(2,"titlecase"),p.Qb()),2&t){const t=e.$implicit;p.jc("value",t.value),p.Ab(1),p.Hc(" ",p.fc(2,2,t.key)," ")}}function K(t,e){if(1&t){const t=p.Sb();p.Pb(0),p.Rb(1,"mat-select",23),p.Zb("valueChange",(function(e){p.rc(t);const n=p.dc().$implicit;return p.dc(3).dirtyEnvPerms[n].permission=e})),p.Dc(2,V,3,4,"mat-option",24),p.ec(3,"keyvalue"),p.Qb(),p.Ob()}if(2&t){const t=p.dc().$implicit,e=p.dc(3);p.Ab(1),p.jc("value",e.dirtyEnvPerms[t].permission),p.Ab(1),p.jc("ngForOf",p.gc(3,2,e.envPermissions,e.originalOrder))}}function X(t,e){if(1&t&&(p.Pb(0),p.Fc(1),p.ec(2,"titlecase"),p.Ob()),2&t){const t=p.dc().$implicit,e=p.dc(3);p.Ab(1),p.Hc(" ",p.fc(2,1,e.convertPermissionToString(e.dirtyEnvPerms[t].permission))," ")}}function z(t,e){if(1&t&&(p.Rb(0,"td",18),p.Dc(1,K,4,5,"ng-container",2),p.Dc(2,X,3,3,"ng-container",2),p.Qb()),2&t){const t=p.dc(3);p.Ab(1),p.jc("ngIf",t.userIsAdmin),p.Ab(1),p.jc("ngIf",!t.userIsAdmin)}}function B(t,e){1&t&&(p.Rb(0,"th",17),p.Fc(1,"Actions"),p.Qb())}function Y(t,e){if(1&t){const t=p.Sb();p.Pb(0),p.Rb(1,"button",27),p.Zb("click",(function(){p.rc(t);const e=p.dc().$implicit;return p.dc(3).save(e)})),p.Fc(2," Save "),p.Qb(),p.Rb(3,"button",28),p.Zb("click",(function(){p.rc(t);const e=p.dc().$implicit;return p.dc(3).revoke(e)})),p.Fc(4,"Revoke"),p.Qb(),p.Ob()}if(2&t){const t=p.dc().$implicit,e=p.dc(3);p.Ab(1),p.jc("disabled",e.dirtyEnvPerms[t].permission===e.environment.remote.permissions[t].permission)}}function J(t,e){1&t&&(p.Pb(0),p.Mb(1,"mat-progress-bar",5),p.Ob())}function tt(t,e){if(1&t&&(p.Rb(0,"td",26),p.Dc(1,Y,5,1,"ng-container",2),p.Dc(2,J,2,0,"ng-container",2),p.Qb()),2&t){const t=e.$implicit,n=p.dc(3);p.Ab(1),p.jc("ngIf",!n.dirtyEnvPerms[t].saving),p.Ab(1),p.jc("ngIf",n.dirtyEnvPerms[t].saving)}}function et(t,e){1&t&&p.Mb(0,"tr",29)}function nt(t,e){1&t&&p.Mb(0,"tr",30)}function it(t,e){1&t&&p.Mb(0,"th",17)}function rt(t,e){if(1&t&&(p.Pb(0),p.Fc(1),p.Ob()),2&t){const t=p.dc().$implicit,e=p.dc(5);p.Ab(1),p.Hc(" ",e.userProfiles.get(t).username||e.userProfiles.get(t).email||"Unknown user"," ")}}function st(t,e){if(1&t&&(p.Rb(0,"td",18),p.Dc(1,rt,2,1,"ng-container",2),p.Qb()),2&t){const t=e.$implicit,n=p.dc(5);p.Ab(1),p.jc("ngIf",n.userProfiles.has(t))}}function ot(t,e){1&t&&(p.Rb(0,"th",17),p.Fc(1,"Actions"),p.Qb())}function ct(t,e){if(1&t){const t=p.Sb();p.Pb(0),p.Rb(1,"button",40),p.Zb("click",(function(){p.rc(t);const e=p.dc().$implicit;return p.dc(5).resendInvite(e)})),p.Fc(2,"Resend Invite"),p.Qb(),p.Rb(3,"button",28),p.Zb("click",(function(){p.rc(t);const e=p.dc().$implicit;return p.dc(5).cancelShare(e)})),p.Fc(4,"Cancel Invite"),p.Qb(),p.Ob()}}function at(t,e){1&t&&(p.Pb(0),p.Mb(1,"mat-progress-bar",5),p.Ob())}function bt(t,e){if(1&t&&(p.Rb(0,"td",26),p.Dc(1,ct,5,0,"ng-container",2),p.Dc(2,at,2,0,"ng-container",2),p.Qb()),2&t){const t=e.$implicit,n=p.dc(5);p.Ab(1),p.jc("ngIf",!n.dirtyEnvPerms[t].saving),p.Ab(1),p.jc("ngIf",n.dirtyEnvPerms[t].saving)}}function lt(t,e){1&t&&p.Mb(0,"tr",29)}function mt(t,e){1&t&&p.Mb(0,"tr",30)}const ut=function(){return["email","actions"]};function dt(t,e){if(1&t&&(p.Pb(0),p.Rb(1,"h4",39),p.Fc(2,"Pending Invites"),p.Qb(),p.Rb(3,"table",7),p.Pb(4,8),p.Dc(5,it,1,0,"th",9),p.Dc(6,st,2,1,"td",10),p.Ob(),p.Pb(7,12),p.Dc(8,ot,2,0,"th",9),p.Dc(9,bt,3,2,"td",13),p.Ob(),p.Dc(10,lt,1,0,"tr",14),p.Dc(11,mt,1,0,"tr",15),p.Qb(),p.Ob()),2&t){const t=p.dc(4);p.Ab(3),p.jc("dataSource",t.getInviteIds()),p.Ab(7),p.jc("matHeaderRowDef",p.kc(3,ut)),p.Ab(1),p.jc("matRowDefColumns",p.kc(4,ut))}}function ft(t,e){if(1&t&&(p.Rb(0,"mat-option",25),p.Fc(1),p.ec(2,"titlecase"),p.Qb()),2&t){const t=e.$implicit;p.jc("value",t.value),p.Ab(1),p.Hc(" ",p.fc(2,2,t.key)," ")}}function vt(t,e){if(1&t){const t=p.Sb();p.Pb(0),p.Dc(1,dt,12,5,"ng-container",2),p.Rb(2,"form",31),p.Zb("submit",(function(){return p.rc(t),p.dc(3).share()})),p.Rb(3,"mat-grid-list",32),p.Rb(4,"mat-grid-tile",33),p.Rb(5,"mat-form-field"),p.Rb(6,"mat-label"),p.Fc(7,"Email"),p.Qb(),p.Mb(8,"input",34),p.Qb(),p.Qb(),p.Rb(9,"mat-grid-tile",35),p.Rb(10,"mat-form-field"),p.Rb(11,"mat-label"),p.Fc(12,"Permissions"),p.Qb(),p.Rb(13,"mat-select",36),p.Dc(14,ft,3,4,"mat-option",24),p.ec(15,"keyvalue"),p.Qb(),p.Qb(),p.Qb(),p.Rb(16,"mat-grid-tile",37),p.Rb(17,"button",38),p.Fc(18,"Add"),p.Qb(),p.Qb(),p.Qb(),p.Qb(),p.Ob()}if(2&t){const t=p.dc(3);p.Ab(1),p.jc("ngIf",t.getInviteIds().length>0),p.Ab(1),p.jc("formGroup",t.form),p.Ab(12),p.jc("ngForOf",p.gc(15,3,t.envPermissions,t.originalOrder))}}const pt=function(){return["email","perm","actions"]},ht=function(){return["email","perm"]};function gt(t,e){if(1&t&&(p.Pb(0),p.Dc(1,$,2,0,"h4",6),p.Pb(2),p.Rb(3,"table",7),p.Pb(4,8),p.Dc(5,q,1,0,"th",9),p.Dc(6,Z,2,1,"td",10),p.Ob(),p.Pb(7,11),p.Dc(8,N,2,0,"th",9),p.Dc(9,z,3,2,"td",10),p.Ob(),p.Pb(10,12),p.Dc(11,B,2,0,"th",9),p.Dc(12,tt,3,2,"td",13),p.Ob(),p.Dc(13,et,1,0,"tr",14),p.Dc(14,nt,1,0,"tr",15),p.Qb(),p.Ob(),p.Dc(15,vt,19,6,"ng-container",2),p.Ob()),2&t){const t=p.dc(2);p.Ab(1),p.jc("ngIf",!t.userIsAdmin),p.Ab(2),p.jc("dataSource",t.getUserWithPermIds()),p.Ab(10),p.jc("matHeaderRowDef",t.userIsAdmin?p.kc(5,pt):p.kc(6,ht)),p.Ab(1),p.jc("matRowDefColumns",t.userIsAdmin?p.kc(7,pt):p.kc(8,ht)),p.Ab(1),p.jc("ngIf",t.userIsAdmin)}}function St(t,e){if(1&t&&(p.Pb(0),p.Dc(1,gt,16,9,"ng-container",2),p.Ob()),2&t){const t=p.dc();p.Ab(1),p.jc("ngIf",t.environment.remote)}}let Pt=(()=>{class t{constructor(t,e,n,r,s,l,m,f,v){this.fb=t,this.dialog=e,this.stackService=n,this.appEnvironmentService=r,this.workspaceService=s,this.userService=l,this.dialogService=m,this.dialogRef=f,this.data=v,this.loading=!0,this.userIsAdmin=!1,this.userProfiles=new Map,this.envPermissions=new Map([["read",b.a.Environment.EnvironmentPermissions.read],["write",b.a.Environment.EnvironmentPermissions.write],["admin",b.a.Environment.EnvironmentPermissions.admin],["owner",b.a.Environment.EnvironmentPermissions.owner]]),this.subs=new o.a,this.originalOrder=(t,e)=>0,this.publishStack=()=>Object(i.a)(this,void 0,void 0,(function*(){this.dialog.open(w,{data:{stack:this.environment},position:{top:"100px"},minWidth:"400px",autoFocus:!0}).afterClosed().subscribe(()=>{const t=this.stackService.userStacks().pipe(Object(u.a)(1)).subscribe(e=>{this.environment=e.find(t=>t.id=this.environment.id),this.setupShareSettings(),this.loading=!1,t.unsubscribe()})})})),this.publishWorkspace=()=>Object(i.a)(this,void 0,void 0,(function*(){this.loading=!0,this.subs.add(this.workspaceService.publishWorkspace(this.environment.id).pipe(Object(d.a)(t=>Object(c.a)([Object(a.a)(t),this.workspaceService.userWorkspaces().pipe(Object(u.a)(1))]))).subscribe(([t,e])=>{this.environment=e.find(e=>e.id===t.id),this.setupShareSettings(),this.loading=!1},t=>{this.dialogService.openAlertDialog({title:"Publish Workspace",text:"Error: "+(t.message||"Server error!")}),this.loading=!1}))})),this.environment=v.environment,this.environmentType=v.type,this.subs.add(this.userService.user$.subscribe(t=>{t&&(this.userId=t.uid)}))}ngOnInit(){this.environment.remote?(this.setupShareSettings(),this.loading=!1):this.publish()}run(t,e){return"stack"===this.environmentType?t():"workspace"===this.environmentType?e():void 0}setupShareSettings(){var t;return Object(i.a)(this,void 0,void 0,(function*(){this.userIsAdmin=(null===(t=this.environment.remote)||void 0===t?void 0:t.permissions[this.userId].permission)>=this.envPermissions.get("admin"),this.dirtyEnvPerms=Object.entries(m.merge(this.environment.remote.invites,this.environment.remote.permissions)).reduce((t,e)=>(t[e[0]]=Object.assign(Object.assign({},e[1]),{saving:!1}),t),{}),this.form=this.fb.group({emailToAdd:["",[s.E.required,s.E.email]],permission:[this.envPermissions.get("read"),[s.E.required]]}),yield this.getUserProfilesForEnvironment()}))}getUserProfilesForEnvironment(){return Object(i.a)(this,void 0,void 0,(function*(){(yield this.workspaceService.getUserProfilesFor(this.environment.remote.id).pipe(Object(u.a)(1)).toPromise()).forEach(t=>this.userProfiles.set(t.uid,t))}))}getUserWithPermIds(){var t;return Object.keys((null===(t=this.environment.remote)||void 0===t?void 0:t.permissions)||{}).sort((t,e)=>this.environment.remote.permissions[t].permission<=this.environment.remote.permissions[e].permission?1:-1)}getInviteIds(){var t;return Object.keys((null===(t=this.environment.remote)||void 0===t?void 0:t.invites)||{})}ngOnDestroy(){this.subs.unsubscribe()}close(){this.dialogRef.close()}convertPermissionToString(t){switch(t){case b.a.Environment.EnvironmentPermissions.read:return"Read";case b.a.Environment.EnvironmentPermissions.write:return"Write";case b.a.Environment.EnvironmentPermissions.admin:return"Admin";case b.a.Environment.EnvironmentPermissions.owner:return"Owner"}}share(){this.form.disable();const{emailToAdd:t,permission:e}=this.form.getRawValue();this.workspaceService.share(this.environment.remote.id,t,e).pipe(Object(u.a)(1),Object(f.a)(()=>{this.form.enable()})).subscribe(t=>{const{userId:n}=t;this.environment.remote.invites[n]={permission:e},this.userProfiles.set(n,{username:"Loading...",email:"",uid:n}),this.dirtyEnvPerms[n]={permission:e,saving:!1},this.getUserProfilesForEnvironment(),this.form.reset()},t=>{this.dialogService.openAlertDialog({title:"Share Workspace",text:"Error while sharing"}),console.log(t)})}cancelShare(t){this.dirtyEnvPerms[t].saving=!0,this.workspaceService.cancelShare(this.environment.remote.id,t).pipe(Object(u.a)(1)).subscribe(()=>{delete this.environment.remote.invites[t],delete this.dirtyEnvPerms[t]},e=>{this.dialogService.openAlertDialog({title:"Share Workspace",text:""+(e.message||"Unknown error occurred!")}),this.dirtyEnvPerms[t].saving=!1})}resendInvite(t){this.dirtyEnvPerms[t].saving=!0,this.workspaceService.share(this.environment.remote.id,this.userProfiles.get(t).email,this.environment.remote.invites[t].permission).pipe(Object(u.a)(1)).subscribe(()=>{this.dialogService.openAlertDialog({title:"Send Invite",text:"Invite sent successfully."})},t=>{this.dialogService.openAlertDialog({title:"Send Invite",text:"Invite failed to be sent, please try again later."})},()=>{this.dirtyEnvPerms[t].saving=!1})}publish(){return Object(i.a)(this,void 0,void 0,(function*(){yield this.run(this.publishStack,this.publishWorkspace)}))}save(t){this.dirtyEnvPerms[t].saving=!0,this.workspaceService.updateUserPermission(this.environment.remote.id,t,this.dirtyEnvPerms[t].permission).pipe(Object(u.a)(1)).toPromise().then(()=>{this.environment.remote.permissions[t].permission=this.dirtyEnvPerms[t].permission}).catch(e=>{this.dirtyEnvPerms[t].permission=this.environment.remote.permissions[t].permission,this.dialogService.openAlertDialog({title:"Sync Stack",text:""+(e.message||"Unknown error occurred!")})}).finally(()=>{this.dirtyEnvPerms[t].saving=!1})}revoke(t){t===this.environment.remote.owner?this.dialogService.openAlertDialog({title:"Revoke Access",text:"You cannot revoke the permissions of the original owner!"}):this.dialogService.openConfirmationDialog({title:"Revoke Access",text:"This will revoke all permissions from the user "+(this.userProfiles.get(t).username||this.userProfiles.get(t).email),button:{yes:"Revoke",no:"Cancel"}}).afterClosed().subscribe(e=>{!0===e&&(this.dirtyEnvPerms[t].saving=!0,this.workspaceService.revokeUserPermission(this.environment.remote.id,t).pipe(Object(u.a)(1)).toPromise().then(()=>{delete this.environment.remote.permissions[t],delete this.dirtyEnvPerms[t]}).catch(e=>{this.dialogService.openAlertDialog({title:"Revoke Access",text:"Error: "+(e.message||"Unknown error occurred!")}),this.dirtyEnvPerms[t].saving=!1}))})}}return t.\u0275fac=function(e){return new(e||t)(p.Lb(s.f),p.Lb(r.b),p.Lb(h.a),p.Lb(E.a),p.Lb(Q.a),p.Lb(D.a),p.Lb(F.a),p.Lb(r.h),p.Lb(r.a))},t.\u0275cmp=p.Fb({type:t,selectors:[["new-environment-dialog"]],decls:8,vars:3,consts:[["mat-dialog-title",""],["mat-dialog-content",""],[4,"ngIf"],["mat-dialog-actions","",3,"align"],["mat-button","","mat-dialog-close",""],["mode","indeterminate"],["class","text-grey",4,"ngIf"],["mat-table","",1,"permTable",3,"dataSource"],["matColumnDef","email"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","perm"],["matColumnDef","actions"],["mat-cell","","class","tableActions",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],[1,"text-grey"],["mat-header-cell",""],["mat-cell",""],["class","pt-1",4,"ngIf"],[1,"pt-1"],["class","text-muted text-small",4,"ngIf"],[1,"text-muted","text-small"],[3,"value","valueChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["mat-cell","",1,"tableActions"],["mat-button","","mat-raised-button","","color","primary",3,"disabled","click"],["mat-button","","mat-raised-button","","color","warn",3,"click"],["mat-header-row",""],["mat-row",""],[3,"formGroup","submit"],["cols","7"],["colspan","4"],["type","email","matInput","","formControlName","emailToAdd"],["colspan","2"],["formControlName","permission"],["colspan","1"],["mat-button","","mat-raised-button","","color","primary","type","submit"],[2,"margin-top","15px","margin-bottom","0"],["mat-button","","mat-raised-button","","color","primary",3,"click"]],template:function(t,e){1&t&&(p.Rb(0,"h1",0),p.Fc(1,"Share Settings"),p.Qb(),p.Rb(2,"div",1),p.Dc(3,W,4,0,"ng-container",2),p.Dc(4,St,2,1,"ng-container",2),p.Qb(),p.Rb(5,"div",3),p.Rb(6,"button",4),p.Fc(7,"Close"),p.Qb(),p.Qb()),2&t&&(p.Ab(3),p.jc("ngIf",e.loading),p.Ab(1),p.jc("ngIf",!e.loading),p.Ab(1),p.jc("align","end"))},directives:[r.i,r.f,g.t,r.c,k.b,r.d,P.a,C.j,C.c,C.e,C.b,C.g,C.i,C.d,C.a,M.a,g.s,L.k,C.f,C.h,s.G,s.r,s.j,U.a,U.c,G.c,G.g,T.a,s.c,s.q,s.i],pipes:[g.l,g.F],styles:["mat-form-field[_ngcontent-%COMP%]{width:100%;padding:0 5px}.permTable[_ngcontent-%COMP%]{width:100%}.tableActions[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{margin-right:5px}"]}),t})()},"7n/8":function(t,e,n){"use strict";n.d(e,"a",(function(){return m}));var i=n("ofXK"),r=n("bTqV"),s=n("0IaG"),o=n("qFsG"),c=n("QibW"),a=n("d3UM"),b=n("3Pt+"),l=n("fXoL");let m=(()=>{class t{}return t.\u0275mod=l.Jb({type:t}),t.\u0275inj=l.Ib({factory:function(e){return new(e||t)},providers:[],imports:[[i.c,s.g,o.b,b.l,r.c,c.c,b.A,a.b]]}),t})()},EVKI:function(t,e,n){"use strict";n.d(e,"a",(function(){return l}));var i=n("0IaG"),r=n("3Pt+"),s=n("fXoL"),o=n("3sFK"),c=n("kmnG"),a=n("qFsG"),b=n("bTqV");let l=(()=>{class t{constructor(t,e,n,i){var s;this.fb=t,this.appEnvironmentService=e,this.data=n,this.dialogRef=i,this.form=this.fb.group({name:[null===(s=this.data.environment)||void 0===s?void 0:s.name,[r.E.required]]})}ngOnInit(){this.form.valueChanges.subscribe(t=>{})}ngOnDestroy(){}close(){this.dialogRef.close(this.form.value)}save(){this.appEnvironmentService.rename(this.data.environment.id,this.form.controls.name.value).subscribe(t=>{this.dialogRef.close({success:!0})},t=>{})}}return t.\u0275fac=function(e){return new(e||t)(s.Lb(r.f),s.Lb(o.a),s.Lb(i.a),s.Lb(i.h))},t.\u0275cmp=s.Fb({type:t,selectors:[["rename-environment-dialog"]],decls:13,vars:5,consts:[["mat-dialog-title",""],["mat-dialog-content",""],[3,"formGroup"],[1,"mat-form-field"],["placeholder","Text Input","matInput","","formControlName","name"],["mat-dialog-actions","",3,"align"],["mat-button","","mat-dialog-close",""],["mat-button","",3,"disabled","click"]],template:function(t,e){1&t&&(s.Rb(0,"h1",0),s.Fc(1),s.Rb(2,"span"),s.Fc(3),s.Qb(),s.Qb(),s.Rb(4,"div",1),s.Rb(5,"form",2),s.Rb(6,"mat-form-field",3),s.Mb(7,"input",4),s.Qb(),s.Qb(),s.Qb(),s.Rb(8,"div",5),s.Rb(9,"button",6),s.Fc(10,"Cancel"),s.Qb(),s.Rb(11,"button",7),s.Zb("click",(function(){return e.save()})),s.Fc(12,"Rename"),s.Qb(),s.Qb()),2&t&&(s.Ab(1),s.Hc("Rename ",e.data.environment.name," "),s.Ab(2),s.Gc(e.data.environment.type),s.Ab(2),s.jc("formGroup",e.form),s.Ab(3),s.jc("align","end"),s.Ab(3),s.jc("disabled",e.form.invalid))},directives:[i.i,i.f,r.G,r.r,r.j,c.c,a.a,r.c,r.q,r.i,i.c,b.b,i.d],styles:[".mat-form-field[_ngcontent-%COMP%], .mat-radio-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin:15px 0}.mat-radio-button[_ngcontent-%COMP%]{margin:5px}"]}),t})()},PE4B:function(t,e,n){"use strict";var i=function(t){return function(t){return!!t&&"object"==typeof t}(t)&&!function(t){var e=Object.prototype.toString.call(t);return"[object RegExp]"===e||"[object Date]"===e||function(t){return t.$$typeof===r}(t)}(t)},r="function"==typeof Symbol&&Symbol.for?Symbol.for("react.element"):60103;function s(t,e){return!1!==e.clone&&e.isMergeableObject(t)?b(Array.isArray(t)?[]:{},t,e):t}function o(t,e,n){return t.concat(e).map((function(t){return s(t,n)}))}function c(t){return Object.keys(t).concat(function(t){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(t).filter((function(e){return t.propertyIsEnumerable(e)})):[]}(t))}function a(t,e){try{return e in t}catch(n){return!1}}function b(t,e,n){(n=n||{}).arrayMerge=n.arrayMerge||o,n.isMergeableObject=n.isMergeableObject||i,n.cloneUnlessOtherwiseSpecified=s;var r=Array.isArray(e);return r===Array.isArray(t)?r?n.arrayMerge(t,e,n):function(t,e,n){var i={};return n.isMergeableObject(t)&&c(t).forEach((function(e){i[e]=s(t[e],n)})),c(e).forEach((function(r){(function(t,e){return a(t,e)&&!(Object.hasOwnProperty.call(t,e)&&Object.propertyIsEnumerable.call(t,e))})(t,r)||(i[r]=a(t,r)&&n.isMergeableObject(e[r])?function(t,e){if(!e.customMerge)return b;var n=e.customMerge(t);return"function"==typeof n?n:b}(r,n)(t[r],e[r],n):s(e[r],n))})),i}(t,e,n):s(e,n)}b.all=function(t,e){if(!Array.isArray(t))throw new Error("first argument should be an array");return t.reduce((function(t,n){return b(t,n,e)}),{})},t.exports=b},k1Ex:function(t,e,n){"use strict";n.d(e,"a",(function(){return m}));var i=n("HdQx"),r=n("b5vT"),s=n("IzEk"),o=n("fXoL"),c=n("0IaG"),a=n("a8/g"),b=n("xm+p"),l=n("3sFK");let m=(()=>{class t{constructor(t,e,n,i){this.dialog=t,this.appConsoleService=e,this.navigationService=n,this.appEnvironmentService=i}createNewWorkspace(t){const e=this.dialog.open(r.a,{data:{type:i.a.Environment.Type.Workspace,stack:t},disableClose:!0,minWidth:"600px",position:{top:"100px"},autoFocus:!0});return e.afterClosed().subscribe(e=>{e.continue&&this.appEnvironmentService.switchToEnvironment(e.newEnvironment.id).subscribe(e=>{setTimeout(()=>{this.appConsoleService.openBluConsole({command:"install "+t.displayName,extraInfo:{stack:t}}).afterClosed().pipe(Object(s.a)(1)).subscribe(t=>this.navigationService.navigateTo(["app-environment"]))},250)})}),e}}return t.\u0275fac=function(e){return new(e||t)(o.Vb(c.b),o.Vb(a.a),o.Vb(b.a),o.Vb(l.a))},t.\u0275prov=o.Hb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},mrSG:function(t,e,n){"use strict";function i(t,e,n,i){return new(n||(n=Promise))((function(r,s){function o(t){try{a(i.next(t))}catch(e){s(e)}}function c(t){try{a(i.throw(t))}catch(e){s(e)}}function a(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,c)}a((i=i.apply(t,e||[])).next())}))}n.d(e,"a",(function(){return i}))}}]);