(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{"40nA":function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var i=n("fXoL"),r=n("N4Rb"),o=n("3sFK"),s=n("xm+p"),c=n("0IaG"),a=n("ofXK"),b=n("bTqV");function l(e,t){if(1&e){const e=i.Sb();i.Rb(0,"tr"),i.Rb(1,"td",2),i.Rb(2,"div",2),i.Ec(3),i.Qb(),i.Rb(4,"div",9),i.Ec(5),i.Qb(),i.Qb(),i.Rb(6,"td"),i.Rb(7,"button",10),i.Zb("click",(function(){i.rc(e);const t=i.dc().$implicit;return i.dc(2).selectWorkspace(t)})),i.Ec(8,"Select"),i.Qb(),i.Qb(),i.Qb()}if(2&e){const e=i.dc().$implicit;i.Ab(3),i.Gc(" ",e.name,""),i.Ab(2),i.Fc(e.codebasePath)}}function u(e,t){if(1&e&&(i.Pb(0),i.Cc(1,l,9,2,"tr",8),i.Ob()),2&e){const e=t.$implicit;i.Ab(1),i.jc("ngIf",!e.remoteOnly)}}function m(e,t){if(1&e&&(i.Rb(0,"table",4),i.Rb(1,"tr",5),i.Rb(2,"th",6),i.Ec(3,"My Workspaces"),i.Qb(),i.Qb(),i.Cc(4,u,2,1,"ng-container",7),i.Qb()),2&e){const e=i.dc();i.Ab(4),i.jc("ngForOf",e.workspaces)}}let d=(()=>{class e{constructor(e,t,n,i){this.workspaceService=e,this.appEnvironmentService=t,this.navigationService=n,this.dialogRef=i}ngOnInit(){this.getWorkspaces()}selectWorkspace(e){this.appEnvironmentService.switchToEnvironment(e.id).subscribe(()=>{this.navigationService.navigateTo(["workspace"]),this.dialogRef.close()})}getWorkspaces(){this.workspaceService.userWorkspaces().subscribe(e=>{this.workspaces=e.sort((e,t)=>{var n,i;return(null===(n=e.name)||void 0===n?void 0:n.toLowerCase())>(null===(i=t.name)||void 0===i?void 0:i.toLowerCase())?1:-1})})}ngOnDestroy(){}close(){this.dialogRef.close(this.form.value)}}return e.\u0275fac=function(t){return new(t||e)(i.Lb(r.a),i.Lb(o.a),i.Lb(s.a),i.Lb(c.h))},e.\u0275cmp=i.Fb({type:e,selectors:[["select-environment-dialog"]],decls:5,vars:1,consts:[["mat-dialog-title",""],["mat-dialog-content",""],[1,""],["class","table",4,"ngIf"],[1,"table"],[1,"border-top-0"],[1,"text-capitalize","border-top-0"],[4,"ngFor","ngForOf"],[4,"ngIf"],[1,"codebase-path","text-muted"],["mat-raised-button","",3,"click"]],template:function(e,t){1&e&&(i.Rb(0,"h1",0),i.Ec(1,"Select Workspace"),i.Qb(),i.Rb(2,"div",1),i.Rb(3,"div",2),i.Cc(4,m,5,1,"table",3),i.Qb(),i.Qb()),2&e&&(i.Ab(4),i.jc("ngIf",(null==t.workspaces?null:t.workspaces.length)>0))},directives:[c.i,c.f,a.t,a.s,b.b],styles:[".mat-form-field[_ngcontent-%COMP%], .mat-radio-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin:15px 0}.mat-radio-button[_ngcontent-%COMP%]{margin:5px}"]}),e})()},"5Trv":function(e,t,n){"use strict";n.d(t,"a",(function(){return Pe}));var i=n("mrSG"),r=n("0IaG"),o=n("3Pt+"),s=n("quSY"),c=n("itXk"),a=n("LRne"),b=n("HdQx"),l=n("PE4B");class u{static UUID(){return u.UUIDv4("xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx")}static UUIDShort(){return u.UUIDv4("xxxxxxxx")}static UUIDv4(e){return e.replace(/[xy]/g,e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}static merge(e,t){return l(e,t)}}var m=n("IzEk"),d=n("eIep"),f=n("nYR2"),v=n("aSHc"),p=n("OAzE"),h=n("fXoL"),g=n("oCqB"),E=n("ofXK"),S=n("QibW"),P=n("bv9b"),O=n("bTqV");function y(e,t){if(1&e&&(h.Pb(0),h.Rb(1,"form",5),h.Rb(2,"mat-radio-group",6),h.Rb(3,"mat-radio-button",7),h.Ec(4,"Make Stack Public"),h.Qb(),h.Rb(5,"mat-radio-button",7),h.Ec(6,"Make Stack Private"),h.Qb(),h.Qb(),h.Rb(7,"div",8),h.Rb(8,"div",9),h.Ec(9,"Public: \xa0\xa0Anyone can install this stack."),h.Qb(),h.Rb(10,"div",9),h.Ec(11,"Private: Only users who have access to this stack can install it."),h.Qb(),h.Qb(),h.Qb(),h.Ob()),2&e){const e=h.dc();h.Ab(1),h.jc("formGroup",e.form),h.Ab(2),h.jc("value","public"),h.Ab(2),h.jc("value","private")}}function A(e,t){1&e&&(h.Rb(0,"div",10),h.Rb(1,"div"),h.Ec(2,"Publishing Stack..."),h.Qb(),h.Mb(3,"mat-progress-bar",11),h.Qb())}function R(e,t){if(1&e&&(h.Pb(0),h.Rb(1,"div",12),h.Mb(2,"i",13),h.Ec(3),h.Qb(),h.Ob()),2&e){const e=h.dc();h.Ab(3),h.Gc(" Stack: ",e.data.stack.name," has been published! ")}}function k(e,t){if(1&e&&(h.Rb(0,"div",18),h.Ec(1),h.Qb()),2&e){const e=h.dc(2);h.Ab(1),h.Gc("Error: ",e.errorMessage,"")}}function I(e,t){if(1&e&&(h.Pb(0),h.Rb(1,"div",14),h.Mb(2,"i",15),h.Ec(3," Failed to publish stack: "),h.Rb(4,"span",16),h.Ec(5),h.Qb(),h.Ec(6,". "),h.Qb(),h.Cc(7,k,2,1,"div",17),h.Ob()),2&e){const e=h.dc();h.Ab(5),h.Fc(e.data.stack.name),h.Ab(2),h.jc("ngIf",e.errorMessage)}}function j(e,t){if(1&e){const e=h.Sb();h.Pb(0),h.Rb(1,"button",19),h.Ec(2,"Cancel"),h.Qb(),h.Rb(3,"button",20),h.Zb("click",(function(){return h.rc(e),h.dc().publish()})),h.Ec(4,"Publish"),h.Qb(),h.Ob()}if(2&e){const e=h.dc();h.Ab(3),h.jc("disabled",e.form.invalid)}}function C(e,t){if(1&e){const e=h.Sb();h.Pb(0),h.Rb(1,"button",21),h.Zb("click",(function(){return h.rc(e),h.dc().close()})),h.Ec(2,"Close"),h.Qb(),h.Ob()}}let x=(()=>{class e{constructor(e,t,n,i){this.fb=e,this.stackService=t,this.data=n,this.dialogRef=i,this.actionState=v.a,this.currentState=v.a.IDLE,this.form=this.fb.group({textInput:[],visibility:["public",[o.F.required]],select:[]})}ngOnInit(){this.errorMessage=null,this.form.valueChanges.subscribe(e=>{})}ngOnDestroy(){}close(){this.dialogRef.close(this.form.value)}publish(){this.currentState=v.a.ACQUIRING,this.stackService.publishStack(this.data.stack.id).subscribe(()=>{this.dialogRef.close()},e=>{var t,n;this.currentState=v.a.FAILED,console.log(e.error),this.errorMessage=(null===(t=e.error)||void 0===t?void 0:t.code)===p.HttpError.STACK_CREATION_NAME_IN_USE?`Stack name '${this.data.stack.name}' is in use. Please rename the stack and try publishing again.`:(null===(n=e.error)||void 0===n?void 0:n.message)||"Unknown error occurred while trying to publish stack."})}}return e.\u0275fac=function(t){return new(t||e)(h.Lb(o.f),h.Lb(g.a),h.Lb(r.a),h.Lb(r.h))},e.\u0275cmp=h.Fb({type:e,selectors:[["publish-stack-dialog"]],decls:10,vars:7,consts:[["mat-dialog-title",""],["mat-dialog-content",""],[4,"ngIf"],["class","text-center p-2",4,"ngIf"],["mat-dialog-actions","",3,"align"],[3,"formGroup"],["aria-label","Select an option","formControlName","visibility",1,"mat-radio-group"],[1,"mat-radio-button",3,"value"],[1,"pb-2"],[1,"text-small","text-muted"],[1,"text-center","p-2"],["mode","indeterminate"],[1,"text-center","p-2","text-success"],[1,"fa","fa-check","mr-2"],[1,"text-center","p-2","text-red"],[1,"fa","fa-times-circle","mr-2"],[1,"text-capitalize"],["class","text-muted text-small pl-5",4,"ngIf"],[1,"text-muted","text-small","pl-5"],["mat-button","","mat-dialog-close",""],["mat-button","",3,"disabled","click"],["mat-button","",3,"click"]],template:function(e,t){1&e&&(h.Rb(0,"h1",0),h.Ec(1,"Publish Stack"),h.Qb(),h.Rb(2,"div",1),h.Cc(3,y,12,3,"ng-container",2),h.Cc(4,A,4,0,"div",3),h.Cc(5,R,4,1,"ng-container",2),h.Cc(6,I,8,2,"ng-container",2),h.Qb(),h.Rb(7,"div",4),h.Cc(8,j,5,1,"ng-container",2),h.Cc(9,C,3,0,"ng-container",2),h.Qb()),2&e&&(h.Ab(3),h.jc("ngIf",t.currentState===t.actionState.IDLE),h.Ab(1),h.jc("ngIf",t.currentState===t.actionState.ACQUIRING),h.Ab(1),h.jc("ngIf",t.currentState===t.actionState.SUCCESS),h.Ab(1),h.jc("ngIf",t.currentState===t.actionState.FAILED),h.Ab(1),h.jc("align","end"),h.Ab(1),h.jc("ngIf",t.currentState===t.actionState.IDLE),h.Ab(1),h.jc("ngIf",t.currentState===t.actionState.SUCCESS||t.currentState===t.actionState.FAILED))},directives:[r.i,r.f,E.t,r.c,o.H,o.s,o.k,S.b,o.r,o.i,S.a,P.a,O.b,r.d],styles:[".mat-form-field[_ngcontent-%COMP%], .mat-radio-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin:15px 0}.mat-radio-button[_ngcontent-%COMP%]{margin:5px}"]}),e})();var w=n("3sFK"),Q=n("N4Rb"),_=n("biaL"),M=n("nZ6g"),D=n("+0xr"),T=n("d3UM"),L=n("FKr1"),U=n("zkoq"),F=n("kmnG"),N=n("qFsG");function G(e,t){1&e&&(h.Pb(0),h.Mb(1,"br"),h.Mb(2,"mat-progress-bar",5),h.Mb(3,"br"),h.Ob())}function W(e,t){1&e&&(h.Rb(0,"h4",16),h.Ec(1,"You must be an administrator to change these settings"),h.Qb())}function $(e,t){1&e&&h.Mb(0,"th",17)}function H(e,t){1&e&&(h.Rb(0,"div",22),h.Ec(1,"Primary Owner"),h.Qb())}function V(e,t){if(1&e&&(h.Rb(0,"div",20),h.Rb(1,"div"),h.Ec(2),h.Qb(),h.Cc(3,H,2,0,"div",21),h.Qb()),2&e){const e=h.dc().$implicit,t=h.dc(3);h.Ab(2),h.Fc(t.userProfiles.get(e).email||"Unknown user"),h.Ab(1),h.jc("ngIf",e==t.environment.remote.owner)}}function q(e,t){if(1&e&&(h.Rb(0,"td",18),h.Cc(1,V,4,2,"div",19),h.Qb()),2&e){const e=t.$implicit,n=h.dc(3);h.Ab(1),h.jc("ngIf",n.userProfiles.has(e))}}function Z(e,t){1&e&&(h.Rb(0,"th",17),h.Ec(1,"Permission"),h.Qb())}function X(e,t){if(1&e&&(h.Rb(0,"mat-option",25),h.Ec(1),h.ec(2,"titlecase"),h.Qb()),2&e){const e=t.$implicit;h.jc("value",e.value),h.Ab(1),h.Gc(" ",h.fc(2,2,e.key)," ")}}function K(e,t){if(1&e){const e=h.Sb();h.Pb(0),h.Rb(1,"mat-select",23),h.Zb("valueChange",(function(t){h.rc(e);const n=h.dc().$implicit;return h.dc(3).dirtyEnvPerms[n].permission=t})),h.Cc(2,X,3,4,"mat-option",24),h.ec(3,"keyvalue"),h.Qb(),h.Ob()}if(2&e){const e=h.dc().$implicit,t=h.dc(3);h.Ab(1),h.jc("value",t.dirtyEnvPerms[e].permission),h.Ab(1),h.jc("ngForOf",h.gc(3,2,t.envPermissions,t.originalOrder))}}function J(e,t){if(1&e&&(h.Pb(0),h.Ec(1),h.ec(2,"titlecase"),h.Ob()),2&e){const e=h.dc().$implicit,t=h.dc(3);h.Ab(1),h.Gc(" ",h.fc(2,1,t.convertPermissionToString(t.dirtyEnvPerms[e].permission))," ")}}function z(e,t){if(1&e&&(h.Rb(0,"td",18),h.Cc(1,K,4,5,"ng-container",2),h.Cc(2,J,3,3,"ng-container",2),h.Qb()),2&e){const e=h.dc(3);h.Ab(1),h.jc("ngIf",e.userIsAdmin),h.Ab(1),h.jc("ngIf",!e.userIsAdmin)}}function B(e,t){1&e&&(h.Rb(0,"th",17),h.Ec(1,"Actions"),h.Qb())}function Y(e,t){if(1&e){const e=h.Sb();h.Pb(0),h.Rb(1,"button",27),h.Zb("click",(function(){h.rc(e);const t=h.dc().$implicit;return h.dc(3).save(t)})),h.Ec(2," Save "),h.Qb(),h.Rb(3,"button",28),h.Zb("click",(function(){h.rc(e);const t=h.dc().$implicit;return h.dc(3).revoke(t)})),h.Ec(4,"Revoke"),h.Qb(),h.Ob()}if(2&e){const e=h.dc().$implicit,t=h.dc(3);h.Ab(1),h.jc("disabled",t.dirtyEnvPerms[e].permission===t.environment.remote.permissions[e].permission)}}function ee(e,t){1&e&&(h.Pb(0),h.Mb(1,"mat-progress-bar",5),h.Ob())}function te(e,t){if(1&e&&(h.Rb(0,"td",26),h.Cc(1,Y,5,1,"ng-container",2),h.Cc(2,ee,2,0,"ng-container",2),h.Qb()),2&e){const e=t.$implicit,n=h.dc(3);h.Ab(1),h.jc("ngIf",!n.dirtyEnvPerms[e].saving),h.Ab(1),h.jc("ngIf",n.dirtyEnvPerms[e].saving)}}function ne(e,t){1&e&&h.Mb(0,"tr",29)}function ie(e,t){1&e&&h.Mb(0,"tr",30)}function re(e,t){1&e&&h.Mb(0,"th",17)}function oe(e,t){if(1&e&&(h.Pb(0),h.Ec(1),h.Ob()),2&e){const e=h.dc().$implicit,t=h.dc(5);h.Ab(1),h.Gc(" ",t.userProfiles.get(e).username||t.userProfiles.get(e).email||"Unknown user"," ")}}function se(e,t){if(1&e&&(h.Rb(0,"td",18),h.Cc(1,oe,2,1,"ng-container",2),h.Qb()),2&e){const e=t.$implicit,n=h.dc(5);h.Ab(1),h.jc("ngIf",n.userProfiles.has(e))}}function ce(e,t){1&e&&(h.Rb(0,"th",17),h.Ec(1,"Actions"),h.Qb())}function ae(e,t){if(1&e){const e=h.Sb();h.Pb(0),h.Rb(1,"button",40),h.Zb("click",(function(){h.rc(e);const t=h.dc().$implicit;return h.dc(5).resendInvite(t)})),h.Ec(2,"Resend Invite"),h.Qb(),h.Rb(3,"button",28),h.Zb("click",(function(){h.rc(e);const t=h.dc().$implicit;return h.dc(5).cancelShare(t)})),h.Ec(4,"Cancel Invite"),h.Qb(),h.Ob()}}function be(e,t){1&e&&(h.Pb(0),h.Mb(1,"mat-progress-bar",5),h.Ob())}function le(e,t){if(1&e&&(h.Rb(0,"td",26),h.Cc(1,ae,5,0,"ng-container",2),h.Cc(2,be,2,0,"ng-container",2),h.Qb()),2&e){const e=t.$implicit,n=h.dc(5);h.Ab(1),h.jc("ngIf",!n.dirtyEnvPerms[e].saving),h.Ab(1),h.jc("ngIf",n.dirtyEnvPerms[e].saving)}}function ue(e,t){1&e&&h.Mb(0,"tr",29)}function me(e,t){1&e&&h.Mb(0,"tr",30)}const de=function(){return["email","actions"]};function fe(e,t){if(1&e&&(h.Pb(0),h.Rb(1,"h4",39),h.Ec(2,"Pending Invites"),h.Qb(),h.Rb(3,"table",7),h.Pb(4,8),h.Cc(5,re,1,0,"th",9),h.Cc(6,se,2,1,"td",10),h.Ob(),h.Pb(7,12),h.Cc(8,ce,2,0,"th",9),h.Cc(9,le,3,2,"td",13),h.Ob(),h.Cc(10,ue,1,0,"tr",14),h.Cc(11,me,1,0,"tr",15),h.Qb(),h.Ob()),2&e){const e=h.dc(4);h.Ab(3),h.jc("dataSource",e.getInviteIds()),h.Ab(7),h.jc("matHeaderRowDef",h.kc(3,de)),h.Ab(1),h.jc("matRowDefColumns",h.kc(4,de))}}function ve(e,t){if(1&e&&(h.Rb(0,"mat-option",25),h.Ec(1),h.ec(2,"titlecase"),h.Qb()),2&e){const e=t.$implicit;h.jc("value",e.value),h.Ab(1),h.Gc(" ",h.fc(2,2,e.key)," ")}}function pe(e,t){if(1&e){const e=h.Sb();h.Pb(0),h.Cc(1,fe,12,5,"ng-container",2),h.Rb(2,"form",31),h.Zb("submit",(function(){return h.rc(e),h.dc(3).share()})),h.Rb(3,"mat-grid-list",32),h.Rb(4,"mat-grid-tile",33),h.Rb(5,"mat-form-field"),h.Rb(6,"mat-label"),h.Ec(7,"Email"),h.Qb(),h.Mb(8,"input",34),h.Qb(),h.Qb(),h.Rb(9,"mat-grid-tile",35),h.Rb(10,"mat-form-field"),h.Rb(11,"mat-label"),h.Ec(12,"Permissions"),h.Qb(),h.Rb(13,"mat-select",36),h.Cc(14,ve,3,4,"mat-option",24),h.ec(15,"keyvalue"),h.Qb(),h.Qb(),h.Qb(),h.Rb(16,"mat-grid-tile",37),h.Rb(17,"button",38),h.Ec(18,"Add"),h.Qb(),h.Qb(),h.Qb(),h.Qb(),h.Ob()}if(2&e){const e=h.dc(3);h.Ab(1),h.jc("ngIf",e.getInviteIds().length>0),h.Ab(1),h.jc("formGroup",e.form),h.Ab(12),h.jc("ngForOf",h.gc(15,3,e.envPermissions,e.originalOrder))}}const he=function(){return["email","perm","actions"]},ge=function(){return["email","perm"]};function Ee(e,t){if(1&e&&(h.Pb(0),h.Cc(1,W,2,0,"h4",6),h.Pb(2),h.Rb(3,"table",7),h.Pb(4,8),h.Cc(5,$,1,0,"th",9),h.Cc(6,q,2,1,"td",10),h.Ob(),h.Pb(7,11),h.Cc(8,Z,2,0,"th",9),h.Cc(9,z,3,2,"td",10),h.Ob(),h.Pb(10,12),h.Cc(11,B,2,0,"th",9),h.Cc(12,te,3,2,"td",13),h.Ob(),h.Cc(13,ne,1,0,"tr",14),h.Cc(14,ie,1,0,"tr",15),h.Qb(),h.Ob(),h.Cc(15,pe,19,6,"ng-container",2),h.Ob()),2&e){const e=h.dc(2);h.Ab(1),h.jc("ngIf",!e.userIsAdmin),h.Ab(2),h.jc("dataSource",e.getUserWithPermIds()),h.Ab(10),h.jc("matHeaderRowDef",e.userIsAdmin?h.kc(5,he):h.kc(6,ge)),h.Ab(1),h.jc("matRowDefColumns",e.userIsAdmin?h.kc(7,he):h.kc(8,ge)),h.Ab(1),h.jc("ngIf",e.userIsAdmin)}}function Se(e,t){if(1&e&&(h.Pb(0),h.Cc(1,Ee,16,9,"ng-container",2),h.Ob()),2&e){const e=h.dc();h.Ab(1),h.jc("ngIf",e.environment.remote)}}let Pe=(()=>{class e{constructor(e,t,n,r,o,l,u,f,v){this.fb=e,this.dialog=t,this.stackService=n,this.appEnvironmentService=r,this.workspaceService=o,this.userService=l,this.dialogService=u,this.dialogRef=f,this.data=v,this.loading=!0,this.userIsAdmin=!1,this.userProfiles=new Map,this.envPermissions=new Map([["read",b.a.Environment.EnvironmentPermissions.read],["write",b.a.Environment.EnvironmentPermissions.write],["admin",b.a.Environment.EnvironmentPermissions.admin],["owner",b.a.Environment.EnvironmentPermissions.owner]]),this.subs=new s.a,this.originalOrder=(e,t)=>0,this.publishStack=()=>Object(i.a)(this,void 0,void 0,(function*(){this.dialog.open(x,{data:{stack:this.environment},position:{top:"100px"},minWidth:"400px",autoFocus:!0}).afterClosed().subscribe(()=>{const e=this.stackService.userStacks().pipe(Object(m.a)(1)).subscribe(t=>{this.environment=t.find(e=>e.id=this.environment.id),this.setupShareSettings(),this.loading=!1,e.unsubscribe()})})})),this.publishWorkspace=()=>Object(i.a)(this,void 0,void 0,(function*(){this.loading=!0,this.subs.add(this.workspaceService.publishWorkspace(this.environment.id).pipe(Object(d.a)(e=>Object(c.a)([Object(a.a)(e),this.workspaceService.userWorkspaces().pipe(Object(m.a)(1))]))).subscribe(([e,t])=>{this.environment=t.find(t=>t.id===e.id),this.setupShareSettings(),this.loading=!1},e=>{this.dialogService.openAlertDialog({title:"Publish Workspace",text:"Error: "+(e.message||"Server error!")}),this.loading=!1}))})),this.environment=v.environment,this.environmentType=v.type,this.subs.add(this.userService.user$.subscribe(e=>{e&&(this.userId=e.uid)}))}ngOnInit(){this.environment.remote?(this.setupShareSettings(),this.loading=!1):this.publish()}run(e,t){return"stack"===this.environmentType?e():"workspace"===this.environmentType?t():void 0}setupShareSettings(){var e;return Object(i.a)(this,void 0,void 0,(function*(){this.userIsAdmin=(null===(e=this.environment.remote)||void 0===e?void 0:e.permissions[this.userId].permission)>=this.envPermissions.get("admin"),this.dirtyEnvPerms=Object.entries(u.merge(this.environment.remote.invites,this.environment.remote.permissions)).reduce((e,t)=>(e[t[0]]=Object.assign(Object.assign({},t[1]),{saving:!1}),e),{}),this.form=this.fb.group({emailToAdd:["",[o.F.required,o.F.email]],permission:[this.envPermissions.get("read"),[o.F.required]]}),yield this.getUserProfilesForEnvironment()}))}getUserProfilesForEnvironment(){return Object(i.a)(this,void 0,void 0,(function*(){(yield this.workspaceService.getUserProfilesFor(this.environment.remote.id).pipe(Object(m.a)(1)).toPromise()).forEach(e=>this.userProfiles.set(e.uid,e))}))}getUserWithPermIds(){var e;return Object.keys((null===(e=this.environment.remote)||void 0===e?void 0:e.permissions)||{}).sort((e,t)=>this.environment.remote.permissions[e].permission<=this.environment.remote.permissions[t].permission?1:-1)}getInviteIds(){var e;return Object.keys((null===(e=this.environment.remote)||void 0===e?void 0:e.invites)||{})}ngOnDestroy(){this.subs.unsubscribe()}close(){this.dialogRef.close()}convertPermissionToString(e){switch(e){case b.a.Environment.EnvironmentPermissions.read:return"Read";case b.a.Environment.EnvironmentPermissions.write:return"Write";case b.a.Environment.EnvironmentPermissions.admin:return"Admin";case b.a.Environment.EnvironmentPermissions.owner:return"Owner"}}share(){this.form.disable();const{emailToAdd:e,permission:t}=this.form.getRawValue();this.workspaceService.share(this.environment.remote.id,e,t).pipe(Object(m.a)(1),Object(f.a)(()=>{this.form.enable()})).subscribe(e=>{const{userId:n}=e;this.environment.remote.invites[n]={permission:t},this.userProfiles.set(n,{username:"Loading...",email:"",uid:n}),this.dirtyEnvPerms[n]={permission:t,saving:!1},this.getUserProfilesForEnvironment(),this.form.reset()},e=>{this.dialogService.openAlertDialog({title:"Share Workspace",text:"Error while sharing"}),console.log(e)})}cancelShare(e){this.dirtyEnvPerms[e].saving=!0,this.workspaceService.cancelShare(this.environment.remote.id,e).pipe(Object(m.a)(1)).subscribe(()=>{delete this.environment.remote.invites[e],delete this.dirtyEnvPerms[e]},t=>{this.dialogService.openAlertDialog({title:"Share Workspace",text:""+(t.message||"Unknown error occurred!")}),this.dirtyEnvPerms[e].saving=!1})}resendInvite(e){this.dirtyEnvPerms[e].saving=!0,this.workspaceService.share(this.environment.remote.id,this.userProfiles.get(e).email,this.environment.remote.invites[e].permission).pipe(Object(m.a)(1)).subscribe(()=>{this.dialogService.openAlertDialog({title:"Send Invite",text:"Invite sent successfully."})},e=>{this.dialogService.openAlertDialog({title:"Send Invite",text:"Invite failed to be sent, please try again later."})},()=>{this.dirtyEnvPerms[e].saving=!1})}publish(){return Object(i.a)(this,void 0,void 0,(function*(){yield this.run(this.publishStack,this.publishWorkspace)}))}save(e){this.dirtyEnvPerms[e].saving=!0,this.workspaceService.updateUserPermission(this.environment.remote.id,e,this.dirtyEnvPerms[e].permission).pipe(Object(m.a)(1)).toPromise().then(()=>{this.environment.remote.permissions[e].permission=this.dirtyEnvPerms[e].permission}).catch(t=>{this.dirtyEnvPerms[e].permission=this.environment.remote.permissions[e].permission,this.dialogService.openAlertDialog({title:"Sync Stack",text:""+(t.message||"Unknown error occurred!")})}).finally(()=>{this.dirtyEnvPerms[e].saving=!1})}revoke(e){e===this.environment.remote.owner?this.dialogService.openAlertDialog({title:"Revoke Access",text:"You cannot revoke the permissions of the original owner!"}):this.dialogService.openConfirmationDialog({title:"Revoke Access",text:"This will revoke all permissions from the user "+(this.userProfiles.get(e).username||this.userProfiles.get(e).email),button:{yes:"Revoke",no:"Cancel"}}).afterClosed().subscribe(t=>{!0===t&&(this.dirtyEnvPerms[e].saving=!0,this.workspaceService.revokeUserPermission(this.environment.remote.id,e).pipe(Object(m.a)(1)).toPromise().then(()=>{delete this.environment.remote.permissions[e],delete this.dirtyEnvPerms[e]}).catch(t=>{this.dialogService.openAlertDialog({title:"Revoke Access",text:"Error: "+(t.message||"Unknown error occurred!")}),this.dirtyEnvPerms[e].saving=!1}))})}}return e.\u0275fac=function(t){return new(t||e)(h.Lb(o.f),h.Lb(r.b),h.Lb(g.a),h.Lb(w.a),h.Lb(Q.a),h.Lb(_.a),h.Lb(M.a),h.Lb(r.h),h.Lb(r.a))},e.\u0275cmp=h.Fb({type:e,selectors:[["new-environment-dialog"]],decls:8,vars:3,consts:[["mat-dialog-title",""],["mat-dialog-content",""],[4,"ngIf"],["mat-dialog-actions","",3,"align"],["mat-button","","mat-dialog-close",""],["mode","indeterminate"],["class","text-grey",4,"ngIf"],["mat-table","",1,"permTable",3,"dataSource"],["matColumnDef","email"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","perm"],["matColumnDef","actions"],["mat-cell","","class","tableActions",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],[1,"text-grey"],["mat-header-cell",""],["mat-cell",""],["class","pt-1",4,"ngIf"],[1,"pt-1"],["class","text-muted text-small",4,"ngIf"],[1,"text-muted","text-small"],[3,"value","valueChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["mat-cell","",1,"tableActions"],["mat-button","","mat-raised-button","","color","primary",3,"disabled","click"],["mat-button","","mat-raised-button","","color","warn",3,"click"],["mat-header-row",""],["mat-row",""],[3,"formGroup","submit"],["cols","7"],["colspan","4"],["type","email","matInput","","formControlName","emailToAdd"],["colspan","2"],["formControlName","permission"],["colspan","1"],["mat-button","","mat-raised-button","","color","primary","type","submit"],[2,"margin-top","15px","margin-bottom","0"],["mat-button","","mat-raised-button","","color","primary",3,"click"]],template:function(e,t){1&e&&(h.Rb(0,"h1",0),h.Ec(1,"Share Settings"),h.Qb(),h.Rb(2,"div",1),h.Cc(3,G,4,0,"ng-container",2),h.Cc(4,Se,2,1,"ng-container",2),h.Qb(),h.Rb(5,"div",3),h.Rb(6,"button",4),h.Ec(7,"Close"),h.Qb(),h.Qb()),2&e&&(h.Ab(3),h.jc("ngIf",t.loading),h.Ab(1),h.jc("ngIf",!t.loading),h.Ab(1),h.jc("align","end"))},directives:[r.i,r.f,E.t,r.c,O.b,r.d,P.a,D.j,D.c,D.e,D.b,D.g,D.i,D.d,D.a,T.a,E.s,L.k,D.f,D.h,o.H,o.s,o.k,U.a,U.c,F.c,F.g,N.a,o.c,o.r,o.i],pipes:[E.l,E.F],styles:["mat-form-field[_ngcontent-%COMP%]{width:100%;padding:0 5px}.permTable[_ngcontent-%COMP%]{width:100%}.tableActions[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{margin-right:5px}"]}),e})()},"7n/8":function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var i=n("ofXK"),r=n("bTqV"),o=n("0IaG"),s=n("qFsG"),c=n("QibW"),a=n("d3UM"),b=n("3Pt+"),l=n("fXoL");let u=(()=>{class e{}return e.\u0275mod=l.Jb({type:e}),e.\u0275inj=l.Ib({factory:function(t){return new(t||e)},providers:[],imports:[[i.c,o.g,s.b,b.m,r.c,c.c,b.B,a.b]]}),e})()},A4A1:function(e,t,n){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.HttpError=void 0,(i=t.HttpError||(t.HttpError={})).UNKNOWN="unknown",i.UNAUTHORIZED="unauthorized",i.PARAMS_MISSING="parameters-missing",i.INVALID_ENVIRONMENT="invalid-environment",i.INVALID_PARAMETERS="invalid-parameters",i.BAD_REQUEST="bad-request",i.INVALID_PATH="invalid-path",i.USER_NOT_FOUND="user-not-found",i.STACK_CREATION_NAME_IN_USE="stack/creation/name-in-use",i.ORG_CREATION_NAME_IN_USE="org/creation/name-in-use",i.ORG_CREATION_PREFIX_IN_USE="org/creation/prefix-in-use",i.ORG_DELETION_STILL_IN_USE="org/deletion/still-in-use"},EVKI:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var i=n("0IaG"),r=n("3Pt+"),o=n("fXoL"),s=n("3sFK"),c=n("kmnG"),a=n("qFsG"),b=n("bTqV");let l=(()=>{class e{constructor(e,t,n,i){var o;this.fb=e,this.appEnvironmentService=t,this.data=n,this.dialogRef=i,this.form=this.fb.group({name:[null===(o=this.data.environment)||void 0===o?void 0:o.name,[r.F.required]]})}ngOnInit(){this.form.valueChanges.subscribe(e=>{})}ngOnDestroy(){}close(){this.dialogRef.close(this.form.value)}save(){this.appEnvironmentService.rename(this.data.environment.id,this.form.controls.name.value).subscribe(e=>{this.dialogRef.close({success:!0})},e=>{})}}return e.\u0275fac=function(t){return new(t||e)(o.Lb(r.f),o.Lb(s.a),o.Lb(i.a),o.Lb(i.h))},e.\u0275cmp=o.Fb({type:e,selectors:[["rename-environment-dialog"]],decls:13,vars:5,consts:[["mat-dialog-title",""],["mat-dialog-content",""],[3,"formGroup"],[1,"mat-form-field"],["placeholder","Text Input","matInput","","formControlName","name"],["mat-dialog-actions","",3,"align"],["mat-button","","mat-dialog-close",""],["mat-button","",3,"disabled","click"]],template:function(e,t){1&e&&(o.Rb(0,"h1",0),o.Ec(1),o.Rb(2,"span"),o.Ec(3),o.Qb(),o.Qb(),o.Rb(4,"div",1),o.Rb(5,"form",2),o.Rb(6,"mat-form-field",3),o.Mb(7,"input",4),o.Qb(),o.Qb(),o.Qb(),o.Rb(8,"div",5),o.Rb(9,"button",6),o.Ec(10,"Cancel"),o.Qb(),o.Rb(11,"button",7),o.Zb("click",(function(){return t.save()})),o.Ec(12,"Rename"),o.Qb(),o.Qb()),2&e&&(o.Ab(1),o.Gc("Rename ",t.data.environment.name," "),o.Ab(2),o.Fc(t.data.environment.type),o.Ab(2),o.jc("formGroup",t.form),o.Ab(3),o.jc("align","end"),o.Ab(3),o.jc("disabled",t.form.invalid))},directives:[i.i,i.f,r.H,r.s,r.k,c.c,a.a,r.c,r.r,r.i,i.c,b.b,i.d],styles:[".mat-form-field[_ngcontent-%COMP%], .mat-radio-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin:15px 0}.mat-radio-button[_ngcontent-%COMP%]{margin:5px}"]}),e})()},OAzE:function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,r)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||i(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),r(n("EICP"),t),r(n("OEZC"),t),r(n("Qk56"),t),r(n("h/V3"),t)},OEZC:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tags=void 0,t.Tags={languages:{JAVASCRIPT:"javascript",TYPESCRIPT:"typescript",JAVA:"java",PYTHON:"python",C:"C"},frameworks:{EXPRESSJS:"expressjs",ANGULARJS:"angularjs",NODEJS:"nodejs",REACTJS:"reactjs"}}},PE4B:function(e,t,n){"use strict";var i=function(e){return function(e){return!!e&&"object"==typeof e}(e)&&!function(e){var t=Object.prototype.toString.call(e);return"[object RegExp]"===t||"[object Date]"===t||function(e){return e.$$typeof===r}(e)}(e)},r="function"==typeof Symbol&&Symbol.for?Symbol.for("react.element"):60103;function o(e,t){return!1!==t.clone&&t.isMergeableObject(e)?b(Array.isArray(e)?[]:{},e,t):e}function s(e,t,n){return e.concat(t).map((function(e){return o(e,n)}))}function c(e){return Object.keys(e).concat(function(e){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(e).filter((function(t){return e.propertyIsEnumerable(t)})):[]}(e))}function a(e,t){try{return t in e}catch(n){return!1}}function b(e,t,n){(n=n||{}).arrayMerge=n.arrayMerge||s,n.isMergeableObject=n.isMergeableObject||i,n.cloneUnlessOtherwiseSpecified=o;var r=Array.isArray(t);return r===Array.isArray(e)?r?n.arrayMerge(e,t,n):function(e,t,n){var i={};return n.isMergeableObject(e)&&c(e).forEach((function(t){i[t]=o(e[t],n)})),c(t).forEach((function(r){(function(e,t){return a(e,t)&&!(Object.hasOwnProperty.call(e,t)&&Object.propertyIsEnumerable.call(e,t))})(e,r)||(i[r]=a(e,r)&&n.isMergeableObject(t[r])?function(e,t){if(!t.customMerge)return b;var n=t.customMerge(e);return"function"==typeof n?n:b}(r,n)(e[r],t[r],n):o(t[r],n))})),i}(e,t,n):o(t,n)}b.all=function(e,t){if(!Array.isArray(e))throw new Error("first argument should be an array");return e.reduce((function(e,n){return b(e,n,t)}),{})},e.exports=b},Qk56:function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,r)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||i(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),r(n("A4A1"),t)},"h/V3":function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,r)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||i(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),r(n("zXtJ"),t)},k1Ex:function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var i=n("HdQx"),r=n("b5vT"),o=n("IzEk"),s=n("fXoL"),c=n("0IaG"),a=n("a8/g"),b=n("xm+p"),l=n("3sFK");let u=(()=>{class e{constructor(e,t,n,i){this.dialog=e,this.appConsoleService=t,this.navigationService=n,this.appEnvironmentService=i}createNewWorkspace(e){const t=this.dialog.open(r.a,{data:{type:i.a.Environment.Type.Workspace,stack:e},disableClose:!0,minWidth:"600px",position:{top:"100px"},autoFocus:!0});return t.afterClosed().subscribe(t=>{t.continue&&this.appEnvironmentService.switchToEnvironment(t.newEnvironment.id).subscribe(t=>{setTimeout(()=>{this.appConsoleService.openBluConsole({command:"install "+e.displayName,extraInfo:{stack:e}}).afterClosed().pipe(Object(o.a)(1)).subscribe(e=>this.navigationService.navigateTo(["workspace"]))},250)})}),t}}return e.\u0275fac=function(t){return new(t||e)(s.Vb(c.b),s.Vb(a.a),s.Vb(b.a),s.Vb(l.a))},e.\u0275prov=s.Hb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()},mrSG:function(e,t,n){"use strict";function i(e,t,n,i){return new(n||(n=Promise))((function(r,o){function s(e){try{a(i.next(e))}catch(t){o(t)}}function c(e){try{a(i.throw(e))}catch(t){o(t)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,c)}a((i=i.apply(e,t||[])).next())}))}n.d(t,"a",(function(){return i}))},zXtJ:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.stringToDate=t.dateToString=void 0,t.dateToString=function(e){return e.toISOString()},t.stringToDate=function(e){return new Date(e)}}}]);